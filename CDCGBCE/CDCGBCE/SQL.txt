--#2017/1/9 上午 11:49:28#  http://192.168.171.167/CDCGBCE/UI.CashRpt.Web/FrmPrint.aspx?MenuID=1532
--[Parameter Count:1]
--@parMenuID='1532'
 Select * From SysMenuBase Where PK_MnuNo ='1532' 
-------------------------------------------------------------------------------
--執行時間--  2017/1/9 上午 11:49:28
--連線字串：Data Source=192.168.170.79;Initial Catalog=CDCGBCE;Persist Security Info=True;User ID=Cdcgbce;Password=B8Dt*XvU
--參數個數：2
Declare @parcskKind As VarChar(2)
Set @parcskKind = '0'
Declare @parCskUser As NVarChar(10)
Set @parCskUser = '系統管理者'
 Select  * 
       , (CASE WHEN KU.cskKind=0 THEN '零用金' WHEN KU.cskKind=1 THEN '電子支付' ELSE '支付廠商' END) AS cskKindName 
       , (SELECT csName FROM cashSort WHERE KU.csCode=csCode) AS csName 
       , (SELECT crName FROM cashRoster WHERE KU.crCode=crCode) AS crName 
  From  cashKindUser KU
  Where 1=1 
 And KU.cskKind =  @parcskKind 
 And KU.cskUser =  @parcskUser 
  Order By    1  
------------------------------------------------------------

--執行時間--  2017/1/9 上午 11:49:28
--連線字串：Data Source=192.168.170.79;Initial Catalog=CDCGBCE;Persist Security Info=True;User ID=Cdcgbce;Password=B8Dt*XvU
--參數個數：3
Declare @parcsCode As VarChar(1)
Set @parcsCode = Null 
Declare @parcsuKind As VarChar(2)
Set @parcsuKind = '0'
Declare @parcsuPassUser As NVarChar(10)
Set @parcsuPassUser = '系統管理者'
 Select * 
       ,(SELECT csName FROM cashSort WHERE csCode=CSU.csCode) AS csName   From  cashSortUser CSU
  Where 1=1 
 And CSU.csuKind =  @parcsuKind 
 And CSU.csuPassUser =  @parcsuPassUser   Order By    1  
------------------------------------------------------------

--執行時間--  2017/1/9 上午 11:49:28
--連線字串：Data Source=192.168.170.79;Initial Catalog=CDCGBCE;Persist Security Info=True;User ID=Cdcgbce;Password=B8Dt*XvU
--參數個數：2
Declare @parcskKind As VarChar(2)
Set @parcskKind = '0'
Declare @parCskUser As NVarChar(1)
Set @parCskUser = Null 
 Select  DISTINCT KU.csCode 
       , (SELECT csName FROM cashSort WHERE KU.csCode=csCode) AS csName 
  From  cashKindUser KU
  Where 1=1 
 And KU.cskKind =  @parcskKind 
  Order By    1  
------------------------------------------------------------

--#2017/1/9 上午 11:49:28#  http://192.168.171.167/CDCGBCE/UI.CashRpt.Web/FrmPrint.aspx?MenuID=1532
SELECT csCode FROM cashOrderNo WHERE cnPhase='1' AND cskKind='0' AND cnYear=105 AND csmNo=1258
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:49:28#  http://192.168.171.167/CDCGBCE/UI.CashRpt.Web/FrmPrint.aspx?MenuID=1532
--[Parameter Count:4]
--@parCsmYear=105
--@parCsmNo=1258
--@parCsCode='A'
--@parCsmKind='0'
SELECT DISTINCT codCodeVer,planCode,MAX(planName) AS planName 
               ,SUM(acvMoney) AS acvMoney,Level AS SpaceCnt,DS.csmNo 
			    ,'中華民國 '+ CONVERT(CHAR(3),YEAR(MAX(QcsmSDate))-1911) +'年 '+ CONVERT(CHAR(2),MONTH(MAX(QcsmSDate))) +'月'+ CONVERT(CHAR(2),DAY(MAX(QcsmSDate))) +'日' + 
				'至 '+CONVERT(CHAR(3),YEAR(MAX(QcsmEDate))-1911) +'年 '+ CONVERT(CHAR(2),MONTH(MAX(QcsmEDate))) +'月'+ CONVERT(CHAR(2),DAY(MAX(QcsmEDate))) +'日' AS CDate 
               ,(SELECT SUM(cinMoney) 
					FROM CashIn CI INNER JOIN cashOrderNo O 
					  ON O.cnPhase='2' AND O.csCode IN ('A') 
					 AND O.cskKind='0' AND CI.cinYear=O.cnYear AND CI.cinNo=O.csmNo 
				   WHERE cinYear=105 AND--1000121 
                        CONVERT(CHAR(10),cinDate,111) <= ISNULL((SELECT CONVERT(CHAR(10),csmEDate,111) FROM cashMain1 WHERE csmYear=105 
																	 AND csmNo=( 
																  SELECT TOP 1 csmNo FROM cashOrderNo O WHERE O.cnPhase='1' 
																	 AND O.cskKind='0' 
																	 AND O.csCode IN ('A') 
																	 AND csmNo < 1258 
                                                                    AND cnYear=105--1000121 
																  ORDER BY csmNo DESC)),CONVERT(CHAR(10),DS.csmSDate,111)) 
					) AS PreMoney 
                ,(SELECT ISNULL(SUM(cinMoney),0) 
					 FROM CashIn INNER JOIN cashOrderNo O ON O.cnYear=cinYear AND O.cnPhase='2' AND O.cskKind='0' 
					  AND cinNo=O.csmNo AND O.csCode IN ('A') 
				    WHERE cinYear=105 AND--1000121 
					       CONVERT(CHAR(10),cinDate,111) > ISNULL((SELECT CONVERT(CHAR(10),csmEDate,111) FROM cashMain1 WHERE csmYear=105 
																	 AND csmNo=( 
																  SELECT TOP 1 csmNo FROM cashOrderNo O WHERE O.cnPhase='1' 
																	 AND O.cskKind='0' 
																	 AND O.csCode IN ('A') 
																	 AND csmNo < 1258 
                                                                    AND cnYear=105--1000121 
																  ORDER BY csmNo DESC)),CONVERT(CHAR(10),DS.csmSDate,111)) 
															 AND CONVERT(CHAR(10),cinDate,111) <= CONVERT(CHAR(10),csmEDate,111) 
					) AS InMoney 
                , csmMoney AS TotalOutMoney 
                , ( 
					SELECT SUM(B.acvMoney) AS TotalPay 
                   FROM ( 
                   SELECT DISTINCT PV.* 
					FROM   actPayVisa PV 
										  RIGHT OUTER JOIN cashDtl1 C ON  PV.acmYear = C.acmYear And PV.acmNo = C.acmNo And PV.acvNo = C.acvNo 
																	 And PV.acmNo1 = C.acmNo1  And PV.acvNo1 = C.acvNo1 
																	 And PV.acmNo2 = C.acmNo2 And PV.acvNo2 = C.acvNo2 
																	 And PV.acpPayYear = C.acpPayYear And PV.acpPayNo = C.acpPayNo 
                                                                    And PV.acvSubNo = C.acvSubNo 
                                         INNER JOIN cashOrderNo O ON O.cnPhase='1' AND cskKind='0' AND csCode IN ('A') AND C.csmYear=O.cnYear AND C.csmNo=O.csmNo 
					WHERE C.csmYear =105 AND --1000121 
                         C.csmNo < 1258 AND ISNULL(C.csmPassFlag,'1')='1' AND ISNULL(C.csmReturnFlag,'1')='1' 
					AND NOT EXISTS( 
					SELECT 1 FROM 
					( 
						SELECT PV.* 
						FROM   actPayVisa PV 
						  RIGHT OUTER JOIN cashDtl1 C ON  PV.acmYear = C.acmYear And PV.acmNo = C.acmNo And PV.acvNo = C.acvNo 
									 And PV.acmNo1 = C.acmNo1  And PV.acvNo1 = C.acvNo1 
									 And PV.acmNo2 = C.acmNo2 And PV.acvNo2 = C.acvNo2 
									 And PV.acpPayYear = C.acpPayYear And PV.acpPayNo = C.acpPayNo 
									 And PV.acvSubNo = C.acvSubNo 
						 INNER JOIN cashOrderNo O ON O.cnPhase='1' AND cskKind='0' AND csCode IN ('A') AND C.csmYear=O.cnYear AND C.csmNo=O.csmNo 
						WHERE C.csmYear =105 AND --1000121 
                             C.csmNo = 1258 
					) A 
					 WHERE C.acmYear = A.acmYear And C.acmNo = A.acmNo And C.acvNo = A.acvNo 
								 And C.acmNo1 = A.acmNo1  And C.acvNo1 = A.acvNo1 
								 And C.acmNo2 = A.acmNo2 And C.acvNo2 = A.acvNo2 
								 And C.acpPayYear = A.acpPayYear And C.acpPayNo = A.acpPayNo 
								 And C.acvSubNo = A.acvSubNo 
					) 
                   ) B 
				) AS PreTotalPay 
               ,csmKind,(SELECT sysOrgName FROM basBaseData) AS DeptTitle 
               ,(CASE WHEN SUM(DS.acpPayCnt)=0 THEN '' ELSE CONVERT(VARCHAR,SUM(DS.acpPayCnt)) END) AS acpPayCnt 
               ,'' AS acvMemo,'' AS acmWordNum 
               ,MAX(cYear) AS cYear,'' AS cMonth,'' AS cDay 
               ,DS.csmBatchNo 
               ,0 AS acmYear, 0 AS acmNo, 0 AS acvNo, 0 AS acpPayYear, 0 AS acpPayNo, 0 AS acvSubNo 
FROM 
( 
	--第二段 
	SELECT 
			 P.codCodeVer 
			,(CASE WHEN O.oulOutlayCode IS NOT NULL THEN P.plnPlanCode +'.'+ O.oulOutlayCode ELSE P.plnPlanCode END) AS planCode 
			,(CASE WHEN P.plnLevel=3 THEN plnAliasNo 
				   WHEN O.oulOutlayCode IS NOT NULL THEN O.oulOutlayCode 
			  ELSE SUBSTRING(P.plnPlanCode,LEN(P.plnPlanCode)-1,2) END) +' '+ 
			 (CASE WHEN O.oulOutlayCode IS NOT NULL THEN O.oulOutlayName ELSE P.plnPlanName END) + 
			 (CASE WHEN O.oulLevel=1 THEN '-' + SUBSTRING(P.plnPlanCode,LEN(P.plnPlanCode)-1,2) ELSE '' END) AS planname 
			, CD.acvMoney 
			, P.plnplancode,O.oulOutlayCode,ISNULL(oulLevel+1,plnLevel-3) AS Level 
			, csmNo,CD.csmSDate,CD.csmEDate 
           , CD.QcsmSDate,CD.QcsmEDate 
			, CD.csmMoney,CD.csmKind 
			, ISNULL(NULLIF(CD.acpPayCnt,''),1) AS acpPayCnt 
           , CD.acvMemo,CD.acmWordNum,CD.cYear 
			, CD.csmBatchNo 
	FROM 
	( 
		--第一段 
		SELECT 
				 PV.acvOutlayYear, PV.acvPlanCode, SUBSTRING(PV.acvOutlayCode, 1, 8) AS acvOutlayCode 
			   , ISNULL(ISNULL(P.acpSubMemo,PV.acvMemo),P.acpMemo) AS acvMemo, PV.acvMoney,CM.csmMoney 
              , CM.csmSDate, CM.csmEDate 
              , Q.QcsmSDate, Q.QcsmEDate 
			   , CM.csmNo,CM.csmKind, CM.csmBatchNo 
			   , PV.acmYear, PV.acmNo, PV.acvNo, PV.acpPayYear, PV.acpPayNo, PV.acvSubNo 
			   , IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) As acmWordNum 
			   , ISNULL(NULLIF(P.acpPayCnt,''),0) AS acpPayCnt 
			   , YEAR(CM.csmSDate)-1911 AS cYear 
		FROM  cashMain1 CM 
		   JOIN  cashDtl1 CD ON CM.csmYear = CD.csmYear AND  CM.csmNo = CD.csmNo 
		   JOIN  actPayVisa PV ON CD.acmYear = PV.acmYear AND CD.acmNo = PV.acmNo AND  CD.acvNo = PV.acvNo 
						   And CD.acmNo1=PV.acmNo1 And CD.acvNo1=PV.acvNo1 And CD.acmNo2=PV.acmNo2 And CD.acvNo2=PV.acvNo2 
						   And CD.acpPayYear = PV.acpPayYear AND CD.acpPayNo = PV.acpPayNo  AND CD.acvSubNo = PV.acvSubNo 
		   JOIN actPay P On PV.acmYear = P.acmYear AND P.acmNo = IsNull(PV.acmNoPrv, PV.acmNo) AND P.acpPayYear = PV.acpPayYear AND P.acpPayNo = PV.acpPayNo 
		   LEFT JOIN actMain M On M.acmYear=PV.acmYear And M.acmNo=IsNull(PV.acmNoPrv, PV.acmNo) 
           LEFT JOIN (SELECT MAX(D1.csmYear) AS csmYear,MAX(D1.csmNo) AS csmNo 
							   ,MIN(M.csmSDate) AS QcsmSDate,MAX(M.csmSDate) AS QcsmEDate 
							FROM cashDtl1 D1 LEFT JOIN (cashDtl D INNER JOIN cashMain M ON D.csmYear=M.csmYear AND D.csmNo=M.csmNo) 
							ON D1.acmYear=D.acmYear AND D1.acmNo=D.acmNo AND D1.acvNo=D.acvNo AND D1.acmNo1=D.acmNo1 
							AND D1.acvNo1=D.acvNo1 AND D1.acmNo2=D.acmNo2 AND D1.acvNo2=D.acvNo2 
							AND D1.acpPayYear=D.acpPayYear AND D1.acpPayNo=D.acpPayNo AND D1.acvSubNo=D.acvSubNo 
							AND D1.acpPayNo1=D.acpPayNo1 AND D1.acvSubNo1=D.acvSubNo1 
							WHERE D1.csmYear=105 AND D1.csmNo=1258) Q 
					 ON CD.csmYear=Q.csmYear AND CD.csmNo=Q.csmNo 
		WHERE ISNULL(P.acpPayKind,'0') <>'1' AND  CM.csmYear = 105 AND CM.csmNo = 1258 
		--第一段結束 
		) AS CD 
		JOIN codPlanCode P ON CD.acvOutlayYear=P.codCodeVer AND CD.acvPlanCode LIKE P.plnPlanCode + '%' 
         AND (plnLevel >= 3 or isnull(CD.acvOutlayCode,'')='') --AND plnLevel < 5 
		LEFT OUTER JOIN 
		( 
			SELECT codCodeVer,oulOutlayCode,oulOutlayName,oulLevel 
			FROM codOutlayCode 
		)  O 
		ON P.codCodeVer=ISNULL(O.codCodeVer,P.codCodeVer) 
		   AND CD.acvPlanCode = P.plnPlanCode 
           AND CD.acvOutlayCode LIKE ISNULL(O.oulOutlayCode,'')+'%' 
	--第二段結束 
)  DS 
GROUP BY codCodeVer,planCode,Level,DS.csmNo,csmMoney 
        ,csmSDate,csmEDate,csmKind,csmBatchNo 
UNION ALL 
--第三段計算金額 
SELECT DISTINCT  codCodeVer,planCode 
               , MAX(planName) AS planName,acvMoney 
               , 9999 AS SpaceCnt,csmNo 
			    , '中華民國 '+ CONVERT(CHAR(3),YEAR(MAX(QcsmSDate))-1911) +'年 '+ CONVERT(CHAR(2),MONTH(MAX(QcsmSDate))) +'月'+ CONVERT(CHAR(2),DAY(MAX(QcsmSDate))) +'日' + 
				 '至 '+CONVERT(CHAR(3),YEAR(MAX(QcsmEDate))-1911) +'年 '+ CONVERT(CHAR(2),MONTH(MAX(QcsmEDate))) +'月'+ CONVERT(CHAR(2),DAY(MAX(QcsmEDate))) +'日' AS CDate 
               , (SELECT SUM(cinMoney) 
                    FROM CashIn CI INNER JOIN cashOrderNo O 
                      ON O.cnPhase='2' AND O.csCode IN ('A') 
                     AND O.cskKind='0' AND CI.cinYear=O.cnYear AND CI.cinNo=O.csmNo 
				    WHERE cinYear=105 AND--1000121 
                         CONVERT(CHAR(10),cinDate,111) 
                         <= ISNULL((SELECT CONVERT(CHAR(10),csmEDate,111) FROM cashMain1 WHERE csmYear=105 
									     AND csmNo=( 
									  SELECT TOP 1 csmNo FROM cashOrderNo O WHERE O.cnPhase='1' 
									     AND O.cskKind='0' 
									     AND O.csCode IN ('A') 
									     AND csmNo < 1258 
                                        AND cnYear=105--1000121 
									  ORDER BY csmNo DESC)),CONVERT(CHAR(10),DS.csmSDate,111)) 
                  ) AS PreMoney 
                , (SELECT ISNULL(SUM(cinMoney),0) 
					 FROM CashIn INNER JOIN cashOrderNo O ON O.cnYear=cinYear AND O.cnPhase='2' AND O.cskKind='0' 
					  AND cinNo=O.csmNo AND O.csCode IN ('A') 
				    WHERE cinYear=105 AND--1000121 
					      CONVERT(CHAR(10),cinDate,111) 
                          > ISNULL((SELECT CONVERT(CHAR(10),csmEDate,111) FROM cashMain1 WHERE csmYear=105 
										 AND csmNo=( 
									  SELECT TOP 1 csmNo FROM cashOrderNo O WHERE O.cnPhase='1' 
										 AND O.cskKind='0' 
										 AND O.csCode IN ('A') 
										 AND csmNo < 1258 
                                        AND cnYear=105--1000121 
									  ORDER BY csmNo DESC)),CONVERT(CHAR(10),DS.csmSDate,111)) 
								 AND CONVERT(CHAR(10),cinDate,111) <= CONVERT(CHAR(10),csmEDate,111) 
                   ) AS InMoney 
                , csmMoney AS TotalOutMoney 
                , ( 
					SELECT SUM(B.acvMoney) AS TotalPay 
                      FROM ( 
						   SELECT DISTINCT PV.* 
							FROM   actPayVisa PV 
										  RIGHT OUTER JOIN cashDtl1 C ON  PV.acmYear = C.acmYear And PV.acmNo = C.acmNo And PV.acvNo = C.acvNo 
																	 And PV.acmNo1 = C.acmNo1  And PV.acvNo1 = C.acvNo1 
																	 And PV.acmNo2 = C.acmNo2 And PV.acvNo2 = C.acvNo2 
																	 And PV.acpPayYear = C.acpPayYear And PV.acpPayNo = C.acpPayNo 
                                                                    And PV.acvSubNo = C.acvSubNo 
                                         INNER JOIN cashOrderNo O ON O.cnPhase='1' AND cskKind='0' AND csCode IN ('A') AND C.csmYear=O.cnYear AND C.csmNo=O.csmNo 
					WHERE C.csmYear =105 AND --1000121
                         C.csmNo < 1258 AND ISNULL(C.csmPassFlag,'1')='1' AND ISNULL(C.csmReturnFlag,'1')='1' 
					AND NOT EXISTS( 
						SELECT 1 FROM 
						( 
							SELECT PV.* 
							FROM   actPayVisa PV 
							  RIGHT OUTER JOIN cashDtl1 C ON  PV.acmYear = C.acmYear And PV.acmNo = C.acmNo And PV.acvNo = C.acvNo 
										 And PV.acmNo1 = C.acmNo1  And PV.acvNo1 = C.acvNo1 
										 And PV.acmNo2 = C.acmNo2 And PV.acvNo2 = C.acvNo2 
										 And PV.acpPayYear = C.acpPayYear And PV.acpPayNo = C.acpPayNo 
										 And PV.acvSubNo = C.acvSubNo 
							 INNER JOIN cashOrderNo O ON O.cnPhase='1' AND cskKind='0' AND csCode IN ('A') AND C.csmYear=O.cnYear AND C.csmNo=O.csmNo 
							WHERE  C.csmYear =105 AND --1000121 
                                  C.csmNo = 1258 
						) A 
						 WHERE C.acmYear = A.acmYear And C.acmNo = A.acmNo And C.acvNo = A.acvNo 
									 And C.acmNo1 = A.acmNo1  And C.acvNo1 = A.acvNo1 
									 And C.acmNo2 = A.acmNo2 And C.acvNo2 = A.acvNo2 
									 And C.acpPayYear = A.acpPayYear And C.acpPayNo = A.acpPayNo 
									 And C.acvSubNo = A.acvSubNo 
						) 
					   ) B 
				  ) AS PreTotalPay 
                ,csmKind 
                ,(SELECT sysOrgName FROM basBaseData) AS DeptTitle 
                ,(CASE WHEN DS.acpPayCnt=0 THEN '' ELSE CONVERT(VARCHAR,DS.acpPayCnt) END) AS acpPayCnt 
                ,DS.acvMemo,DS.acmWordNum 
                ,CONVERT(VARCHAR,DS.cYear) AS cYear ,CONVERT(VARCHAR,DS.cMonth) AS cMonth ,CONVERT(VARCHAR,DS.cDay) AS cDay 
                ,DS.csmBatchNo 
                ,DS.acmYear, DS.acmNo, DS.acvNo, DS.acpPayYear, DS.acpPayNo, DS.acvSubNo 
FROM 
( 
	--第二段JOIN計畫及用途別的科目名稱及代碼 
	SELECT 
			 P.codCodeVer 
			,(CASE WHEN O.oulOutlayCode IS NOT NULL THEN P.plnPlanCode +'.'+ O.oulOutlayCode ELSE P.plnPlanCode END) AS planCode 
			,(CASE WHEN P.plnLevel=3 THEN plnAliasNo 
				   WHEN O.oulOutlayCode IS NOT NULL THEN O.oulOutlayCode 
			  ELSE SUBSTRING(P.plnPlanCode,LEN(P.plnPlanCode)-1,2) END) +' '+ 
			 (CASE WHEN O.oulOutlayCode IS NOT NULL THEN O.oulOutlayName ELSE P.plnPlanName END) + 
			 (CASE WHEN O.oulLevel=1 THEN '-' + SUBSTRING(P.plnPlanCode,LEN(P.plnPlanCode)-1,2) ELSE '' END) AS planname 
			, CD.acvMoney 
			, P.plnplancode,O.oulOutlayCode,ISNULL(oulLevel+1,plnLevel-3) AS Level 
           , csmNo,CD.csmSDate,CD.csmEDate 
           , CD.QcsmSDate,CD.QcsmEDate 
			, CD.csmMoney,CD.csmKind ,CD.acpPayCnt,CD.acvMemo,CD.acmWordNum 
			, CD.cYear,CD.cMonth,CD.cDay 
			, CD.csmBatchNo 
			, CD.acmYear, CD.acmNo, CD.acvNo, CD.acpPayYear, CD.acpPayNo, CD.acvSubNo 
	FROM 
	( 
		--第一段零用金清單左方之日期改撈「支付日期」
		SELECT 
				 PV.acvOutlayYear, PV.acvPlanCode, SUBSTRING(PV.acvOutlayCode, 1, 8) AS acvOutlayCode 
			   , ISNULL(PV.acvMemo,P.acpMemo) AS acvMemo, PV.acvMoney, CM.csmMoney 
              , CM.csmSDate,CM.csmEDate 
              , Q.csmSDate AS QcsmSDate,Q.csmEDate AS QcsmEDate 
			   , CM.csmNo,CM.csmKind, CM.csmBatchNo 
			   , PV.acmYear, PV.acmNo, PV.acvNo, PV.acpPayYear, PV.acpPayNo, PV.acvSubNo 
			   , ISNULL(NULLIF(P.acpPayCnt,''),1) AS acpPayCnt 
			   , IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) 
				 + ISNULL('-'+CONVERT(VARCHAR,(SELECT TOP 1 acmNo1 FROM actMain1 M1 WHERE M1.acmYear=M.acmYear AND M1.acmNo=M.acmNo)),'')  As acmWordNum 
			   , YEAR(DM.csmSDate)-1911 AS cYear,MONTH(DM.csmSDate) AS cMonth,DAY(DM.csmSDate) AS cDay 
		FROM  cashMain1 CM 
		   JOIN  cashDtl1 CD ON CM.csmYear = CD.csmYear AND  CM.csmNo = CD.csmNo 
		   JOIN  actPayVisa PV ON CD.acmYear = PV.acmYear AND CD.acmNo = PV.acmNo AND  CD.acvNo = PV.acvNo 
						   And CD.acmNo1=PV.acmNo1 And CD.acvNo1=PV.acvNo1 And CD.acmNo2=PV.acmNo2 And CD.acvNo2=PV.acvNo2 
						   And CD.acpPayYear = PV.acpPayYear AND CD.acpPayNo = PV.acpPayNo  AND CD.acvSubNo = PV.acvSubNo 
		   JOIN actPay P On PV.acmYear = P.acmYear AND P.acmNo = IsNull(PV.acmNoPrv, PV.acmNo) AND P.acpPayYear = PV.acpPayYear AND P.acpPayNo = PV.acpPayNo 
		   LEFT JOIN actMain M On M.acmYear=PV.acmYear And M.acmNo=IsNull(PV.acmNoPrv, PV.acmNo) 
		   LEFT JOIN (cashDtl D INNER JOIN cashMain DM ON D.csmYear=DM.csmYear AND D.csmNo=DM.csmNo) 
				ON CD.acmYear=D.acmYear AND CD.acmNo=D.acmNo AND CD.acvNo=D.acvNo AND CD.acmNo1=D.acmNo1 
				AND CD.acvNo1=D.acvNo1 AND CD.acmNo2=D.acmNo2 AND CD.acvNo2=D.acvNo2 
				AND CD.acpPayYear=D.acpPayYear AND CD.acpPayNo=D.acpPayNo AND CD.acvSubNo=D.acvSubNo 
				AND CD.acpPayNo1=D.acpPayNo1 AND CD.acvSubNo1=D.acvSubNo1 
          LEFT JOIN (SELECT MAX(D1.csmYear) AS csmYear,MAX(D1.csmNo) AS csmNo 
                      ,MIN(M.csmSDate) AS csmSDate,MAX(M.csmSDate) AS csmEDate 
					FROM cashDtl1 D1 LEFT JOIN (cashDtl D INNER JOIN cashMain M ON D.csmYear=M.csmYear AND D.csmNo=M.csmNo) 
					ON D1.acmYear=D.acmYear AND D1.acmNo=D.acmNo AND D1.acvNo=D.acvNo AND D1.acmNo1=D.acmNo1 
					AND D1.acvNo1=D.acvNo1 AND D1.acmNo2=D.acmNo2 AND D1.acvNo2=D.acvNo2 
					AND D1.acpPayYear=D.acpPayYear AND D1.acpPayNo=D.acpPayNo AND D1.acvSubNo=D.acvSubNo 
					AND D1.acpPayNo1=D.acpPayNo1 AND D1.acvSubNo1=D.acvSubNo1 
					WHERE D1.csmYear=105 AND D1.csmNo=1258) Q 
            ON CD.csmYear=Q.csmYear AND CD.csmNo=Q.csmNo 
		WHERE ISNULL(P.acpPayKind,'0') <>'1' AND  CM.csmYear = 105 AND CM.csmNo = 1258 
		--第一段結束 
	) AS CD 
	JOIN codPlanCode P ON CD.acvOutlayYear=P.codCodeVer AND CD.acvPlanCode = P.plnPlanCode AND (plnLevel >= 3 or isnull(CD.acvOutlayCode,'')='') --AND plnLevel < 5 
	LEFT OUTER JOIN 
	( 
		SELECT codCodeVer,oulOutlayCode,oulOutlayName,oulLevel 
		FROM codOutlayCode 
	)  O 
	ON P.codCodeVer=ISNULL(O.codCodeVer,P.codCodeVer) 
	   AND CD.acvPlanCode = P.plnPlanCode AND CD.acvOutlayCode = ISNULL(O.oulOutlayCode,'') 
	--第二段結束 
)  DS 
GROUP BY codCodeVer,planCode,acvMoney,Level,csmNo,csmMoney,csmSDate,csmEDate,csmKind,DS.acpPayCnt,DS.acvMemo,acmWordNum,DS.cYear,DS.cMonth,DS.cDay,DS.csmBatchNo 
         ,DS.acmYear, DS.acmNo, DS.acvNo, DS.acpPayYear, DS.acpPayNo, DS.acvSubNo 
ORDER BY codCodeVer,planCode,SpaceCnt 

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:49:50#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9d244fb1d8d7695dcf16e1cc966a628d
 Select * From view_photomember Where EMAIL='shonhaw@cdc.gov.tw'
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:49:50#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9d244fb1d8d7695dcf16e1cc966a628d
 Select * From codExchangeDepCode Where excDepCode='001001014003005'
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:49:50#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9d244fb1d8d7695dcf16e1cc966a628d
 Update sysBaseUser Set depCode='403' Where usrAlias='shonhaw' And depCode <>'403'
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:49:50#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9d244fb1d8d7695dcf16e1cc966a628d
--[Parameter Count:2]
--@parUsrPwd=''
--@parUserID='shonhaw'
SELECT  PK_usrNo, usrAlias, usrPwd, usrName, usrUserID, payKind, payCode, usrTel  , usrEmail, usrGroup, usrLevel, usrLoginDTime, usrLogoutDTime, usrDefYear  , usrDefMonth, usrTeamCode, usrPrnPath, usrAgentUsrNo, usrAgentSDate  , usrAgentEDate, usrStateKind, CreateDTime, CreateUser, ModifyDTime  , ModifyUser , T.teaName, BU.depCode,  WD.dptName As DepName  FROM sysBaseUser BU  Left Join codTeamName T On BU.usrTeamCode = T.teaCode Left Join codDepartName WD On WD.dptCode=BU.depCode 
 Where  1=1  And usrAlias ='shonhaw' 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:49:50#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9d244fb1d8d7695dcf16e1cc966a628d
 Select sysCloseDate From basBaseData 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:49:51#  http://gbceap.cdc.gov.tw/CDCGBCE/intro.aspx
SELECT 'Powered by Microsoft SQL Server ' + CONVERT(nvarchar,SERVERPROPERTY('ProductVersion')) + ' ' + CONVERT(nvarchar,SERVERPROPERTY('ProductLevel'))
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:49:51#  http://gbceap.cdc.gov.tw/CDCGBCE/Menu.aspx
SELECT DISTINCT (SELECT TOP 1 A2.PK_MnuNo  FROM  sysUserPower C2 INNER JOIN  sysGroupData D2 ON C2.PK_grpNo = D2.PK_grpNo INNER JOIN  sysMenuBase A2 ON A2.PK_MnuNo = D2.PK_mnuNo WHERE  (C2.PK_usrNo = 872)  AND ISNULL(mnuLevel,0)> -90 AND (ISNULL(mnuLevel,0)=0 OR mnuLevel >=9 OR mnuLevel=9*-1 OR mnuLevel<=-90)  AND A.PK_MnuNo LIKE A2.PK_MnuNo + '_%'  ORDER BY  A2.PK_MnuNo DESC) AS ParentPK_MnuNo, A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 872) AND ISNULL(mnuLevel,0)> -90 AND (ISNULL(mnuLevel,0)=0 OR mnuLevel >=9 OR mnuLevel=9*-1 OR mnuLevel<=-90)  ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
--[Parameter Count:1]
--@parMenuID='1411'
 Select * From SysMenuBase Where PK_MnuNo ='1411' 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  and  dptCode = '403' AND (ISNULL( A.dptCreateDate,'') <='2017/01/31' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '2017/01/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select Distinct *   
 , IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) As TopWordNum  
           From ( 
 SELECT Distinct  Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As FullAcmWordNum 
               , M.acmWorkUserNo, M.acmMoney 
               , M.acmMemo, M.acmModifyUser  
               , M.acmPassUser, M.acmPassDate 
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate 
               , M.acmPassMoney, M.acmPassMemo 
               , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
               , (Select Top 1 acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
               , (Select Top 1 acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
               , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
               , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
               , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
               , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo ) as PCounter 
               , IsNull( M.acmBgtKind ,'0') As acmBgtKind  
               , M.acmSubsidyCode, M.acmEmpNo, M.acmUnitPassFlag, M.acmUnitPassDate, M.acmUnitPassUser, M.acmPayName 
               , M.acmVisaKindCode, VK.vskName, M.acmProdMethodCode,  PM.pcmName, M.acmEtcPayment  
               , M.acmAutoBidFlag, M.acmAutoPrePayFlag, M.acmReadyFlag, M.acmProdDepCode, M.acmBaseItemsKindCode, M.acmSubMemo 
               , BI.baiName, M.acmPayHour As acpPayHour, M.acmReturnDate As acpReturnDate, M.acmPrePayDate As acpPrePayDate 
               , M.acmRequireDepCode, acmRequireUserName, (Select dptName From codDepartName Where dptCode =M.acmRequireDepCode) As acmRequireDepName 
               , M.acmCateGrpFlag, M.acmRequireDate, M.acmSelfProdFlag 
               , M.acmReserveFlag, M.acmReserveWordNum 
               , M.acmActKind ,M.acmPayeeNo , M.acmTrlAppCode
               ,(Select ISNULL((CONVERT(nvarchar(120), T.plnTrlAppCode)+' '+T.plnTrlAppName),'') as plnTrlAppName From actPlanApproval as T Where T.acmYear=M.acmYear And T.plnTrlAppCode=M.acmTrlAppCode ) As acmTrlAppName  
  FROM (actMain M Join actVisa V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
 Left Join codAccKindName K On 
 IsNull( V.acvAccKind,'') = K.accKind 
 Left Join codVisaKind VK On 
 M.acmVisaKindCode=VK.vskCode  Left Join codProdMethod PM On 
 M.acmProdMethodCode=PM.pcmCode  Left Join codBaseItems BI On 
 M.acmProdDepCode=BI.baiCode And M.acmBaseItemsKindCode=BI.bakCode    WHERE 1 = 1   And   M.acmYear =106 And ( 1=1 
 And  M.acmMonth <= 1 And  M.acmWorkUnitNo  = '403'
 And IsNull(M.acmKidNum, '') =''
 And IsNull(M.acmUnitPassFlag,'0')='0'
 )  Order by  M.acmYear, IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) Desc, M.acmNo 
 Union All 
 SELECT Distinct  Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As FullAcmWordNum 
               , M.acmWorkUserNo, M.acmMoney 
               , M.acmMemo, M.acmModifyUser  
               , M.acmPassUser, M.acmPassDate 
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate 
               , M.acmPassMoney, M.acmPassMemo 
               , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
               , (Select Top 1 acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
               , (Select Top 1 acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
               , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
               , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
               , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
               , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo ) as PCounter 
               , IsNull( M.acmBgtKind ,'0') As acmBgtKind  
               , M.acmSubsidyCode, M.acmEmpNo, M.acmUnitPassFlag, M.acmUnitPassDate, M.acmUnitPassUser, M.acmPayName 
               , M.acmVisaKindCode, VK.vskName, M.acmProdMethodCode,  PM.pcmName, M.acmEtcPayment  
               , M.acmAutoBidFlag, M.acmAutoPrePayFlag, M.acmReadyFlag, M.acmProdDepCode, M.acmBaseItemsKindCode, M.acmSubMemo 
               , BI.baiName, M.acmPayHour As acpPayHour, M.acmReturnDate As acpReturnDate, M.acmPrePayDate As acpPrePayDate 
               , M.acmRequireDepCode, acmRequireUserName, (Select dptName From codDepartName Where dptCode =M.acmRequireDepCode) As acmRequireDepName 
               , M.acmCateGrpFlag, M.acmRequireDate, M.acmSelfProdFlag 
               , M.acmReserveFlag, M.acmReserveWordNum 
               , M.acmActKind ,M.acmPayeeNo , M.acmTrlAppCode
               ,(Select ISNULL((CONVERT(nvarchar(120), T.plnTrlAppCode)+' '+T.plnTrlAppName),'') as plnTrlAppName From actPlanApproval as T Where T.acmYear=M.acmYear And T.plnTrlAppCode=M.acmTrlAppCode ) As acmTrlAppName  
  FROM (actMain M Join actVisaMore V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
 Left Join codAccKindName K On 
 IsNull( V.acvAccKind,'') = K.accKind 
 Left Join codVisaKind VK On 
 M.acmVisaKindCode=VK.vskCode  Left Join codProdMethod PM On 
 M.acmProdMethodCode=PM.pcmCode  Left Join codBaseItems BI On 
 M.acmProdDepCode=BI.baiCode And M.acmBaseItemsKindCode=BI.bakCode    WHERE 1 = 1   And   M.acmYear =106 And ( 1=1 
 And  M.acmMonth <= 1 And  M.acmWorkUnitNo  = '403'
 And IsNull(M.acmKidNum, '') =''
 And IsNull(M.acmUnitPassFlag,'0')='0'
 )  Order by  M.acmYear, IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) Desc, M.acmNo 
 ) DS 
 Order By  acmYear, IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) Desc, acmNo 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select  * 
       From attKind K  
           Join attInheritModule I ON I.atiCode = K.atkAtiCode  
       Where  '{墊借申請}' like '%' + I.atiName + '%'
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select  * 
       From attKind K  
           Join attInheritModule I ON I.atiCode = K.atkAtiCode  
       Where  '{墊借申請}' like '%' + I.atiName + '%'
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName                   , BZ.bizName, BD.dptName As BgtDepName 
                  , M.acmBgtUnitNo, M.acmWorkUnitNo 
                  ,  VisaMoneyLeft                   ,  TotalPayThisTime                    , V.acvBgtDepCode, BDV.dptName As acvBgtDepName  
                   , V.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, plnPlanCode) As plnAliasNo  
                   , V.acvCostKind, CK.cskName As CostKindName, V.acvBgtSourCnt  
 From ( Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , IsNull( V.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo And V1D.acmNo1=0), 0)   As TotalPayThisTime 
                   , V.acvBgtDepCode  
                   , V.acvPlanCateCode 
                   , V.acvCostKind, V.acvBgtSourCnt 
       From actVisa V 
       Where V.acmYear=106 And V.acmNo=0
   Union 
       Select  
                    VM.acmYear, VM.acmNo, VM.acvNo, VM.acvBgtYear, VM.acvBgtMonth, VM.acvPlanCode 
                  , VM.acvOutlayYear, VM.acvOutlayCode, VM.acvBgtSourceCode, VM.acvAccKind 
                  , VM.acvBizCode, VM.acvPrePayFlag, VM.acvMoney, VM.acvMemo, VM.acmNoPrv  
                  , VM.inspect, VM.acvPassAdjustMoney, VM.acvNextYearFlag, VM.acvBgtKindSet  
                  , IsNull( VM.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo And V1MD.acmNo1=0), 0)   As TotalPayThisTime 
                   , VM.acvBgtDepCode 
                   , VM.acvPlanCateCode  
                   , VM.acvCostKind, VM.acvBgtSourCnt  
  From actVisaMore VM 
       Where VM.acmYear=106 And VM.acmNo=0
 ) V 
          Join actMain M On  M.acmYear = 106 And M.acmYear=V.acmYear And M.acmNo=V.acmNo 
   And V.acmNo=0
 Left Join codAccKindName K On   IsNull(V.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(V.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( V.acvPlanCode,'') = PN.plnPlanCode   And IsNull(V.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  V.acvOutlayCode = O.oulOutlayCode   And V.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(V.acvBizCode,'' ) = BZ.BizCode  And IsNull(V.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo)   
 Left Join codDepartName BDV On  BDV.dptCode  =  IsNull(V.acvBgtDepCode, IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo))   
 Left Join codPlanCategory PC On PC.plnCateCode=IsNull(V.acvPlanCateCode,'')  
 Left Join codCostKind CK On CK.cskCode= V.acvCostKind 
 Where 1=1      Order By  V.acmNo, V.acvNo 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select  Distinct 
                    DP.acmYear, DP.acmNo, DP.acmNo1, DP.acdNo, DP.acdProdCode  
                  , DP.acdProdName, DP.acdProdRule, DP.acdProdSup, DP.acdProdUnit 
                  , DP.acdProdQry, DP.acdMemo, DP.acdProdPrice, DP.acdMoney  
                  , DP.acdProdPriceFac1, DP.acdProdMoneyFac1, DP.acdProdPriceFac2   
                  , DP.acdProdMoneyFac2, DP.acdProdPriceFac3, DP.acdProdMoneyFac3   
                  , MP.acmProdFactory 
                  , MP.acmProdFactory1, MP.acmProdFactory2, MP.acmProdFactory3  
                  , MP.acmProdMoney 
                  , MP.acmProdMoney1, MP.acmProdMoney2, MP.acmProdMoney3  
                  , MP.acmProdChkDate     
               , DP.acdProdCause,  PC.prcName As acdProdCauseName 
          From  actDtlProd DP    
                          Left Join actMainProd MP ON DP.acmYear = MP.acmYear AND DP.acmNo = MP.acmNo AND DP.acmNo1 = MP.acmNo1  
 Left Join codProdCause PC On PC.prcCode=DP.acdProdCause 
 Where 1=1 And DP.acmYear =1 And DP.acmNo =1 And DP.acmNo1=1 Order By  1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
Select *   FROM actMainProd    Where acmYear =1 And acmNo=1 And acmNo1=1 Order By  1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select Distinct atkCode, atkName 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=0
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And 1=2 
                   And TM.atkCode In ('01', '02') And 1=2                    ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=0
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
 And 1=2 )  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select Distinct atmCode, atmName, atkCode 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=0
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And 1=2 
                   And TM.atkCode In ('01', '02') And 1=2                    ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=0
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
 And 1=2 )  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select Distinct atdNo, atdNameHtml, atmCode 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=0
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And 1=2 
                   And TM.atkCode In ('01', '02') And 1=2                    ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=0
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
 And 1=2 )  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select Distinct *   
 , IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) As TopWordNum  
           From ( 
 SELECT Distinct  Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As FullAcmWordNum 
               , M.acmWorkUserNo, M.acmMoney 
               , M.acmMemo, M.acmModifyUser  
               , M.acmPassUser, M.acmPassDate 
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate 
               , M.acmPassMoney, M.acmPassMemo 
               , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
               , (Select Top 1 acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
               , (Select Top 1 acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
               , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
               , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
               , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
               , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo ) as PCounter 
               , IsNull( M.acmBgtKind ,'0') As acmBgtKind  
               , M.acmSubsidyCode, M.acmEmpNo, M.acmUnitPassFlag, M.acmUnitPassDate, M.acmUnitPassUser, M.acmPayName 
               , M.acmVisaKindCode, VK.vskName, M.acmProdMethodCode,  PM.pcmName, M.acmEtcPayment  
               , M.acmAutoBidFlag, M.acmAutoPrePayFlag, M.acmReadyFlag, M.acmProdDepCode, M.acmBaseItemsKindCode, M.acmSubMemo 
               , BI.baiName, M.acmPayHour As acpPayHour, M.acmReturnDate As acpReturnDate, M.acmPrePayDate As acpPrePayDate 
               , M.acmRequireDepCode, acmRequireUserName, (Select dptName From codDepartName Where dptCode =M.acmRequireDepCode) As acmRequireDepName 
               , M.acmCateGrpFlag, M.acmRequireDate, M.acmSelfProdFlag 
               , M.acmReserveFlag, M.acmReserveWordNum 
               , M.acmActKind ,M.acmPayeeNo , M.acmTrlAppCode
               ,(Select ISNULL((CONVERT(nvarchar(120), T.plnTrlAppCode)+' '+T.plnTrlAppName),'') as plnTrlAppName From actPlanApproval as T Where T.acmYear=M.acmYear And T.plnTrlAppCode=M.acmTrlAppCode ) As acmTrlAppName  
  FROM (actMain M Join actVisa V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
 Left Join codAccKindName K On 
 IsNull( V.acvAccKind,'') = K.accKind 
 Left Join codVisaKind VK On 
 M.acmVisaKindCode=VK.vskCode  Left Join codProdMethod PM On 
 M.acmProdMethodCode=PM.pcmCode  Left Join codBaseItems BI On 
 M.acmProdDepCode=BI.baiCode And M.acmBaseItemsKindCode=BI.bakCode    WHERE 1 = 1   And   M.acmYear =106 And ( 1=1 
 And  M.acmNo =868
  And M.acmWordNum='10600553'
 )  Order by  M.acmYear, IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) Desc, M.acmNo 
 Union All 
 SELECT Distinct  Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As FullAcmWordNum 
               , M.acmWorkUserNo, M.acmMoney 
               , M.acmMemo, M.acmModifyUser  
               , M.acmPassUser, M.acmPassDate 
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate 
               , M.acmPassMoney, M.acmPassMemo 
               , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
               , (Select Top 1 acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
               , (Select Top 1 acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
               , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
               , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
               , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
               , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo ) as PCounter 
               , IsNull( M.acmBgtKind ,'0') As acmBgtKind  
               , M.acmSubsidyCode, M.acmEmpNo, M.acmUnitPassFlag, M.acmUnitPassDate, M.acmUnitPassUser, M.acmPayName 
               , M.acmVisaKindCode, VK.vskName, M.acmProdMethodCode,  PM.pcmName, M.acmEtcPayment  
               , M.acmAutoBidFlag, M.acmAutoPrePayFlag, M.acmReadyFlag, M.acmProdDepCode, M.acmBaseItemsKindCode, M.acmSubMemo 
               , BI.baiName, M.acmPayHour As acpPayHour, M.acmReturnDate As acpReturnDate, M.acmPrePayDate As acpPrePayDate 
               , M.acmRequireDepCode, acmRequireUserName, (Select dptName From codDepartName Where dptCode =M.acmRequireDepCode) As acmRequireDepName 
               , M.acmCateGrpFlag, M.acmRequireDate, M.acmSelfProdFlag 
               , M.acmReserveFlag, M.acmReserveWordNum 
               , M.acmActKind ,M.acmPayeeNo , M.acmTrlAppCode
               ,(Select ISNULL((CONVERT(nvarchar(120), T.plnTrlAppCode)+' '+T.plnTrlAppName),'') as plnTrlAppName From actPlanApproval as T Where T.acmYear=M.acmYear And T.plnTrlAppCode=M.acmTrlAppCode ) As acmTrlAppName  
  FROM (actMain M Join actVisaMore V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
 Left Join codAccKindName K On 
 IsNull( V.acvAccKind,'') = K.accKind 
 Left Join codVisaKind VK On 
 M.acmVisaKindCode=VK.vskCode  Left Join codProdMethod PM On 
 M.acmProdMethodCode=PM.pcmCode  Left Join codBaseItems BI On 
 M.acmProdDepCode=BI.baiCode And M.acmBaseItemsKindCode=BI.bakCode    WHERE 1 = 1   And   M.acmYear =106 And ( 1=1 
 And  M.acmNo =868
  And M.acmWordNum='10600553'
 )  Order by  M.acmYear, IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) Desc, M.acmNo 
 ) DS 
 Order By  acmYear, IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) Desc, acmNo 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select M.acmWordNum 
           From actMain M 
       Where  IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) ='10600553'               And acmWordNum <> '10600553'
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName                   , BZ.bizName, BD.dptName As BgtDepName 
                  , M.acmBgtUnitNo, M.acmWorkUnitNo 
                  ,  VisaMoneyLeft                   ,  TotalPayThisTime                    , V.acvBgtDepCode, BDV.dptName As acvBgtDepName  
                   , V.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, plnPlanCode) As plnAliasNo  
                   , V.acvCostKind, CK.cskName As CostKindName, V.acvBgtSourCnt  
 From ( Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , IsNull( V.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo And V1D.acmNo1=0), 0)   As TotalPayThisTime 
                   , V.acvBgtDepCode  
                   , V.acvPlanCateCode 
                   , V.acvCostKind, V.acvBgtSourCnt 
       From actVisa V 
       Where V.acmYear=106 And V.acmNo=868
   Union 
       Select  
                    VM.acmYear, VM.acmNo, VM.acvNo, VM.acvBgtYear, VM.acvBgtMonth, VM.acvPlanCode 
                  , VM.acvOutlayYear, VM.acvOutlayCode, VM.acvBgtSourceCode, VM.acvAccKind 
                  , VM.acvBizCode, VM.acvPrePayFlag, VM.acvMoney, VM.acvMemo, VM.acmNoPrv  
                  , VM.inspect, VM.acvPassAdjustMoney, VM.acvNextYearFlag, VM.acvBgtKindSet  
                  , IsNull( VM.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo And V1MD.acmNo1=0), 0)   As TotalPayThisTime 
                   , VM.acvBgtDepCode 
                   , VM.acvPlanCateCode  
                   , VM.acvCostKind, VM.acvBgtSourCnt  
  From actVisaMore VM 
       Where VM.acmYear=106 And VM.acmNo=868
 ) V 
          Join actMain M On  M.acmYear = 106 And M.acmYear=V.acmYear And M.acmNo=V.acmNo 
   And V.acmNo=868
 Left Join codAccKindName K On   IsNull(V.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(V.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( V.acvPlanCode,'') = PN.plnPlanCode   And IsNull(V.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  V.acvOutlayCode = O.oulOutlayCode   And V.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(V.acvBizCode,'' ) = BZ.BizCode  And IsNull(V.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo)   
 Left Join codDepartName BDV On  BDV.dptCode  =  IsNull(V.acvBgtDepCode, IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo))   
 Left Join codPlanCategory PC On PC.plnCateCode=IsNull(V.acvPlanCateCode,'')  
 Left Join codCostKind CK On CK.cskCode= V.acvCostKind 
 Where 1=1      Order By  V.acmNo, V.acvNo 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:01#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select  Distinct 
                    DP.acmYear, DP.acmNo, DP.acmNo1, DP.acdNo, DP.acdProdCode  
                  , DP.acdProdName, DP.acdProdRule, DP.acdProdSup, DP.acdProdUnit 
                  , DP.acdProdQry, DP.acdMemo, DP.acdProdPrice, DP.acdMoney  
                  , DP.acdProdPriceFac1, DP.acdProdMoneyFac1, DP.acdProdPriceFac2   
                  , DP.acdProdMoneyFac2, DP.acdProdPriceFac3, DP.acdProdMoneyFac3   
                  , MP.acmProdFactory 
                  , MP.acmProdFactory1, MP.acmProdFactory2, MP.acmProdFactory3  
                  , MP.acmProdMoney 
                  , MP.acmProdMoney1, MP.acmProdMoney2, MP.acmProdMoney3  
                  , MP.acmProdChkDate     
               , DP.acdProdCause,  PC.prcName As acdProdCauseName 
          From  actDtlProd DP    
                          Left Join actMainProd MP ON DP.acmYear = MP.acmYear AND DP.acmNo = MP.acmNo AND DP.acmNo1 = MP.acmNo1  
 Left Join codProdCause PC On PC.prcCode=DP.acdProdCause 
 Where 1=1 And DP.acmYear =106 And DP.acmNo =868 And DP.acmNo1=0 Order By  1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:02#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
Select *   FROM actMainProd    Where acmYear =106 And acmNo=868 And acmNo1=0 Order By  1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:02#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select Distinct atkCode, atkName 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=868
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And 1=2 
                   And TM.atkCode In ('01', '02')                   ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=868
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
)  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:02#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select Distinct atmCode, atmName, atkCode 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=868
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And 1=2 
                   And TM.atkCode In ('01', '02')                   ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=868
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
)  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:02#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdApply.Web/FrmActApply.aspx?MenuID=1411
 Select Distinct atdNo, atdNameHtml, atmCode 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=868
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And 1=2 
                   And TM.atkCode In ('01', '02')                   ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=868
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
)  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:15#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=6447999d9cb847bad1622387aa122d0c
 Select * From view_photomember Where EMAIL='fone@cdc.gov.tw'
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:15#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=6447999d9cb847bad1622387aa122d0c
 Select * From codExchangeDepCode Where excDepCode='001001015005'
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:15#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=6447999d9cb847bad1622387aa122d0c
 Update sysBaseUser Set depCode='405' Where usrAlias='fone' And depCode <>'405'
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:15#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=6447999d9cb847bad1622387aa122d0c
--[Parameter Count:2]
--@parUsrPwd=''
--@parUserID='fone'
SELECT  PK_usrNo, usrAlias, usrPwd, usrName, usrUserID, payKind, payCode, usrTel  , usrEmail, usrGroup, usrLevel, usrLoginDTime, usrLogoutDTime, usrDefYear  , usrDefMonth, usrTeamCode, usrPrnPath, usrAgentUsrNo, usrAgentSDate  , usrAgentEDate, usrStateKind, CreateDTime, CreateUser, ModifyDTime  , ModifyUser , T.teaName, BU.depCode,  WD.dptName As DepName  FROM sysBaseUser BU  Left Join codTeamName T On BU.usrTeamCode = T.teaCode Left Join codDepartName WD On WD.dptCode=BU.depCode 
 Where  1=1  And usrAlias ='fone' 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:15#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=6447999d9cb847bad1622387aa122d0c
 Select sysCloseDate From basBaseData 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:15#  http://gbceap.cdc.gov.tw/CDCGBCE/Menu.aspx
SELECT DISTINCT (SELECT TOP 1 A2.PK_MnuNo  FROM  sysUserPower C2 INNER JOIN  sysGroupData D2 ON C2.PK_grpNo = D2.PK_grpNo INNER JOIN  sysMenuBase A2 ON A2.PK_MnuNo = D2.PK_mnuNo WHERE  (C2.PK_usrNo = 429)  AND ISNULL(mnuLevel,0)> -90 AND (ISNULL(mnuLevel,0)=0 OR mnuLevel >=9 OR mnuLevel=9*-1 OR mnuLevel<=-90)  AND A.PK_MnuNo LIKE A2.PK_MnuNo + '_%'  ORDER BY  A2.PK_MnuNo DESC) AS ParentPK_MnuNo, A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 429) AND ISNULL(mnuLevel,0)> -90 AND (ISNULL(mnuLevel,0)=0 OR mnuLevel >=9 OR mnuLevel=9*-1 OR mnuLevel<=-90)  ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:16#  http://gbceap.cdc.gov.tw/CDCGBCE/intro.aspx
SELECT 'Powered by Microsoft SQL Server ' + CONVERT(nvarchar,SERVERPROPERTY('ProductVersion')) + ' ' + CONVERT(nvarchar,SERVERPROPERTY('ProductLevel'))
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:1]
--@parMenuID='1727'
 Select * From SysMenuBase Where PK_MnuNo ='1727' 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select Distinct  
                 PV.acmYear, PV.acmNo, PV.acpPayYear, PV.acpPayNo, PV.acvNo, PV.acmNo1, PV.acvNo1, PV.acmNo2 
               , PV.acvNo2, PV.acvSubNo, PV.acmNoPrv, PV.acvPlanCode, PV.acvOutlayYear, PV.acvOutlayCode 
               , PV.acvBgtSourceCode, PV.acvAccKind, PV.acvBizCode, PV.acvPrePayFlag, PV.acvVisaMoney  
               , PV.acvMoney, PV.acvDateMemo, PV.acvMemo, PV.acvFinalKind, PV.acvFinalDate, PV.acvAdjustMoney 
               -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位 
               -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvExchNo  
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvWExchNo as acvExchNo 
               , PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, ISNULL(CASE WHEN PV.acmYear<=104 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'') as acvExchNo  
               , PV.acvPassMoney, PV.acvPassAdjustMoney, PV.inspect  
               , P.acpBgtUnitNo, P.acpMarkDate, P.acpMoney, P.acpMemo, P.acpProdVisaKind, P.acpGroupNo , P.acpMarkUnitNo   
               , P.acpPassFlag, P.acpPassDate, P.acpPassMoney, P.acpPassBat, P.acpPassMemo,  P.acpPassUser 
               , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName , BZ.bizName   
               , BD.dptName As acpBgtDepName, BDV.dptName As acvBgtDepName, P.acpPayName 
              -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位,acvTranBNo 改取 acvWTranBNo 欄位 
              -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
              --, ( Case When IsNull(acvTranBNo,'')='' Or IsNull( acvExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
              --, ( Case When IsNull(acvWTranBNo,'')='' Or IsNull( acvWExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
                , ( Case When IsNull(CASE WHEN PV.acmYear<= 1 THEN PV.acvTranBNo ELSE PV.acvWTranBNo END,'')='' 
                           Or IsNull(CASE WHEN PV.acmYear<= 1 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'')='' 
                         Then '0' Else '1' End ) As EditFlag    
               , PV.acvBgtDepCode, PV.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, PV.acvPlanCode) As plnAliasNo 
               , PV.acvCostKind, CK.cskName As CostKindName  
               , V.acvBgtYear, V.acvBgtMonth, V.acvBgtSourCnt 
       FROM actPayVisa  PV  
               Left Join actPay P On P.acmYear = PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo) And P.acpPayYear =PV.acpPayYear and P.acpPayNo=PV.acpPayNo 
               Left Join actVisa V On PV.acmYear=V.acmYear And PV.acmNo=V.acmNo And PV.acvNo=V.acvNo 
 Left Join codAccKindName K On   IsNull(PV.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(PV.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( PV.acvPlanCode,'') = PN.plnPlanCode   And IsNull(PV.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  PV.acvOutlayCode = O.oulOutlayCode   And PV.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(PV.acvBizCode,'' ) = BZ.BizCode  And IsNull(PV.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(P.acpBgtUnitNo, P.acpMarkUnitNo)  
 Left Join codDepartName BDV On  BDV.dptCode  = IsNull(PV.acvBgtDepCode,'')  
 Left Join codPlanCategory PC On PC.plnCateCode=PV.acvPlanCateCode 
 Left Join codCostKind CK On CK.cskCode= PV.acvCostKind 
 Where P.acmYear=1
 And P.acmNo=1
 And P.acpPayYear=1
 And P.acpPayNo=1

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:4]
--@parAcmYear=1
--@parAcmNo=1
--@parAcpPayYear=1
--@parAcpPayNo=1
 Select O.oulOutlayName as OulName, P.plnPlanName as PlanName , BO.orgName  , K.accKindName ,   PVG.* From actPayVisaGBA PVG  Left Join codOutlayCode O On  IsNull(PVG.acvOutlayCode ,'') = O.oulOutlayCode  And IsNull(PVG.acvOutlayYear, '0') = O.codCodeVer  Left Join codPlanCode P On  IsNull(PVG.acvPlanCode,'') = P.plnPlanCode  And IsNull(PVG.acvOutlayYear,'0') = P.codCodeVer  Left Join codBgtOrigin BO On  IsNull(PVG.acvBgtSourceCode,'') = BO.orgCode  Left Join codAccKindName K On  IsNull(PVG.acvAccKind,'') = K.accKind    Where  1=1  And  PVG.acmYear=1  And PVG.acmNoPrv=1  And PVG.acpPayYear =1  And PVG.acpPayNo =1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select A.accKind, A.accKindName,  A.ackCreateDate, A.ackStopFlag, A.ackStopDate  FROM codAccKindName A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select A.orgCode, A.orgName, A.orgAliasNo, A.orgAliasName, A.orgCreateDate, A.orgStopFlag, A.orgStopDate  FROM codBgtOrigin A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select convert(varchar, A.codCodeVer) + ':' + Convert(varchar, A.BizCode) as BizCode, A.BizName   FROM codBizName  A  Where 1=1  And A.codCodeVer = 105  AND (ISNULL( A.bizCreateDate,'') <='2016/12/31' AND ( ISNULL(A.bizStopFlag,'') <> '1' OR A.bizStopDate > '2016/12/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:0]
 Select *    From  codPlanCategory  
                                Where 1=1 
  Order By    1  
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  AND (ISNULL( A.dptCreateDate,'') <='2016/12/31' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '2016/12/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select convert(varchar, A.codCodeVer) + ':' + Convert(varchar, A.dpzBizCode) as BizCode, W.BizName, A.dpzBizCode   From  codDepBiz A  Left Join codBizName W On  W.BizCode= A.dpzBizCode and W.codCodeVer=A.codCodeVer  Where 1=1 And A.codCodeVer = 105  and A.dpzDepCode ='301'  AND (ISNULL( A.dpzCreateDate,'')<='2016/12/31' AND ( ISNULL(A.dpzStopFlag,'')<>'1' OR A.dpzStopDate>'2016/12/1'))  Order By  1,2, 3 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select Distinct 
       Convert(varchar, P.codCodeVer) +':'+ P.plnPlanCode 
           +  (Case When DS.Code <> Convert(varchar, P.codCodeVer) +':'+ P.plnPlanCode Then '*' Else '' End ) 
            As Code    
       , IsNull(P.plnPlanCode,'') + ' '+ P.plnPlanName 
       From   
           ( 
SELECT DISTINCT LTRIM(STR(A.codCodeVer))+':'+A.plnPlanCode as Code, IsNull(A.plnPlanCode, '') +' '+A.plnPlanName as Name FROM actAccCode W JOIN codPlanCode A ON IsNull(W.accChildCnt,0) <=0 
                                   And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer)  
                                   AND (W.accPlanCode='' or  W.accPlanCode Like A.plnPlanCode+'%' or  A.plnPlanCode Like W.accPlanCode +'%') WHERE ( A.codCodeVer=105 AND (ISNULL( A.plnCreateDate,'')<='2016/12/31' AND ( ISNULL(A.plnStopFlag,'')<>'1' OR A.plnStopDate>'2016/12/31'))  AND (W.accDepCode='' OR W.accDepCode = '301') AND  A.plnCategory Like '%_2')                         And   (A.plnChildCnt<=0  
                                           OR 
                                   (A.plnChildCnt IS NULL AND  
                                       ISNULL((SELECT COUNT(*) FROM codPlanCode  Z 
                                       WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer)) 
                                       AND  ISNULL(Z.plnPlanCode,'') LIKE ISNULL(Ltrim(A.plnPlanCode),'')+'%' 
                                      ),1)<=1) 
                           )  

            ) DS 
         Left Join codPlanCode P  On DS.Code Like Convert(varchar, P.codCodeVer) +':'+ P.plnPlanCode +'%' 
 Order By 1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
(SELECT Max(codCodeVer) FROM codOutlayCode WHERE codCodeVer<=105) 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
SELECT  DISTINCT  LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') WHERE ( A.codCodeVer=105 AND (ISNULL( A.oulCreateDate,'')<='2016/12/31' AND ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>'2016/12/31'))  AND (W.accDepCode='' OR W.accDepCode = '301')) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select A.accKind, A.accKindName,  A.ackCreateDate, A.ackStopFlag, A.ackStopDate  FROM codAccKindName A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select Convert(varchar, A.orgCode) as orgCode, A.orgName   FROM codBgtOrigin A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select   Convert(varchar, A.codCodeVer) + ':' +  A.plnPlanCode as plnPlanCode,  A.plnPlanCode + '　' + A.plnPlanName as plnPlanName FROM codPlanCode A  Where A.codCodeVer =105  and A.plnLevel >=  1  Order By  1, 2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:28#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select DISTINCT  LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  FROM codOutlayCode A  LEFT OUTER JOIN codOutlayCode B ON A.codCodeVer = B.codCodeVer AND A.oulOutlayCode LIKE B.oulOutlayCode + '_%' LEFT OUTER JOIN codOutlayCode C ON A.codCodeVer = C.codCodeVer AND A.OulLevel = C.OulLevel + 1 AND A.oulOutlayCode LIKE C.oulOutlayCode + '_%'  Right Join actAccCode Q on  Q.accCodeVer= A.codCodeVer and Q.accOutlayCode=A.oulOutlayCode  WHERE (A.codCodeVer = 105)  AND (ISNULL( A.oulCreateDate,'')<='2016/01/09' AND ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>'2016/01/09'))  AND (ISNULL( Q.accCreateDate,'')<='2016/01/09' AND ( ISNULL(Q.accStopFlag,'')<>'1' OR Q.accStopDate>'2016/01/09')) 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:1]
--@parMenuID='1727'
 Select * From SysMenuBase Where PK_MnuNo ='1727' 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select Distinct  
                 PV.acmYear, PV.acmNo, PV.acpPayYear, PV.acpPayNo, PV.acvNo, PV.acmNo1, PV.acvNo1, PV.acmNo2 
               , PV.acvNo2, PV.acvSubNo, PV.acmNoPrv, PV.acvPlanCode, PV.acvOutlayYear, PV.acvOutlayCode 
               , PV.acvBgtSourceCode, PV.acvAccKind, PV.acvBizCode, PV.acvPrePayFlag, PV.acvVisaMoney  
               , PV.acvMoney, PV.acvDateMemo, PV.acvMemo, PV.acvFinalKind, PV.acvFinalDate, PV.acvAdjustMoney 
               -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位 
               -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvExchNo  
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvWExchNo as acvExchNo 
               , PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, ISNULL(CASE WHEN PV.acmYear<=104 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'') as acvExchNo  
               , PV.acvPassMoney, PV.acvPassAdjustMoney, PV.inspect  
               , P.acpBgtUnitNo, P.acpMarkDate, P.acpMoney, P.acpMemo, P.acpProdVisaKind, P.acpGroupNo , P.acpMarkUnitNo   
               , P.acpPassFlag, P.acpPassDate, P.acpPassMoney, P.acpPassBat, P.acpPassMemo,  P.acpPassUser 
               , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName , BZ.bizName   
               , BD.dptName As acpBgtDepName, BDV.dptName As acvBgtDepName, P.acpPayName 
              -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位,acvTranBNo 改取 acvWTranBNo 欄位 
              -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
              --, ( Case When IsNull(acvTranBNo,'')='' Or IsNull( acvExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
              --, ( Case When IsNull(acvWTranBNo,'')='' Or IsNull( acvWExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
                , ( Case When IsNull(CASE WHEN PV.acmYear<= 1 THEN PV.acvTranBNo ELSE PV.acvWTranBNo END,'')='' 
                           Or IsNull(CASE WHEN PV.acmYear<= 1 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'')='' 
                         Then '0' Else '1' End ) As EditFlag    
               , PV.acvBgtDepCode, PV.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, PV.acvPlanCode) As plnAliasNo 
               , PV.acvCostKind, CK.cskName As CostKindName  
               , V.acvBgtYear, V.acvBgtMonth, V.acvBgtSourCnt 
       FROM actPayVisa  PV  
               Left Join actPay P On P.acmYear = PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo) And P.acpPayYear =PV.acpPayYear and P.acpPayNo=PV.acpPayNo 
               Left Join actVisa V On PV.acmYear=V.acmYear And PV.acmNo=V.acmNo And PV.acvNo=V.acvNo 
 Left Join codAccKindName K On   IsNull(PV.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(PV.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( PV.acvPlanCode,'') = PN.plnPlanCode   And IsNull(PV.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  PV.acvOutlayCode = O.oulOutlayCode   And PV.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(PV.acvBizCode,'' ) = BZ.BizCode  And IsNull(PV.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(P.acpBgtUnitNo, P.acpMarkUnitNo)  
 Left Join codDepartName BDV On  BDV.dptCode  = IsNull(PV.acvBgtDepCode,'')  
 Left Join codPlanCategory PC On PC.plnCateCode=PV.acvPlanCateCode 
 Left Join codCostKind CK On CK.cskCode= PV.acvCostKind 
 Where P.acmYear=1
 And P.acmNo=1
 And P.acpPayYear=1
 And P.acpPayNo=1

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:4]
--@parAcmYear=1
--@parAcmNo=1
--@parAcpPayYear=1
--@parAcpPayNo=1
 Select O.oulOutlayName as OulName, P.plnPlanName as PlanName , BO.orgName  , K.accKindName ,   PVG.* From actPayVisaGBA PVG  Left Join codOutlayCode O On  IsNull(PVG.acvOutlayCode ,'') = O.oulOutlayCode  And IsNull(PVG.acvOutlayYear, '0') = O.codCodeVer  Left Join codPlanCode P On  IsNull(PVG.acvPlanCode,'') = P.plnPlanCode  And IsNull(PVG.acvOutlayYear,'0') = P.codCodeVer  Left Join codBgtOrigin BO On  IsNull(PVG.acvBgtSourceCode,'') = BO.orgCode  Left Join codAccKindName K On  IsNull(PVG.acvAccKind,'') = K.accKind    Where  1=1  And  PVG.acmYear=1  And PVG.acmNoPrv=1  And PVG.acpPayYear =1  And PVG.acpPayNo =1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select A.accKind, A.accKindName,  A.ackCreateDate, A.ackStopFlag, A.ackStopDate  FROM codAccKindName A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select A.orgCode, A.orgName, A.orgAliasNo, A.orgAliasName, A.orgCreateDate, A.orgStopFlag, A.orgStopDate  FROM codBgtOrigin A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select convert(varchar, A.codCodeVer) + ':' + Convert(varchar, A.BizCode) as BizCode, A.BizName   FROM codBizName  A  Where 1=1  And A.codCodeVer = 105  AND (ISNULL( A.bizCreateDate,'') <='2016/12/31' AND ( ISNULL(A.bizStopFlag,'') <> '1' OR A.bizStopDate > '2016/12/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:0]
 Select *    From  codPlanCategory  
                                Where 1=1 
  Order By    1  
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  AND (ISNULL( A.dptCreateDate,'') <='2016/12/31' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '2016/12/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select convert(varchar, A.codCodeVer) + ':' + Convert(varchar, A.dpzBizCode) as BizCode, W.BizName, A.dpzBizCode   From  codDepBiz A  Left Join codBizName W On  W.BizCode= A.dpzBizCode and W.codCodeVer=A.codCodeVer  Where 1=1 And A.codCodeVer = 105  and A.dpzDepCode ='201'  AND (ISNULL( A.dpzCreateDate,'')<='2016/12/31' AND ( ISNULL(A.dpzStopFlag,'')<>'1' OR A.dpzStopDate>'2016/12/1'))  Order By  1,2, 3 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select A.accKind, A.accKindName,  A.ackCreateDate, A.ackStopFlag, A.ackStopDate  FROM codAccKindName A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select Convert(varchar, A.orgCode) as orgCode, A.orgName   FROM codBgtOrigin A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select   Convert(varchar, A.codCodeVer) + ':' +  A.plnPlanCode as plnPlanCode,  A.plnPlanCode + '　' + A.plnPlanName as plnPlanName FROM codPlanCode A  Where A.codCodeVer =105  and A.plnLevel >=  1  Order By  1, 2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:31#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select DISTINCT  LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  FROM codOutlayCode A  LEFT OUTER JOIN codOutlayCode B ON A.codCodeVer = B.codCodeVer AND A.oulOutlayCode LIKE B.oulOutlayCode + '_%' LEFT OUTER JOIN codOutlayCode C ON A.codCodeVer = C.codCodeVer AND A.OulLevel = C.OulLevel + 1 AND A.oulOutlayCode LIKE C.oulOutlayCode + '_%'  Right Join actAccCode Q on  Q.accCodeVer= A.codCodeVer and Q.accOutlayCode=A.oulOutlayCode  WHERE (A.codCodeVer = 105)  AND (ISNULL( A.oulCreateDate,'')<='2016/01/09' AND ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>'2016/01/09'))  AND (ISNULL( Q.accCreateDate,'')<='2016/01/09' AND ( ISNULL(Q.accStopFlag,'')<>'1' OR Q.accStopDate>'2016/01/09')) 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:1]
--@parMenuID='1727'
 Select * From SysMenuBase Where PK_MnuNo ='1727' 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select Distinct  
                 PV.acmYear, PV.acmNo, PV.acpPayYear, PV.acpPayNo, PV.acvNo, PV.acmNo1, PV.acvNo1, PV.acmNo2 
               , PV.acvNo2, PV.acvSubNo, PV.acmNoPrv, PV.acvPlanCode, PV.acvOutlayYear, PV.acvOutlayCode 
               , PV.acvBgtSourceCode, PV.acvAccKind, PV.acvBizCode, PV.acvPrePayFlag, PV.acvVisaMoney  
               , PV.acvMoney, PV.acvDateMemo, PV.acvMemo, PV.acvFinalKind, PV.acvFinalDate, PV.acvAdjustMoney 
               -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位 
               -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvExchNo  
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvWExchNo as acvExchNo 
               , PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, ISNULL(CASE WHEN PV.acmYear<=104 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'') as acvExchNo  
               , PV.acvPassMoney, PV.acvPassAdjustMoney, PV.inspect  
               , P.acpBgtUnitNo, P.acpMarkDate, P.acpMoney, P.acpMemo, P.acpProdVisaKind, P.acpGroupNo , P.acpMarkUnitNo   
               , P.acpPassFlag, P.acpPassDate, P.acpPassMoney, P.acpPassBat, P.acpPassMemo,  P.acpPassUser 
               , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName , BZ.bizName   
               , BD.dptName As acpBgtDepName, BDV.dptName As acvBgtDepName, P.acpPayName 
              -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位,acvTranBNo 改取 acvWTranBNo 欄位 
              -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
              --, ( Case When IsNull(acvTranBNo,'')='' Or IsNull( acvExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
              --, ( Case When IsNull(acvWTranBNo,'')='' Or IsNull( acvWExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
                , ( Case When IsNull(CASE WHEN PV.acmYear<= 1 THEN PV.acvTranBNo ELSE PV.acvWTranBNo END,'')='' 
                           Or IsNull(CASE WHEN PV.acmYear<= 1 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'')='' 
                         Then '0' Else '1' End ) As EditFlag    
               , PV.acvBgtDepCode, PV.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, PV.acvPlanCode) As plnAliasNo 
               , PV.acvCostKind, CK.cskName As CostKindName  
               , V.acvBgtYear, V.acvBgtMonth, V.acvBgtSourCnt 
       FROM actPayVisa  PV  
               Left Join actPay P On P.acmYear = PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo) And P.acpPayYear =PV.acpPayYear and P.acpPayNo=PV.acpPayNo 
               Left Join actVisa V On PV.acmYear=V.acmYear And PV.acmNo=V.acmNo And PV.acvNo=V.acvNo 
 Left Join codAccKindName K On   IsNull(PV.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(PV.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( PV.acvPlanCode,'') = PN.plnPlanCode   And IsNull(PV.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  PV.acvOutlayCode = O.oulOutlayCode   And PV.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(PV.acvBizCode,'' ) = BZ.BizCode  And IsNull(PV.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(P.acpBgtUnitNo, P.acpMarkUnitNo)  
 Left Join codDepartName BDV On  BDV.dptCode  = IsNull(PV.acvBgtDepCode,'')  
 Left Join codPlanCategory PC On PC.plnCateCode=PV.acvPlanCateCode 
 Left Join codCostKind CK On CK.cskCode= PV.acvCostKind 
 Where P.acmYear=1
 And P.acmNo=1
 And P.acpPayYear=1
 And P.acpPayNo=1

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:4]
--@parAcmYear=1
--@parAcmNo=1
--@parAcpPayYear=1
--@parAcpPayNo=1
 Select O.oulOutlayName as OulName, P.plnPlanName as PlanName , BO.orgName  , K.accKindName ,   PVG.* From actPayVisaGBA PVG  Left Join codOutlayCode O On  IsNull(PVG.acvOutlayCode ,'') = O.oulOutlayCode  And IsNull(PVG.acvOutlayYear, '0') = O.codCodeVer  Left Join codPlanCode P On  IsNull(PVG.acvPlanCode,'') = P.plnPlanCode  And IsNull(PVG.acvOutlayYear,'0') = P.codCodeVer  Left Join codBgtOrigin BO On  IsNull(PVG.acvBgtSourceCode,'') = BO.orgCode  Left Join codAccKindName K On  IsNull(PVG.acvAccKind,'') = K.accKind    Where  1=1  And  PVG.acmYear=1  And PVG.acmNoPrv=1  And PVG.acpPayYear =1  And PVG.acpPayNo =1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select A.accKind, A.accKindName,  A.ackCreateDate, A.ackStopFlag, A.ackStopDate  FROM codAccKindName A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select A.orgCode, A.orgName, A.orgAliasNo, A.orgAliasName, A.orgCreateDate, A.orgStopFlag, A.orgStopDate  FROM codBgtOrigin A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select convert(varchar, A.codCodeVer) + ':' + Convert(varchar, A.BizCode) as BizCode, A.BizName   FROM codBizName  A  Where 1=1  And A.codCodeVer = 105  AND (ISNULL( A.bizCreateDate,'') <='2016/12/31' AND ( ISNULL(A.bizStopFlag,'') <> '1' OR A.bizStopDate > '2016/12/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:0]
 Select *    From  codPlanCategory  
                                Where 1=1 
  Order By    1  
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  AND (ISNULL( A.dptCreateDate,'') <='2016/12/31' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '2016/12/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select convert(varchar, A.codCodeVer) + ':' + Convert(varchar, A.dpzBizCode) as BizCode, W.BizName, A.dpzBizCode   From  codDepBiz A  Left Join codBizName W On  W.BizCode= A.dpzBizCode and W.codCodeVer=A.codCodeVer  Where 1=1 And A.codCodeVer = 105  and A.dpzDepCode ='201'  AND (ISNULL( A.dpzCreateDate,'')<='2016/12/31' AND ( ISNULL(A.dpzStopFlag,'')<>'1' OR A.dpzStopDate>'2016/12/1'))  Order By  1,2, 3 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
SELECT  DISTINCT  LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') WHERE ( A.codCodeVer=105 AND (ISNULL( A.oulCreateDate,'')<='2016/12/31' AND ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>'2016/12/31'))  AND (W.accDepCode='' OR W.accDepCode = '201') AND (W.accPlanCode='' OR W.accPlanCode Like '304010105')) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select A.accKind, A.accKindName,  A.ackCreateDate, A.ackStopFlag, A.ackStopDate  FROM codAccKindName A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select Convert(varchar, A.orgCode) as orgCode, A.orgName   FROM codBgtOrigin A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select   Convert(varchar, A.codCodeVer) + ':' +  A.plnPlanCode as plnPlanCode,  A.plnPlanCode + '　' + A.plnPlanName as plnPlanName FROM codPlanCode A  Where A.codCodeVer =105  and A.plnLevel >=  1  Order By  1, 2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:33#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select DISTINCT  LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  FROM codOutlayCode A  LEFT OUTER JOIN codOutlayCode B ON A.codCodeVer = B.codCodeVer AND A.oulOutlayCode LIKE B.oulOutlayCode + '_%' LEFT OUTER JOIN codOutlayCode C ON A.codCodeVer = C.codCodeVer AND A.OulLevel = C.OulLevel + 1 AND A.oulOutlayCode LIKE C.oulOutlayCode + '_%'  Right Join actAccCode Q on  Q.accCodeVer= A.codCodeVer and Q.accOutlayCode=A.oulOutlayCode  WHERE (A.codCodeVer = 105)  AND (ISNULL( A.oulCreateDate,'')<='2016/01/09' AND ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>'2016/01/09'))  AND (ISNULL( Q.accCreateDate,'')<='2016/01/09' AND ( ISNULL(Q.accStopFlag,'')<>'1' OR Q.accStopDate>'2016/01/09')) 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:1]
--@parMenuID='1727'
 Select * From SysMenuBase Where PK_MnuNo ='1727' 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select Distinct  
                 PV.acmYear, PV.acmNo, PV.acpPayYear, PV.acpPayNo, PV.acvNo, PV.acmNo1, PV.acvNo1, PV.acmNo2 
               , PV.acvNo2, PV.acvSubNo, PV.acmNoPrv, PV.acvPlanCode, PV.acvOutlayYear, PV.acvOutlayCode 
               , PV.acvBgtSourceCode, PV.acvAccKind, PV.acvBizCode, PV.acvPrePayFlag, PV.acvVisaMoney  
               , PV.acvMoney, PV.acvDateMemo, PV.acvMemo, PV.acvFinalKind, PV.acvFinalDate, PV.acvAdjustMoney 
               -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位 
               -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvExchNo  
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvWExchNo as acvExchNo 
               , PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, ISNULL(CASE WHEN PV.acmYear<=104 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'') as acvExchNo  
               , PV.acvPassMoney, PV.acvPassAdjustMoney, PV.inspect  
               , P.acpBgtUnitNo, P.acpMarkDate, P.acpMoney, P.acpMemo, P.acpProdVisaKind, P.acpGroupNo , P.acpMarkUnitNo   
               , P.acpPassFlag, P.acpPassDate, P.acpPassMoney, P.acpPassBat, P.acpPassMemo,  P.acpPassUser 
               , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName , BZ.bizName   
               , BD.dptName As acpBgtDepName, BDV.dptName As acvBgtDepName, P.acpPayName 
              -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位,acvTranBNo 改取 acvWTranBNo 欄位 
              -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
              --, ( Case When IsNull(acvTranBNo,'')='' Or IsNull( acvExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
              --, ( Case When IsNull(acvWTranBNo,'')='' Or IsNull( acvWExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
                , ( Case When IsNull(CASE WHEN PV.acmYear<= 1 THEN PV.acvTranBNo ELSE PV.acvWTranBNo END,'')='' 
                           Or IsNull(CASE WHEN PV.acmYear<= 1 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'')='' 
                         Then '0' Else '1' End ) As EditFlag    
               , PV.acvBgtDepCode, PV.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, PV.acvPlanCode) As plnAliasNo 
               , PV.acvCostKind, CK.cskName As CostKindName  
               , V.acvBgtYear, V.acvBgtMonth, V.acvBgtSourCnt 
       FROM actPayVisa  PV  
               Left Join actPay P On P.acmYear = PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo) And P.acpPayYear =PV.acpPayYear and P.acpPayNo=PV.acpPayNo 
               Left Join actVisa V On PV.acmYear=V.acmYear And PV.acmNo=V.acmNo And PV.acvNo=V.acvNo 
 Left Join codAccKindName K On   IsNull(PV.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(PV.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( PV.acvPlanCode,'') = PN.plnPlanCode   And IsNull(PV.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  PV.acvOutlayCode = O.oulOutlayCode   And PV.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(PV.acvBizCode,'' ) = BZ.BizCode  And IsNull(PV.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(P.acpBgtUnitNo, P.acpMarkUnitNo)  
 Left Join codDepartName BDV On  BDV.dptCode  = IsNull(PV.acvBgtDepCode,'')  
 Left Join codPlanCategory PC On PC.plnCateCode=PV.acvPlanCateCode 
 Left Join codCostKind CK On CK.cskCode= PV.acvCostKind 
 Where P.acmYear=1
 And P.acmNo=1
 And P.acpPayYear=1
 And P.acpPayNo=1

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:4]
--@parAcmYear=1
--@parAcmNo=1
--@parAcpPayYear=1
--@parAcpPayNo=1
 Select O.oulOutlayName as OulName, P.plnPlanName as PlanName , BO.orgName  , K.accKindName ,   PVG.* From actPayVisaGBA PVG  Left Join codOutlayCode O On  IsNull(PVG.acvOutlayCode ,'') = O.oulOutlayCode  And IsNull(PVG.acvOutlayYear, '0') = O.codCodeVer  Left Join codPlanCode P On  IsNull(PVG.acvPlanCode,'') = P.plnPlanCode  And IsNull(PVG.acvOutlayYear,'0') = P.codCodeVer  Left Join codBgtOrigin BO On  IsNull(PVG.acvBgtSourceCode,'') = BO.orgCode  Left Join codAccKindName K On  IsNull(PVG.acvAccKind,'') = K.accKind    Where  1=1  And  PVG.acmYear=1  And PVG.acmNoPrv=1  And PVG.acpPayYear =1  And PVG.acpPayNo =1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
SELECT MAX(CAST(acmWordNum as int)) FROM actMain A WHERE  ( acmYear=105 Or acmYear=-105 ) And (ISNULL(acmBgtKind,'0')='0'  Or IsNull(acmBgtAcmNo,0) =0 ) 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:38]
--@paracmYear=105
--@paracmNo=20033
--@paracpPayYear=105
--@paracpPayNo=1
--@paracvNo=1
--@paracmNo1=0
--@parAcvNo1=0
--@paracmNo2=0
--@parAcvNo2=0
--@paracvSubNo=1
--@paracvPlanCode='304010105'
--@paracvOutlayYear=105
--@paracvOutlayCode='024902'
--@paracvBgtSourceCode='10'
--@paracvAccKind='1'
--@paracvBizCode='15'
--@paracvPrePayFlag='0'
--@paracvMoney=8347
--@paracvMemo=NULL
--@paracvFinalKind=NULL
--@paracvFinalDate=NULL
--@parInspect=NULL
--@paracmNoPrv=20033
--@paracvDateMemo=NULL
--@paracvTranID=NULL
--@paracvTranBNo=NULL
--@paracvTranDTime=NULL
--@paracvTranUser=NULL
--@paracvExchNo=NULL
--@parAcvPlanCateCode=NULL
--@parAcvCostKind=NULL
--@parAcvBgtDepCode='201'
--@parAcvBgtKindSet=NULL
--@parAcvDesc=NULL
 Insert Into actPayVisa (  acmYear, acmNo, acpPayYear, acpPayNo , acvNo  , acmNo1, acvNo1, acmNo2, acvNo2 , acvSubNo  , acvPlanCode, acvOutlayYear, acvOutlayCode, acvBgtSourceCode, acvAccKind  , acvBizCode, acvPrePayFlag, acvMoney , acvMemo, acvFinalKind, acvFinalDate, acvAdjustMoney, inspect  , acmNoPrv , acvVisaMoney, acvDateMemo , acvTranID, acvTranBNo, acvTranDTime, acvTranUser, acvExchNo  , acvPassMoney, acvPassAdjustMoney, acvPlanCateCode, acvCostKind  , acvBgtDepCode, acvBgtKindSet, acvDesc 
 ) Values (   105, 20033, 105, 1, 1  , 200331, 11, 200332, 12, 1  , '304010105', 105, '024902', '10', '1'  , '15', '0', 8347  , NULL, NULL, NULL, @paracvAdjustMoney, NULL  , 20033Prv, @paracvVisaMoney, NULL  , NULL, NULL, NULL, NULL, NULL  , @paracvPassMoney, @paracvPassAdjustMoney, NULL, NULL   , '201', @paracvBgtKindSet, NULL 
)
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:23]
--@paracmYear=105
--@paracmNo=20033
--@paracvNo=1
--@paracvBgtYear=105
--@paracvBgtMonth=12
--@paracvPlanCode='304010105'
--@paracvOutlayYear=105
--@paracvOutlayCode='024902'
--@paracvBgtSourceCode='10'
--@paracvAccKind='1'
--@paracvBizCode='15'
--@paracvPrePayFlag='0'
--@paracvMoney=8347
--@paracvMemo=NULL
--@paracmNoPrv=20033
--@parinspect=NULL
--@paracvNextYearFlag=NULL
--@parAcvBgtKindSet=NULL
--@parAcvBgtDepCode='201'
--@parAcvPlanCateCode=NULL
--@parAcvCostKind=NULL
 Insert Into actVisa (                        acmYear, acmNo, acvNo, acvBgtYear, acvBgtMonth 
                     , acvPlanCode, acvOutlayYear, acvOutlayCode
                     , acvBgtSourceCode, acvAccKind, acvBizCode 
                     , acvPrePayFlag, acvMoney, acvMemo, acmNoPrv 
                     , inspect, acvPassAdjustMoney, acvNextYearFlag 
                     , acvBgtKindSet, acvBgtDepCode, acvPlanCateCode 
                     , acvCostKind, acvBgtSourCnt 
   ) Values (  
                       105, 20033, 1, 105, 12
                     , '304010105', 105, '024902' 
                     , '10', '1', '15'
                     , '0', 8347, NULL, 20033Prv 
                     , NULL, @paracvPassAdjustMoney, NULL  
                     , NULL, '201', NULL  
                     , NULL, @parAcvBgtSourCnt 
   ) 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:1]
--@parAcmWordNum='10513100'
 Select Sum(IsNull( acvMoney,0) - IsNull(TotalRealPay,0) - IsNull(TotalRealPay1,0)) As VisaLeft From ( 
 Select IsNull(IsNull(V2.acvMoney, V1.acvMoney), V.acvMoney) As acvMoney 
               , (Select Sum(IsNull(acvMoney,0)+ IsNull(acvAdjustMoney,0) ) From actPayVisa PVD  
                       Join actPay PD On PD.acmYear =PVD.acmYear And PD.acmNo=IsNull(PVD.acmNoPrv, PVD.acmNo)  
                               And PD.acpPayYear=PVD.acpPayYear  And PD.acpPayNo = PVD.acpPayNo 
                   Where PVD.acmYear= IsNull(V2.acmYear, IsNull(V1.acmYear, V.acmYear)) And PVD.acmNo=IsNull(V2.acmNo, IsNull(V1.acmNo, V.acmNo)) 
                       And PVD.acvNo= IsNull(V2.acvNo, IsNull(V1.acvNo, V.acvNo)) 
                       And PVD.acmNo1=IsNull(V2.acmNo1, IsNull(V1.acmNo1, 0)) 
                       And PVD.acvNo1= IsNull(V2.acvNo1, IsNull(V1.acvNo1, 0)) 
                       And PVD.acmNo2=IsNull(V2.acmNo2, 0)  
                       And PVD.acvNo2=IsNull(V2.acvNo2, 0)  
                       And IsNull(PVD.acvPrePayFlag,'0')='0'  
                   ) As TotalRealPay 
               , (Select Sum(IsNull(acvMoney,0)) From actPayVisa PVD  
                       Join actPay PD On PD.acmYear =PVD.acmYear And PD.acmNo=IsNull(PVD.acmNoPrv, PVD.acmNo)  
                               And PD.acpPayYear=PVD.acpPayYear  And PD.acpPayNo = PVD.acpPayNo 
                   Where PVD.acmYear= IsNull(V2.acmYear, IsNull(V1.acmYear, V.acmYear)) And PVD.acmNo=IsNull(V2.acmNo, IsNull(V1.acmNo, V.acmNo)) 
                       And PVD.acvNo= IsNull(V2.acvNo, IsNull(V1.acvNo, V.acvNo)) 
                       And PVD.acmNo1=IsNull(V2.acmNo1, IsNull(V1.acmNo1, 0)) 
                       And PVD.acvNo1= IsNull(V2.acvNo1, IsNull(V1.acvNo1, 0)) 
                       And PVD.acmNo2=IsNull(V2.acmNo2, 0)  
                       And PVD.acvNo2=IsNull(V2.acvNo2, 0)  
                       And IsNull(PVD.acvPrePayFlag,'0')='1'  
                   ) As TotalTempPay 
               , (Select Sum(IsNull(acvMoney,0)+ IsNull(acvAdjustMoney,0) ) From actPayVisa1 PVD1  
                        Join actPay1 PD1 On PD1.acmYear =PVD1.acmYear And PD1.acmNo=IsNull(PVD1.acmNoPrv, PVD1.acmNo)  
                                        And PD1.acpPayYear=PVD1.acpPayYear  And PD1.acpPayNo =IsNull( PVD1.acpPayNoPrv, PVD1.acpPayNo) 
                                        And PD1.acpPayNo1=PVD1.acpPayNo1  
                       Where   PVD1.acmYear = IsNull(V2.acmYear, IsNull(V1.acmYear, V.acmYear)) And PVD1.acmNo=IsNull(V2.acmNo, IsNull(V1.acmNo, V.acmNo)) 
                           And PVD1.acvNo   = IsNull(V2.acvNo, IsNull(V1.acvNo, V.acvNo)) 
                           And PVD1.acmNo1  = IsNull(V2.acmNo1, IsNull(V1.acmNo1, 0)) 
                           And PVD1.acvNo1  = IsNull(V2.acvNo1, IsNull(V1.acvNo1, 0)) 
                           And PVD1.acmNo2  = IsNull(V2.acmNo2, 0)  
                           And PVD1.acvNo2  = IsNull(V2.acvNo2, 0)  
                           And IsNull(PVD1.acvPrePayFlag,'0')='0' 
                   ) As TotalRealPay1 
       From actVisa V Join ActMain M On V.acmYear=105 And M.acmYear =105 And M.acmYear=V.acmYear And V.acmNo=M.acmNo And IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum)='10513100' 
           Left Join actVisa1 V1 On V1.acmYear=V.acmYear And V1.acmNo=V.acmNo And V1.acvNo=V.acvNo 
           Left Join actVisa2 V2 On V2.acmYear=IsNull(V1.acmYear, V.acmYear) And V2.acmNo=IsNull(V1.acmNo, V.acmNo) And V2.acvNo=IsNull(V2.acvNo, V.acvNo) 
                                   And V2.acmNo1=IsNull(V1.acmNo1,0) And V2.acvNo1=IsNull(V1.acvNo1,0) 
 ) DS 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:1]
--@parAcmWordNum='10513100'
 Update actMain Set acmFinalKind='1' , acmFinalDate='2017/1/9'
               Where acmYear=105
                   And IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) = '10513100'
-------------------------------------------------------------------------------
--執行時間--  2017/1/9 上午 11:50:52
--連線字串：Data Source=192.168.170.79;Initial Catalog='CDCGBCE';Persist Security Info=True;User ID=Cdcgbce;Password=B8Dt*XvU
--參數個數：2
Declare @parAcmYear As SmallInt
Set @parAcmYear = 105
Declare @parAcmNo As Int
Set @parAcmNo = 20033
 Update actMain Set 
       acmMoney=(Select Sum(acvMoney) From actVisa V Where V.acmYear=actMain.acmYear And V.acmNo=actMain.acmNo )
   Where actMain.acmYear=@parAcmYear And actMain.acmNo=@parAcmNo 
------------------------------------------------------------

--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:12]
--@parAcmYear=105
--@parAcmNo=20033
--@parAcmNo1=-1
--@parAcpPayYear=105
--@parAcpPayNo=1
--@parAcpPassDTime='2017/1/9 上午 11:50:52'
--@parAcpPassUser='劉明松'
--@parAcpModifyUser='劉明松'
--@parAcpPassDate=NULL
--@parAcpPassBat=0
--@parAcpPassMemo=NULL
 Update actPay Set acpPassFlag ='0'   , acpPassDate =NULL, acpPassDTime='2017/1/9 上午 11:50:52',  acpPassUser='劉明松' 
 , acpPassMoney=@parAcpPassMoney, acpPassBat=0, acpPassMemo =NULL 
 , acpModifyUser='劉明松', acpModifyDTime='2017/1/9 上午 11:50:52' 
 Where acmYear=105  And acmNo=20033 And  acpPayYear=105 And acpPayNo=1 ; Update actPayVisa Set acmYear=acmYear    Where acmYear=105  And IsNull(acmNoPrv, acmNo)=20033 And  acpPayYear=105 And acpPayNo=1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:8]
--@parAcmUnitPassDTime='2017/1/9 上午 11:50:52'
--@parAcmUnitPassUser='劉明松-(代)'
--@parAcmUnitPassDate=NULL
--@parAcmModifyUser='劉明松'
--@parAcmUnitPassMoney=0
--@parAcmUnitPassMemo=NULL
--@parAcmYear=105
--@parAcmNo=20033
 Update actMain  Set acmUnitPassFlag ='1'  
               , acmUnitPassDate =NULL , acmUnitPassDTime='2017/1/9 上午 11:50:52',  acmUnitPassUser='劉明松-(代)'   
               , AcmUnitPassMoney=0, acmUnitPassMemo =NULL 
               , acmModifyUser='劉明松',  acmModifyDTime='2017/1/9 上午 11:50:52' 
 Where acmYear=105  And acmNo=20033 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:7]
--@parAcmYear=105
--@parAcmNo=20033
--@parAcmPassDTime='2017/1/9 上午 11:50:52'
--@parAcmPassUser='劉明松'
--@parAcmPassDate=NULL
--@parAcmPassMemo=NULL
 Update actMain  Set acmPassFlag ='0'  
               , acmPassDate =NULL , acmPassDTime='2017/1/9 上午 11:50:52',  acmPassUser='劉明松'  
               , acmPassMoney=@parAcmpassMoney, acmPassMemo =NULL   
               , acmModifyUser='劉明松',  acmModifyDTime='2017/1/9 上午 11:50:52' 
 Where acmYear=105  And acmNo=20033 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:1]
--@parAcmWordNum='10513100'
 Select Sum(IsNull( acvMoney,0) - IsNull(TotalRealPay,0) - IsNull(TotalRealPay1,0)) As VisaLeft From ( 
 Select IsNull(IsNull(V2.acvMoney, V1.acvMoney), V.acvMoney) As acvMoney 
               , (Select Sum(IsNull(acvMoney,0)+ IsNull(acvAdjustMoney,0) ) From actPayVisa PVD  
                       Join actPay PD On PD.acmYear =PVD.acmYear And PD.acmNo=IsNull(PVD.acmNoPrv, PVD.acmNo)  
                               And PD.acpPayYear=PVD.acpPayYear  And PD.acpPayNo = PVD.acpPayNo 
                   Where PVD.acmYear= IsNull(V2.acmYear, IsNull(V1.acmYear, V.acmYear)) And PVD.acmNo=IsNull(V2.acmNo, IsNull(V1.acmNo, V.acmNo)) 
                       And PVD.acvNo= IsNull(V2.acvNo, IsNull(V1.acvNo, V.acvNo)) 
                       And PVD.acmNo1=IsNull(V2.acmNo1, IsNull(V1.acmNo1, 0)) 
                       And PVD.acvNo1= IsNull(V2.acvNo1, IsNull(V1.acvNo1, 0)) 
                       And PVD.acmNo2=IsNull(V2.acmNo2, 0)  
                       And PVD.acvNo2=IsNull(V2.acvNo2, 0)  
                       And IsNull(PVD.acvPrePayFlag,'0')='0'  
                   ) As TotalRealPay 
               , (Select Sum(IsNull(acvMoney,0)) From actPayVisa PVD  
                       Join actPay PD On PD.acmYear =PVD.acmYear And PD.acmNo=IsNull(PVD.acmNoPrv, PVD.acmNo)  
                               And PD.acpPayYear=PVD.acpPayYear  And PD.acpPayNo = PVD.acpPayNo 
                   Where PVD.acmYear= IsNull(V2.acmYear, IsNull(V1.acmYear, V.acmYear)) And PVD.acmNo=IsNull(V2.acmNo, IsNull(V1.acmNo, V.acmNo)) 
                       And PVD.acvNo= IsNull(V2.acvNo, IsNull(V1.acvNo, V.acvNo)) 
                       And PVD.acmNo1=IsNull(V2.acmNo1, IsNull(V1.acmNo1, 0)) 
                       And PVD.acvNo1= IsNull(V2.acvNo1, IsNull(V1.acvNo1, 0)) 
                       And PVD.acmNo2=IsNull(V2.acmNo2, 0)  
                       And PVD.acvNo2=IsNull(V2.acvNo2, 0)  
                       And IsNull(PVD.acvPrePayFlag,'0')='1'  
                   ) As TotalTempPay 
               , (Select Sum(IsNull(acvMoney,0)+ IsNull(acvAdjustMoney,0) ) From actPayVisa1 PVD1  
                        Join actPay1 PD1 On PD1.acmYear =PVD1.acmYear And PD1.acmNo=IsNull(PVD1.acmNoPrv, PVD1.acmNo)  
                                        And PD1.acpPayYear=PVD1.acpPayYear  And PD1.acpPayNo =IsNull( PVD1.acpPayNoPrv, PVD1.acpPayNo) 
                                        And PD1.acpPayNo1=PVD1.acpPayNo1  
                       Where   PVD1.acmYear = IsNull(V2.acmYear, IsNull(V1.acmYear, V.acmYear)) And PVD1.acmNo=IsNull(V2.acmNo, IsNull(V1.acmNo, V.acmNo)) 
                           And PVD1.acvNo   = IsNull(V2.acvNo, IsNull(V1.acvNo, V.acvNo)) 
                           And PVD1.acmNo1  = IsNull(V2.acmNo1, IsNull(V1.acmNo1, 0)) 
                           And PVD1.acvNo1  = IsNull(V2.acvNo1, IsNull(V1.acvNo1, 0)) 
                           And PVD1.acmNo2  = IsNull(V2.acmNo2, 0)  
                           And PVD1.acvNo2  = IsNull(V2.acvNo2, 0)  
                           And IsNull(PVD1.acvPrePayFlag,'0')='0' 
                   ) As TotalRealPay1 
       From actVisa V Join ActMain M On V.acmYear=105 And M.acmYear =105 And M.acmYear=V.acmYear And V.acmNo=M.acmNo And IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum)='10513100' 
           Left Join actVisa1 V1 On V1.acmYear=V.acmYear And V1.acmNo=V.acmNo And V1.acvNo=V.acvNo 
           Left Join actVisa2 V2 On V2.acmYear=IsNull(V1.acmYear, V.acmYear) And V2.acmNo=IsNull(V1.acmNo, V.acmNo) And V2.acvNo=IsNull(V2.acvNo, V.acvNo) 
                                   And V2.acmNo1=IsNull(V1.acmNo1,0) And V2.acvNo1=IsNull(V1.acvNo1,0) 
 ) DS 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:1]
--@parAcmWordNum='10513100'
 Update actMain Set acmFinalKind='1' , acmFinalDate='2017/1/9'
               Where acmYear=105
                   And IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) = '10513100'
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Update actPay Set acpReadyFlag='0' 
               Where acmYear=105 And acmNo=20033
 And acmNo1=0
 And acpPayYear=105
 And acpPayNo=1
; Update actPay Set acpReadyFlag='1'   From actPay P 
               Left Join actMain M On M.acmYear=P.acmYear And M.acmNo=P.acmNo 
               Left Join actMain1 M1 On M1.acmYear=P.acmYear And M1.acmNo=P.acmNo And M1.acmNo1=P.acmNo1  
               Join actPayStage S 
                 On IsNull(NullIF(S.acmKidNum,''), IsNull(M1.acmKidNum, IsNull(M.acmKidNum,'')))=IsNull(M1.acmKidNum, IsNull(M.acmKidNum,''))
                   And IsNull(IsNull(NullIF(S.acmProdLevelKind,''), IsNull(M.acmProdLevelKind, M.acmProdLevelKind)) ,'0')=IsNull(IsNull(M.acmProdLevelKind, M.acmProdLevelKind),'0')  
                   And IsNull(IsNull(NullIF(S.acmEtcPayment,''),  P.acpEtcPayment)  ,'0')=IsNull(P.acpEtcPayment,'0')  
                   And IsNull(IsNull(NullIF(S.acmProdKind,'') , IsNull(M1.acmProdKind, M.acmProdKind)) ,'0')=IsNull(IsNull(M1.acmProdKind, M.acmProdKind),'0')  
                   And IsNull(IsNull(NullIF(S.acmProdVisaKind,''), P.acpProdVisaKind)   ,'0')=IsNull(P.acpProdVisaKind,'0')  
                   And IsNull(NullIF(S.acmCateGrpFlag,''),IsNull(IsNull(M1.acmCateGrpFlag, M.acmCateGrpFlag),'0'))=IsNull(IsNull(M1.acmCateGrpFlag, M.acmCateGrpFlag),'0')     
                   And IsNull(S.acmAccPass,IsNull(P.acpPassFlag,'0'))=IsNull(P.acpPassFlag,'0')
                   And IsNull(S.acmDepPass,IsNull(P.acpUnitPassFlag,'0'))=IsNull(P.acpUnitPassFlag,'0')
                   And IsNull(IsNull(NullIF(S.acmPrePayFlag,''), P.acpAutoPrePayFlag),'0')=IsNull(P.acpAutoPrePayFlag,'0')     
               Where P.acmYear=105 And P.acmNo=20033
 And P.acmNo1=0
 And P.acpPayYear=105
 And P.acpPayNo=1

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
Select Distinct * 
               From (  
 SELECT Distinct Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , M.acmWorkUserNo, M.acmMoney, M.acmMemo  
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate, M.acmSubsidyCode, M.acmPayName
               , M.acmPassUser, M.acmPassDate, M.acmPassMoney, M.acmPassMemo  
               , M.acmUnitPassFlag, M.acmUnitPassUser, M.acmUnitPassDate 
  , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
  , (Select acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
  , (Select acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
  , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
              , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
              , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
              , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo  ) as PCounter 
              , IsNull( M.acmBgtKind ,'0') As acmBgtKind, M.acmEmpNo  
              , M.acmEtcPayment, M.acmSubMemo, M.acmProdDepCode, M.acmVisaKindCode, M.acmProdMethodCode 
              , M.acmCateGrpFlag, M.acmAutoPrePayFlag 
              , M.acmModifyUser 

  FROM (actMain M INNER JOIN actVisa V ON M.acmYear =105 And M.acmYear = V.acmYear AND V.acmNo = M.acmNo   
   )  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
   WHERE 1 = 1   And   M.acmYear =105 And M.acmKidNum='OTPay'
 Or M.acmWordNum='10513100'

 Order by  M.acmYear, M.acmWordNum Desc, M.acmNo Desc 
) DS 
 Order By  
 acmYear, acmWordNum Desc, acmNo Desc 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:52#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
Select Distinct * 
               From (  
 SELECT Distinct Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , M.acmWorkUserNo, M.acmMoney, M.acmMemo  
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate, M.acmSubsidyCode, M.acmPayName
               , M.acmPassUser, M.acmPassDate, M.acmPassMoney, M.acmPassMemo  
               , M.acmUnitPassFlag, M.acmUnitPassUser, M.acmUnitPassDate 
  , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
  , (Select acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
  , (Select acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
  , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
              , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
              , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
              , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo  ) as PCounter 
              , IsNull( M.acmBgtKind ,'0') As acmBgtKind, M.acmEmpNo  
              , M.acmEtcPayment, M.acmSubMemo, M.acmProdDepCode, M.acmVisaKindCode, M.acmProdMethodCode 
              , M.acmCateGrpFlag, M.acmAutoPrePayFlag 
              , M.acmModifyUser 

  FROM (actMain M INNER JOIN actVisa V ON M.acmYear =105 And M.acmYear = V.acmYear AND V.acmNo = M.acmNo   
   )  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
   WHERE 1 = 1   And   M.acmYear =105 And M.acmKidNum='OTPay'
 Or M.acmWordNum='10513100'

 Order by  M.acmYear, M.acmWordNum Desc, M.acmNo Desc 
) DS 
 Order By  
 acmYear, acmWordNum Desc, acmNo Desc 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select Distinct *   
 , IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) As TopWordNum  
           From ( 
 SELECT Distinct  Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As FullAcmWordNum 
               , M.acmWorkUserNo, M.acmMoney 
               , M.acmMemo, M.acmModifyUser  
               , M.acmPassUser, M.acmPassDate 
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate 
               , M.acmPassMoney, M.acmPassMemo 
               , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
               , (Select Top 1 acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
               , (Select Top 1 acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
               , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
               , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
               , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
               , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo ) as PCounter 
               , IsNull( M.acmBgtKind ,'0') As acmBgtKind  
               , M.acmSubsidyCode, M.acmEmpNo, M.acmUnitPassFlag, M.acmUnitPassDate, M.acmUnitPassUser, M.acmPayName 
               , M.acmVisaKindCode, VK.vskName, M.acmProdMethodCode,  PM.pcmName, M.acmEtcPayment  
               , M.acmAutoBidFlag, M.acmAutoPrePayFlag, M.acmReadyFlag, M.acmProdDepCode, M.acmBaseItemsKindCode, M.acmSubMemo 
               , BI.baiName, M.acmPayHour As acpPayHour, M.acmReturnDate As acpReturnDate, M.acmPrePayDate As acpPrePayDate 
               , M.acmRequireDepCode, acmRequireUserName, (Select dptName From codDepartName Where dptCode =M.acmRequireDepCode) As acmRequireDepName 
               , M.acmCateGrpFlag, M.acmRequireDate, M.acmSelfProdFlag 
               , M.acmReserveFlag, M.acmReserveWordNum 
               , M.acmActKind ,M.acmPayeeNo , M.acmTrlAppCode
               ,(Select ISNULL((CONVERT(nvarchar(120), T.plnTrlAppCode)+' '+T.plnTrlAppName),'') as plnTrlAppName From actPlanApproval as T Where T.acmYear=M.acmYear And T.plnTrlAppCode=M.acmTrlAppCode ) As acmTrlAppName  
  FROM (actMain M Join actVisa V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
 Left Join codAccKindName K On 
 IsNull( V.acvAccKind,'') = K.accKind 
 Left Join codVisaKind VK On 
 M.acmVisaKindCode=VK.vskCode  Left Join codProdMethod PM On 
 M.acmProdMethodCode=PM.pcmCode  Left Join codBaseItems BI On 
 M.acmProdDepCode=BI.baiCode And M.acmBaseItemsKindCode=BI.bakCode    WHERE 1 = 1   And   M.acmYear =105 And ( 1=1 
 And  M.acmNo =20033
 And M.acmKidNum='OTPay'
 )  Order by  M.acmYear, IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) Desc, M.acmNo 
 Union All 
 SELECT Distinct  Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As FullAcmWordNum 
               , M.acmWorkUserNo, M.acmMoney 
               , M.acmMemo, M.acmModifyUser  
               , M.acmPassUser, M.acmPassDate 
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate 
               , M.acmPassMoney, M.acmPassMemo 
               , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
               , (Select Top 1 acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
               , (Select Top 1 acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
               , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
               , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
               , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
               , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo ) as PCounter 
               , IsNull( M.acmBgtKind ,'0') As acmBgtKind  
               , M.acmSubsidyCode, M.acmEmpNo, M.acmUnitPassFlag, M.acmUnitPassDate, M.acmUnitPassUser, M.acmPayName 
               , M.acmVisaKindCode, VK.vskName, M.acmProdMethodCode,  PM.pcmName, M.acmEtcPayment  
               , M.acmAutoBidFlag, M.acmAutoPrePayFlag, M.acmReadyFlag, M.acmProdDepCode, M.acmBaseItemsKindCode, M.acmSubMemo 
               , BI.baiName, M.acmPayHour As acpPayHour, M.acmReturnDate As acpReturnDate, M.acmPrePayDate As acpPrePayDate 
               , M.acmRequireDepCode, acmRequireUserName, (Select dptName From codDepartName Where dptCode =M.acmRequireDepCode) As acmRequireDepName 
               , M.acmCateGrpFlag, M.acmRequireDate, M.acmSelfProdFlag 
               , M.acmReserveFlag, M.acmReserveWordNum 
               , M.acmActKind ,M.acmPayeeNo , M.acmTrlAppCode
               ,(Select ISNULL((CONVERT(nvarchar(120), T.plnTrlAppCode)+' '+T.plnTrlAppName),'') as plnTrlAppName From actPlanApproval as T Where T.acmYear=M.acmYear And T.plnTrlAppCode=M.acmTrlAppCode ) As acmTrlAppName  
  FROM (actMain M Join actVisaMore V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
 Left Join codAccKindName K On 
 IsNull( V.acvAccKind,'') = K.accKind 
 Left Join codVisaKind VK On 
 M.acmVisaKindCode=VK.vskCode  Left Join codProdMethod PM On 
 M.acmProdMethodCode=PM.pcmCode  Left Join codBaseItems BI On 
 M.acmProdDepCode=BI.baiCode And M.acmBaseItemsKindCode=BI.bakCode    WHERE 1 = 1   And   M.acmYear =105 And ( 1=1 
 And  M.acmNo =20033
 And M.acmKidNum='OTPay'
 )  Order by  M.acmYear, IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) Desc, M.acmNo 
 ) DS 
 Order By  acmYear, IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) Desc, acmNo 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select Distinct  
                 PV.acmYear, PV.acmNo, PV.acpPayYear, PV.acpPayNo, PV.acvNo, PV.acmNo1, PV.acvNo1, PV.acmNo2 
               , PV.acvNo2, PV.acvSubNo, PV.acmNoPrv, PV.acvPlanCode, PV.acvOutlayYear, PV.acvOutlayCode 
               , PV.acvBgtSourceCode, PV.acvAccKind, PV.acvBizCode, PV.acvPrePayFlag, PV.acvVisaMoney  
               , PV.acvMoney, PV.acvDateMemo, PV.acvMemo, PV.acvFinalKind, PV.acvFinalDate, PV.acvAdjustMoney 
               -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位 
               -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvExchNo  
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvWExchNo as acvExchNo 
               , PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, ISNULL(CASE WHEN PV.acmYear<=104 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'') as acvExchNo  
               , PV.acvPassMoney, PV.acvPassAdjustMoney, PV.inspect  
               , P.acpBgtUnitNo, P.acpMarkDate, P.acpMoney, P.acpMemo, P.acpProdVisaKind, P.acpGroupNo , P.acpMarkUnitNo   
               , P.acpPassFlag, P.acpPassDate, P.acpPassMoney, P.acpPassBat, P.acpPassMemo,  P.acpPassUser 
               , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName , BZ.bizName   
               , BD.dptName As acpBgtDepName, BDV.dptName As acvBgtDepName, P.acpPayName 
              -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位,acvTranBNo 改取 acvWTranBNo 欄位 
              -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
              --, ( Case When IsNull(acvTranBNo,'')='' Or IsNull( acvExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
              --, ( Case When IsNull(acvWTranBNo,'')='' Or IsNull( acvWExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
                , ( Case When IsNull(CASE WHEN PV.acmYear<= 105 THEN PV.acvTranBNo ELSE PV.acvWTranBNo END,'')='' 
                           Or IsNull(CASE WHEN PV.acmYear<= 105 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'')='' 
                         Then '0' Else '1' End ) As EditFlag    
               , PV.acvBgtDepCode, PV.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, PV.acvPlanCode) As plnAliasNo 
               , PV.acvCostKind, CK.cskName As CostKindName  
               , V.acvBgtYear, V.acvBgtMonth, V.acvBgtSourCnt 
       FROM actPayVisa  PV  
               Left Join actPay P On P.acmYear = PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo) And P.acpPayYear =PV.acpPayYear and P.acpPayNo=PV.acpPayNo 
               Left Join actVisa V On PV.acmYear=V.acmYear And PV.acmNo=V.acmNo And PV.acvNo=V.acvNo 
 Left Join codAccKindName K On   IsNull(PV.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(PV.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( PV.acvPlanCode,'') = PN.plnPlanCode   And IsNull(PV.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  PV.acvOutlayCode = O.oulOutlayCode   And PV.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(PV.acvBizCode,'' ) = BZ.BizCode  And IsNull(PV.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(P.acpBgtUnitNo, P.acpMarkUnitNo)  
 Left Join codDepartName BDV On  BDV.dptCode  = IsNull(PV.acvBgtDepCode,'')  
 Left Join codPlanCategory PC On PC.plnCateCode=PV.acvPlanCateCode 
 Left Join codCostKind CK On CK.cskCode= PV.acvCostKind 
 Where P.acmYear=105
 And P.acmNo=20033
 And P.acpPayYear=105
 And P.acpPayNo=1

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
--[Parameter Count:4]
--@parAcmYear=105
--@parAcmNo=20033
--@parAcpPayYear=105
--@parAcpPayNo=1
 Select O.oulOutlayName as OulName, P.plnPlanName as PlanName , BO.orgName  , K.accKindName ,   PVG.* From actPayVisaGBA PVG  Left Join codOutlayCode O On  IsNull(PVG.acvOutlayCode ,'') = O.oulOutlayCode  And IsNull(PVG.acvOutlayYear, '0') = O.codCodeVer  Left Join codPlanCode P On  IsNull(PVG.acvPlanCode,'') = P.plnPlanCode  And IsNull(PVG.acvOutlayYear,'0') = P.codCodeVer  Left Join codBgtOrigin BO On  IsNull(PVG.acvBgtSourceCode,'') = BO.orgCode  Left Join codAccKindName K On  IsNull(PVG.acvAccKind,'') = K.accKind    Where  1=1  And  PVG.acmYear=105  And PVG.acmNoPrv=20033  And PVG.acpPayYear =105  And PVG.acpPayNo =1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select A.accKind, A.accKindName,  A.ackCreateDate, A.ackStopFlag, A.ackStopDate  FROM codAccKindName A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select Convert(varchar, A.orgCode) as orgCode, A.orgName   FROM codBgtOrigin A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select   Convert(varchar, A.codCodeVer) + ':' +  A.plnPlanCode as plnPlanCode,  A.plnPlanCode + '　' + A.plnPlanName as plnPlanName FROM codPlanCode A  Where A.codCodeVer =105  and A.plnLevel >=  1  Order By  1, 2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select DISTINCT  LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  FROM codOutlayCode A  LEFT OUTER JOIN codOutlayCode B ON A.codCodeVer = B.codCodeVer AND A.oulOutlayCode LIKE B.oulOutlayCode + '_%' LEFT OUTER JOIN codOutlayCode C ON A.codCodeVer = C.codCodeVer AND A.OulLevel = C.OulLevel + 1 AND A.oulOutlayCode LIKE C.oulOutlayCode + '_%'  Right Join actAccCode Q on  Q.accCodeVer= A.codCodeVer and Q.accOutlayCode=A.oulOutlayCode  WHERE (A.codCodeVer = 105)  AND (ISNULL( A.oulCreateDate,'')<='2016/01/09' AND ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>'2016/01/09'))  AND (ISNULL( Q.accCreateDate,'')<='2016/01/09' AND ( ISNULL(Q.accStopFlag,'')<>'1' OR Q.accStopDate>'2016/01/09')) 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.OTPay.Web/FrmActPayOther.aspx?MenuID=1727
 Select acmYear, acmNoPrv, acpPayYear, acpPayNo 
           From cashDtl CD 
       Where CD.acmYear=105 And IsNull(CD.acmNoPrv, CD.acmNo)=20033
           And CD.acpPayYear=105 And CD.acpPayNo=1
 Union 
 Select  acmYear, acmNoPrv, acpPayYear, acpPayNo  
           From cashDtl1 CD 
       Where CD.acmYear=105 And  IsNull(CD.acmNoPrv, CD.acmNo)=20033
           And CD.acpPayYear=105 And CD.acpPayNo=1

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
--[Parameter Count:1]
--@parMenuID='1321'
 Select * From SysMenuBase Where PK_MnuNo ='1321' 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select  * 
       From attKind K  
           Join attInheritModule I ON I.atiCode = K.atkAtiCode  
       Where  '{墊借申請}' like '%' + I.atiName + '%'
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Distinct                                   IsNull(IsNull(V2.acmYear, V1.acmYear), V.acmYear) As AcmYear,   IsNull(IsNull(V2.acmNo, V1.acmNo), V.acmNo) As acmNo  
                              ,  IsNull(IsNull(V2.acvNo, V1.acvNo), V.acvNo) As acvNo   
                              ,  IsNull(IsNull(V2.acmNo1, V1.acmNo1), 0) As acmNo1, IsNull(IsNull(V2.acvNo1, V1.acvNo1), 0) As acvNo1  
                              ,  IsNull(V2.acmNo2, 0)  As acmNo2,  IsNull(V2.acvNo2, 0)  As acvNo2  
                              ,  IsNull(IsNull(IsNull(V2.acvBgtYear, V1.acvBgtYear), V.acvBgtYear), M.acmYear) As acvBgtYear   
                              ,  IsNull(IsNull(IsNull(V2.acvBgtMonth, V1.acvBgtMonth), V.acvBgtMonth), M.acmMonth) As acvBgtMonth   
                              ,  IsNull(IsNull(V2.acvPlanCode, V1.acvPlanCode), V.acvPlanCode) As acvPlanCode   
                              ,  IsNull(IsNull(V2.acvOutlayYear, V1.acvOutlayYear), V.acvOutlayYear) As acvOutlayYear    
                              ,  IsNull(IsNull(V2.acvOutlayCode, V1.acvOutlayCode), V.acvOutlayCode) As acvOutlayCode   
                              ,  IsNull(IsNull(V2.acvBgtSourceCode, V1.acvBgtSourceCode), V.acvBgtSourceCode) As acvBgtSourceCode   
                              ,  IsNull(IsNull(V2.acvAccKind, V1.acvAccKind), V.acvAccKind) As acvAccKind   
                              ,  IsNull(IsNull(V2.acvBizCode, V1.acvBizCode), V.acvBizCode) As acvBizCode   
                              ,  IsNull(IsNull(V2.acvPrePayFlag, V1.acvPrePayFlag), V.acvPrePayFlag) As acvPrePayFlag   
                              ,  IsNull(IsNull(V2.acvMoney, V1.acvMoney), V.acvMoney) As acvMoney   
                              ,  IsNull(IsNull(V2.acvMemo, V1.acvMemo), V.acvMemo) As acvMemo   
                              ,  IsNull(IsNull(V2.acmNoPrv, V1.acmNoPrv), V.acmNo) As acmNoPrv   
                              ,  IsNull(IsNull(V2.inspect, V1.inspect), V.inspect) As inspect   
                              ,  IsNull(IsNull(V2.acvPassAdjustMoney, V1.acvPassAdjustMoney), V.acvPassAdjustMoney) As acvPassAdjustMoney   
                              ,  IsNull(IsNull(M1.acmBgtUnitNo, M1.acmWorkUnitNo), IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)) As acmBgtUnitNo   
                              , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName, IsNull(PN.plnAliasNo, PN.plnPlanCode) As plnAliasNo                               , BZ.bizName, BD.dptName As BgtDepName, WD.dptName As WorkDepName 
                              , IsNull(IsNull(V2.acvMoney, V1.acvMoney), V.acvMoney) -  
                                IsNull((Select  Sum(IsNull(PVD.acvMoney, 0) + IsNull(PVD.acvAdjustMoney,0)) From actPayVisa PVD  
                                                                      Where PVD.acmYear=  IsNull(IsNull(V2.acmYear, V1.acmYear), V.acmYear) 
                                                                                  And PVD.acmNo = IsNull(IsNull(V2.acmNo, V1.acmNo), V.acmNo)    
                                                                                  And PVD.acvNo = IsNull(IsNull(V2.acvNo, V1.acvNo), V.acvNo)     
                                                                                  And PVD.acmNo1= IsNull(IsNull(V2.acmNo1, V1.acmNo1), 0)    
                                                                                  And PVD.acvNo1=  IsNull(IsNull(V2.acvNo1, V1.acvNo1), 0)    
                                                                                  And PVD.acmNo2=  IsNull(V2.acmNo2, 0)    
                                                                                  And PVD.acvNo2= IsNull(V2.acvNo2, 0)    
                                 ),0) As VisaMoneyLeft 
                              , IsNull(( Select sum(IsNull(PVD.acvMoney,0) + IsNull(PVD.acvAdjustMoney,0) ) From actPayVisa  PVD    
                                                                      Where PVD.acmYear=  IsNull(IsNull(V2.acmYear, V1.acmYear), V.acmYear) 
                                                                                  And PVD.acmNo = IsNull(IsNull(V2.acmNo, V1.acmNo), V.acmNo)    
                                                                                  And PVD.acvNo = IsNull(IsNull(V2.acvNo, V1.acvNo), V.acvNo)     
                                                                                  And PVD.acmNo1= IsNull(IsNull(V2.acmNo1, V1.acmNo1), 0)    
                                                                                  And PVD.acvNo1=  IsNull(IsNull(V2.acvNo1, V1.acvNo1), 0)    
                                                                                  And PVD.acmNo2=  IsNull(V2.acmNo2, 0)    
                                                                                  And PVD.acvNo2= IsNull(V2.acvNo2, 0)    
                                                                  And PVD.acpPayYear=1 And PVD.acpPayNo=1
                                  ), 0) As TotalPayThisTime 
                               , IsNull(V1.acvBgtDepCode, V.acvBgtDepCode) As acvBgtDepCode 
                               , (Select dptName From codDepartName Where dptCode=IsNull(V1.acvBgtDepCode, V.acvBgtDepCode) ) As acvBgtDepName 
                               , V.acvCostKind, CK.cskName As CostKindName, V.acvBgtSourCnt  
  FROM (actMain M INNER JOIN actVisa V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 Join (  
                 SELECT  
                                      IsNull(IsNull     (NULLIF (acmTopWordNum, ''), NULLIF (acmSourWordNum, '')) , acmWordNum) AS acmWordNum  
                                   , Z.acmYear, Sum(Z.acmMoney) as acmMoney    
                         FROM actMain Z    
                         Where  Z.acmYear = 1
 And  Z.acmNo= 1                          GROUP BY   IsNull(IsNull(NULLIF (acmTopWordNum, ''), NULLIF (acmSourWordNum, '')), acmWordNum), Z.acmYear 
          ) X On    
                      X.acmWordNum = IsNull(IsNull(NULLIF (M.acmTopWordNum, ''), NULLIF (M.acmSourWordNum, '')), M.acmWordNum)  
            AND X.acmyear = M.acmYear       Left Join  
         	(actMain1 M1 Join actVisa1 V1 On M1.acmYear=V1.acmYear And M1.acmNo=IsNull(V1.acmNoPrv,V1.acmNo ) And M1.acmNo1=V1.acmNo1 ) 
              On V1.acmYear=V.acmYear And V1.acmNo=V.acmNo And V1.acvNo=V.acvNo  Left Join    
           ( actMain2 M2 Join actVisa2 V2 On M2.acmYear=V2.acmYear And M2.acmNo=IsNull(V2.acmNoPrv,V2.acmNo ) And M2.acmNo1=V2.acmNo1 And M2.acmNo2=V2.acmNo2 ) 
               On V2.acmYear=IsNull(V1.acmYear,V.acmYear) And V2.acmNo=IsNull(V1.acmNo,V.acmNo) And V2.acvNo=IsNull(V1.acvNo,V.acvNo ) 
                                                          And V2.acmNo1=IsNull(V1.acmNo1,0) And V2.acvNo1=IsNull(V1.acvNo1,0 )   
 LEFT OUTER JOIN codDepartName WD ON 
 IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo) = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON   
 IsNull(IsNull(M1.acmBgtUnitNo, M1.acmWorkUnitNo), IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo))  = BD.dptCode  
 Left Join codOutlayCode O On  IsNull(IsNull(V2.acvOutlayCode, V1.acvOutlayCode), V.acvOutlayCode)  = O.oulOutlayCode  
 And  IsNull(IsNull(V2.acvOutlayYear, V1.acvOutlayYear), V.acvOutlayYear)  = O.codCodeVer  
 Left Join codPlanCode PN On  
 IsNull(IsNull(V2.acvPlanCode, V1.acvPlanCode), V.acvPlanCode)= PN.plnPlanCode  
 And  IsNull(IsNull(V2.acvOutlayYear, V1.acvOutlayYear), V.acvOutlayYear) = PN.codCodeVer   
 Left Join codBgtOrigin BO On  
 IsNull(IsNull(V2.acvBgtSourceCode, V1.acvBgtSourceCode), V.acvBgtSourceCode) = BO.orgCode  
 Left Join codAccKindName K On 
IsNull(IsNull(V2.acvAccKind, V1.acvAccKind), V.acvAccKind) = K.accKind  
 Left Join codBizName BZ On 
 IsNull(IsNull(V2.acvBizCode, V1.acvBizCode), V.acvBizCode) = BZ.BizCode 
 And  IsNull(IsNull(V2.acvOutlayYear, V1.acvOutlayYear), V.acvOutlayYear)  = BZ.codCodeVer 
 Left Join codCostKind CK On  
 IsNull(IsNull(V2.acvCostKind, V1.acvCostKind), V.acvCostKind) = CK.cskCode 
 Left Join actMain1Group MG On MG.acmYear=V1.acmYear And MG.acmNo=IsNull(V1.acmNoPrv, V1.acmNo) And MG.acmNo1=V1.acmNo1    WHERE 1 = 1   And   IsNull(IsNull(V2.acmYear, V1.acmYear), V.acmYear) =1 And  IsNull(IsNull(ISNULL(MG.acmTopNo1, MG.acmSourNo1), MG.acmNo1), IsNull(IsNull(V2.AcmNo1, V1.AcmNo1), 0)) = 1 Order by  IsNull(IsNull(V2.acmYear, V1.acmYear), V.acmYear),  IsNull(IsNull(V2.acmNo, V1.acmNo), V.acmNo),  IsNull(IsNull(V2.acvNo, V1.acvNo), V.acvNo) ,IsNull(IsNull(V2.AcmNo1, V1.AcmNo1), 0) 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Distinct  
                 PV.acmYear, PV.acmNo, PV.acpPayYear, PV.acpPayNo, PV.acvNo, PV.acmNo1, PV.acvNo1, PV.acmNo2 
               , PV.acvNo2, PV.acvSubNo, PV.acmNoPrv, PV.acvPlanCode, PV.acvOutlayYear, PV.acvOutlayCode 
               , PV.acvBgtSourceCode, PV.acvAccKind, PV.acvBizCode, PV.acvPrePayFlag, PV.acvVisaMoney  
               , PV.acvMoney, PV.acvDateMemo, PV.acvMemo, PV.acvFinalKind, PV.acvFinalDate, PV.acvAdjustMoney 
               -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位 
               -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvExchNo  
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvWExchNo as acvExchNo 
               , PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, ISNULL(CASE WHEN PV.acmYear<=104 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'') as acvExchNo  
               , PV.acvPassMoney, PV.acvPassAdjustMoney, PV.inspect  
               , P.acpBgtUnitNo, P.acpMarkDate, P.acpMoney, P.acpMemo, P.acpProdVisaKind, P.acpGroupNo , P.acpMarkUnitNo   
               , P.acpPassFlag, P.acpPassDate, P.acpPassMoney, P.acpPassBat, P.acpPassMemo,  P.acpPassUser 
               , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName , BZ.bizName   
               , BD.dptName As acpBgtDepName, BDV.dptName As acvBgtDepName, P.acpPayName 
              -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位,acvTranBNo 改取 acvWTranBNo 欄位 
              -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
              --, ( Case When IsNull(acvTranBNo,'')='' Or IsNull( acvExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
              --, ( Case When IsNull(acvWTranBNo,'')='' Or IsNull( acvWExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
                , ( Case When IsNull(CASE WHEN PV.acmYear<= 1 THEN PV.acvTranBNo ELSE PV.acvWTranBNo END,'')='' 
                           Or IsNull(CASE WHEN PV.acmYear<= 1 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'')='' 
                         Then '0' Else '1' End ) As EditFlag    
               , PV.acvBgtDepCode, PV.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, PV.acvPlanCode) As plnAliasNo 
               , PV.acvCostKind, CK.cskName As CostKindName  
               , V.acvBgtYear, V.acvBgtMonth, V.acvBgtSourCnt 
       FROM actPayVisa  PV  
               Left Join actPay P On P.acmYear = PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo) And P.acpPayYear =PV.acpPayYear and P.acpPayNo=PV.acpPayNo 
               Left Join actVisa V On PV.acmYear=V.acmYear And PV.acmNo=V.acmNo And PV.acvNo=V.acvNo 
 Left Join codAccKindName K On   IsNull(PV.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(PV.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( PV.acvPlanCode,'') = PN.plnPlanCode   And IsNull(PV.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  PV.acvOutlayCode = O.oulOutlayCode   And PV.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(PV.acvBizCode,'' ) = BZ.BizCode  And IsNull(PV.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(P.acpBgtUnitNo, P.acpMarkUnitNo)  
 Left Join codDepartName BDV On  BDV.dptCode  = IsNull(PV.acvBgtDepCode,'')  
 Left Join codPlanCategory PC On PC.plnCateCode=PV.acvPlanCateCode 
 Left Join codCostKind CK On CK.cskCode= PV.acvCostKind 
 Where P.acmYear=1
 And P.acmNo=1
 And IsNull(P.acmNo1,0)=1
 And P.acpPayYear=1
 And P.acpPayNo=1

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
--[Parameter Count:5]
--@parAcmYear=1
--@parAcmNo=1
--@parAcmNo1=1
--@parAcpPayYear=1
--@parAcpPayNo=1
 Select O.oulOutlayName as OulName, P.plnPlanName as PlanName , BO.orgName  , K.accKindName ,   PVG.* From actPayVisaGBA PVG  Left Join codOutlayCode O On  IsNull(PVG.acvOutlayCode ,'') = O.oulOutlayCode  And IsNull(PVG.acvOutlayYear, '0') = O.codCodeVer  Left Join codPlanCode P On  IsNull(PVG.acvPlanCode,'') = P.plnPlanCode  And IsNull(PVG.acvOutlayYear,'0') = P.codCodeVer  Left Join codBgtOrigin BO On  IsNull(PVG.acvBgtSourceCode,'') = BO.orgCode  Left Join codAccKindName K On  IsNull(PVG.acvAccKind,'') = K.accKind    Where  1=1  And  PVG.acmYear=1  And PVG.acmNoPrv=1  And PVG.acmNo1 =11  And PVG.acpPayYear =1  And PVG.acpPayNo =1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select  Distinct 
               PD.acmYear, PD.acmNo 
           , PD.acmNo1, PD.acdNo 
           , IsNull(PD.acpPayYear, 0) As acpPayYear, IsNull( PD.acpPayNo,0) As acpPayNo, IsNull(PD.acpPayNo1,0) As acpPayNo1 
           , PD.acdProdCode  
           , PD.acdProdName 
           , PD.acdProdRule 
           , PD.acdProdSup 
           , PD.acdProdUnit 
           , PD.acdProdQry 
           , PD.acdMemo 
           , PD.acdProdPrice 
           , PD.acdMoney 
           , PD.acdProdPriceFac1 
           , PD.acdProdMoneyFac1 
           , PD.acdProdPriceFac2 
           , PD.acdProdMoneyFac2 
           , PD.acdProdPriceFac3 
           , PD.acdProdMoneyFac3 
           , PD.acdProdCause
           , PC.prcName As acdProdCauseName 
           , PP.acmProdFactory 
           , PP.acmProdMoney 
           , PP.acmProdFactory1, PP.acmProdFactory2, PP.acmProdFactory3 
       From  actPayDtlProd PD 
               Left Join codProdCause PC On PC.prcCode=IsNull(PD.acdProdCause, '') 
               Left Join actPayProd PP On PP.acmYear=PD.acmYear And PP.acmNo=PD.acmNo And PP.acpPayYear =PD.acpPayYear And PP.acpPayNo=PD.acpPayNo And PP.acpPayNo1=PD.acpPayNo1 
       Where 1 = 1 And PD.acmYear=1
                   And PD.acmNo=1
 And IsNull( PD.acpPayNo,0)=1 And IsNull(PD.acpPayYear, 0)=1 And IsNull(PD.acpPayNo1, 0)=1
 Order By  1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
Select *   FROM actMainProd    Where acmYear =1 And acmNo=1 And acmNo1=1 Order By  1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Distinct atkCode, atkName 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=744
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And 1=2 
                   And TM.atkCode In ('01', '02') And 1=2                    ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=744
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
 And 1=2 )  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Distinct atmCode, atmName, atkCode 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=744
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And 1=2 
                   And TM.atkCode In ('01', '02') And 1=2                    ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=744
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
 And 1=2 )  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Distinct atdNo, atdNameHtml, atmCode 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=744
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And 1=2 
                   And TM.atkCode In ('01', '02') And 1=2                    ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=744
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
 And 1=2 )  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 177) AND ISNULL(mnuLevel,0)> -100 AND (ISNULL(mnuLevel,0)=0 OR mnuLevel >=1 OR mnuLevel=1*-1 OR mnuLevel<=-90)  ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Distinct                                   IsNull(IsNull(V2.acmYear, V1.acmYear), V.acmYear) As AcmYear,   IsNull(IsNull(V2.acmNo, V1.acmNo), V.acmNo) As acmNo  
                              ,  IsNull(IsNull(V2.acvNo, V1.acvNo), V.acvNo) As acvNo   
                              ,  IsNull(IsNull(V2.acmNo1, V1.acmNo1), 0) As acmNo1, IsNull(IsNull(V2.acvNo1, V1.acvNo1), 0) As acvNo1  
                              ,  IsNull(V2.acmNo2, 0)  As acmNo2,  IsNull(V2.acvNo2, 0)  As acvNo2  
                              ,  IsNull(IsNull(IsNull(V2.acvBgtYear, V1.acvBgtYear), V.acvBgtYear), M.acmYear) As acvBgtYear   
                              ,  IsNull(IsNull(IsNull(V2.acvBgtMonth, V1.acvBgtMonth), V.acvBgtMonth), M.acmMonth) As acvBgtMonth   
                              ,  IsNull(IsNull(V2.acvPlanCode, V1.acvPlanCode), V.acvPlanCode) As acvPlanCode   
                              ,  IsNull(IsNull(V2.acvOutlayYear, V1.acvOutlayYear), V.acvOutlayYear) As acvOutlayYear    
                              ,  IsNull(IsNull(V2.acvOutlayCode, V1.acvOutlayCode), V.acvOutlayCode) As acvOutlayCode   
                              ,  IsNull(IsNull(V2.acvBgtSourceCode, V1.acvBgtSourceCode), V.acvBgtSourceCode) As acvBgtSourceCode   
                              ,  IsNull(IsNull(V2.acvAccKind, V1.acvAccKind), V.acvAccKind) As acvAccKind   
                              ,  IsNull(IsNull(V2.acvBizCode, V1.acvBizCode), V.acvBizCode) As acvBizCode   
                              ,  IsNull(IsNull(V2.acvPrePayFlag, V1.acvPrePayFlag), V.acvPrePayFlag) As acvPrePayFlag   
                              ,  IsNull(IsNull(V2.acvMoney, V1.acvMoney), V.acvMoney) As acvMoney   
                              ,  IsNull(IsNull(V2.acvMemo, V1.acvMemo), V.acvMemo) As acvMemo   
                              ,  IsNull(IsNull(V2.acmNoPrv, V1.acmNoPrv), V.acmNo) As acmNoPrv   
                              ,  IsNull(IsNull(V2.inspect, V1.inspect), V.inspect) As inspect   
                              ,  IsNull(IsNull(V2.acvPassAdjustMoney, V1.acvPassAdjustMoney), V.acvPassAdjustMoney) As acvPassAdjustMoney   
                              ,  IsNull(IsNull(M1.acmBgtUnitNo, M1.acmWorkUnitNo), IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)) As acmBgtUnitNo   
                              , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName, IsNull(PN.plnAliasNo, PN.plnPlanCode) As plnAliasNo                               , BZ.bizName, BD.dptName As BgtDepName, WD.dptName As WorkDepName 
                              , IsNull(IsNull(V2.acvMoney, V1.acvMoney), V.acvMoney) -  
                                IsNull((Select  Sum(IsNull(PVD.acvMoney, 0) + IsNull(PVD.acvAdjustMoney,0)) From actPayVisa PVD  
                                                                      Where PVD.acmYear=  IsNull(IsNull(V2.acmYear, V1.acmYear), V.acmYear) 
                                                                                  And PVD.acmNo = IsNull(IsNull(V2.acmNo, V1.acmNo), V.acmNo)    
                                                                                  And PVD.acvNo = IsNull(IsNull(V2.acvNo, V1.acvNo), V.acvNo)     
                                                                                  And PVD.acmNo1= IsNull(IsNull(V2.acmNo1, V1.acmNo1), 0)    
                                                                                  And PVD.acvNo1=  IsNull(IsNull(V2.acvNo1, V1.acvNo1), 0)    
                                                                                  And PVD.acmNo2=  IsNull(V2.acmNo2, 0)    
                                                                                  And PVD.acvNo2= IsNull(V2.acvNo2, 0)    
                                 ),0) As VisaMoneyLeft 
                              , IsNull(( Select sum(IsNull(PVD.acvMoney,0) + IsNull(PVD.acvAdjustMoney,0) ) From actPayVisa  PVD    
                                                                      Where PVD.acmYear=  IsNull(IsNull(V2.acmYear, V1.acmYear), V.acmYear) 
                                                                                  And PVD.acmNo = IsNull(IsNull(V2.acmNo, V1.acmNo), V.acmNo)    
                                                                                  And PVD.acvNo = IsNull(IsNull(V2.acvNo, V1.acvNo), V.acvNo)     
                                                                                  And PVD.acmNo1= IsNull(IsNull(V2.acmNo1, V1.acmNo1), 0)    
                                                                                  And PVD.acvNo1=  IsNull(IsNull(V2.acvNo1, V1.acvNo1), 0)    
                                                                                  And PVD.acmNo2=  IsNull(V2.acmNo2, 0)    
                                                                                  And PVD.acvNo2= IsNull(V2.acvNo2, 0)    
                                                                  And PVD.acpPayYear=106 And PVD.acpPayNo=1
                                  ), 0) As TotalPayThisTime 
                               , IsNull(V1.acvBgtDepCode, V.acvBgtDepCode) As acvBgtDepCode 
                               , (Select dptName From codDepartName Where dptCode=IsNull(V1.acvBgtDepCode, V.acvBgtDepCode) ) As acvBgtDepName 
                               , V.acvCostKind, CK.cskName As CostKindName, V.acvBgtSourCnt  
  FROM (actMain M INNER JOIN actVisa V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 Join (  
                 SELECT  
                                      IsNull(IsNull     (NULLIF (acmTopWordNum, ''), NULLIF (acmSourWordNum, '')) , acmWordNum) AS acmWordNum  
                                   , Z.acmYear, Sum(Z.acmMoney) as acmMoney    
                         FROM actMain Z    
                         Where  Z.acmYear = 106
 And  Z.acmNo= 744                          GROUP BY   IsNull(IsNull(NULLIF (acmTopWordNum, ''), NULLIF (acmSourWordNum, '')), acmWordNum), Z.acmYear 
          ) X On    
                      X.acmWordNum = IsNull(IsNull(NULLIF (M.acmTopWordNum, ''), NULLIF (M.acmSourWordNum, '')), M.acmWordNum)  
            AND X.acmyear = M.acmYear       Left Join  
         	(actMain1 M1 Join actVisa1 V1 On M1.acmYear=V1.acmYear And M1.acmNo=IsNull(V1.acmNoPrv,V1.acmNo ) And M1.acmNo1=V1.acmNo1 ) 
              On V1.acmYear=V.acmYear And V1.acmNo=V.acmNo And V1.acvNo=V.acvNo  Left Join    
           ( actMain2 M2 Join actVisa2 V2 On M2.acmYear=V2.acmYear And M2.acmNo=IsNull(V2.acmNoPrv,V2.acmNo ) And M2.acmNo1=V2.acmNo1 And M2.acmNo2=V2.acmNo2 ) 
               On V2.acmYear=IsNull(V1.acmYear,V.acmYear) And V2.acmNo=IsNull(V1.acmNo,V.acmNo) And V2.acvNo=IsNull(V1.acvNo,V.acvNo ) 
                                                          And V2.acmNo1=IsNull(V1.acmNo1,0) And V2.acvNo1=IsNull(V1.acvNo1,0 )   
 LEFT OUTER JOIN codDepartName WD ON 
 IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo) = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON   
 IsNull(IsNull(M1.acmBgtUnitNo, M1.acmWorkUnitNo), IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo))  = BD.dptCode  
 Left Join codOutlayCode O On  IsNull(IsNull(V2.acvOutlayCode, V1.acvOutlayCode), V.acvOutlayCode)  = O.oulOutlayCode  
 And  IsNull(IsNull(V2.acvOutlayYear, V1.acvOutlayYear), V.acvOutlayYear)  = O.codCodeVer  
 Left Join codPlanCode PN On  
 IsNull(IsNull(V2.acvPlanCode, V1.acvPlanCode), V.acvPlanCode)= PN.plnPlanCode  
 And  IsNull(IsNull(V2.acvOutlayYear, V1.acvOutlayYear), V.acvOutlayYear) = PN.codCodeVer   
 Left Join codBgtOrigin BO On  
 IsNull(IsNull(V2.acvBgtSourceCode, V1.acvBgtSourceCode), V.acvBgtSourceCode) = BO.orgCode  
 Left Join codAccKindName K On 
IsNull(IsNull(V2.acvAccKind, V1.acvAccKind), V.acvAccKind) = K.accKind  
 Left Join codBizName BZ On 
 IsNull(IsNull(V2.acvBizCode, V1.acvBizCode), V.acvBizCode) = BZ.BizCode 
 And  IsNull(IsNull(V2.acvOutlayYear, V1.acvOutlayYear), V.acvOutlayYear)  = BZ.codCodeVer 
 Left Join codCostKind CK On  
 IsNull(IsNull(V2.acvCostKind, V1.acvCostKind), V.acvCostKind) = CK.cskCode 
 Left Join actMain1Group MG On MG.acmYear=V1.acmYear And MG.acmNo=IsNull(V1.acmNoPrv, V1.acmNo) And MG.acmNo1=V1.acmNo1    WHERE 1 = 1   And   IsNull(IsNull(V2.acmYear, V1.acmYear), V.acmYear) =106 Order by  IsNull(IsNull(V2.acmYear, V1.acmYear), V.acmYear),  IsNull(IsNull(V2.acmNo, V1.acmNo), V.acmNo),  IsNull(IsNull(V2.acvNo, V1.acvNo), V.acvNo) ,IsNull(IsNull(V2.AcmNo1, V1.AcmNo1), 0) 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
 SELECT  A.teaCode, A.teaName, A.teaAliasNo, A.teaLevel, A.teaKind, A.teaAllFlag, A.teaDptCode,  A.teaCreateDate, A.teaStopFlag, A.teaStopDate, D.dptName   FROM codTeamName A  Left Join codDepartName D on A.teaDptCode= D.dptCode  Where 1=1  AND (ISNULL( A.teaCreateDate,'')<='2016/1/31' AND ( ISNULL(A.teaStopFlag,'')<>'1' OR A.teaStopDate>'2016/1/1'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  AND (ISNULL( A.dptCreateDate,'') <='2016/01/09' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '2016/01/09'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Distinct  
                 PV.acmYear, PV.acmNo, PV.acpPayYear, PV.acpPayNo, PV.acvNo, PV.acmNo1, PV.acvNo1, PV.acmNo2 
               , PV.acvNo2, PV.acvSubNo, PV.acmNoPrv, PV.acvPlanCode, PV.acvOutlayYear, PV.acvOutlayCode 
               , PV.acvBgtSourceCode, PV.acvAccKind, PV.acvBizCode, PV.acvPrePayFlag, PV.acvVisaMoney  
               , PV.acvMoney, PV.acvDateMemo, PV.acvMemo, PV.acvFinalKind, PV.acvFinalDate, PV.acvAdjustMoney 
               -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位 
               -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvExchNo  
               --, PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, PV.acvWExchNo as acvExchNo 
               , PV.acvTranID, PV.acvTranBNo, PV.acvTranDTime, PV.acvTranUser, ISNULL(CASE WHEN PV.acmYear<=104 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'') as acvExchNo  
               , PV.acvPassMoney, PV.acvPassAdjustMoney, PV.inspect  
               , P.acpBgtUnitNo, P.acpMarkDate, P.acpMoney, P.acpMemo, P.acpProdVisaKind, P.acpGroupNo , P.acpMarkUnitNo   
               , P.acpPassFlag, P.acpPassDate, P.acpPassMoney, P.acpPassBat, P.acpPassMemo,  P.acpPassUser 
               , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName , BZ.bizName   
               , BD.dptName As acpBgtDepName, BDV.dptName As acvBgtDepName, P.acpPayName 
              -- 20160118 [mdf]:因配合105年CGBA上線GBC系統之調整,傳票號碼原為 actPayVisa 資料表 acvExchNo 改取 acvWExchNo 欄位,acvTranBNo 改取 acvWTranBNo 欄位 
              -- 20160125 [mdf]:承上,改為 acmYear 104年度 以前 取acvExchNo ,其餘取 acvWExchNo 欄位 
              --, ( Case When IsNull(acvTranBNo,'')='' Or IsNull( acvExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
              --, ( Case When IsNull(acvWTranBNo,'')='' Or IsNull( acvWExchNo,'')='' Then '0' Else '1' End ) As EditFlag  
                , ( Case When IsNull(CASE WHEN PV.acmYear<= 106 THEN PV.acvTranBNo ELSE PV.acvWTranBNo END,'')='' 
                           Or IsNull(CASE WHEN PV.acmYear<= 106 THEN PV.acvExchNo ELSE PV.acvWExchNo END,'')='' 
                         Then '0' Else '1' End ) As EditFlag    
               , PV.acvBgtDepCode, PV.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, PV.acvPlanCode) As plnAliasNo 
               , PV.acvCostKind, CK.cskName As CostKindName  
               , V.acvBgtYear, V.acvBgtMonth, V.acvBgtSourCnt 
       FROM actPayVisa  PV  
               Left Join actPay P On P.acmYear = PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo) And P.acpPayYear =PV.acpPayYear and P.acpPayNo=PV.acpPayNo 
               Left Join actVisa V On PV.acmYear=V.acmYear And PV.acmNo=V.acmNo And PV.acvNo=V.acvNo 
 Left Join codAccKindName K On   IsNull(PV.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(PV.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( PV.acvPlanCode,'') = PN.plnPlanCode   And IsNull(PV.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  PV.acvOutlayCode = O.oulOutlayCode   And PV.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(PV.acvBizCode,'' ) = BZ.BizCode  And IsNull(PV.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(P.acpBgtUnitNo, P.acpMarkUnitNo)  
 Left Join codDepartName BDV On  BDV.dptCode  = IsNull(PV.acvBgtDepCode,'')  
 Left Join codPlanCategory PC On PC.plnCateCode=PV.acvPlanCateCode 
 Left Join codCostKind CK On CK.cskCode= PV.acvCostKind 
 Where P.acmYear=106
 And P.acmNo=744
 And IsNull(P.acmNo1,0)=0
 And P.acpPayYear=106
 And P.acpPayNo=1

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  AND (ISNULL( A.dptCreateDate,'') <='2016/01/09' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '2016/01/09'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
--[Parameter Count:5]
--@parAcmYear=106
--@parAcmNo=744
--@parAcmNo1=0
--@parAcpPayYear=106
--@parAcpPayNo=1
 Select O.oulOutlayName as OulName, P.plnPlanName as PlanName , BO.orgName  , K.accKindName ,   PVG.* From actPayVisaGBA PVG  Left Join codOutlayCode O On  IsNull(PVG.acvOutlayCode ,'') = O.oulOutlayCode  And IsNull(PVG.acvOutlayYear, '0') = O.codCodeVer  Left Join codPlanCode P On  IsNull(PVG.acvPlanCode,'') = P.plnPlanCode  And IsNull(PVG.acvOutlayYear,'0') = P.codCodeVer  Left Join codBgtOrigin BO On  IsNull(PVG.acvBgtSourceCode,'') = BO.orgCode  Left Join codAccKindName K On  IsNull(PVG.acvAccKind,'') = K.accKind    Where  1=1  And  PVG.acmYear=106  And PVG.acmNoPrv=744  And PVG.acmNo1 =7441  And PVG.acpPayYear =106  And PVG.acpPayNo =1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
 Select A.accKind, A.accKindName,  A.ackCreateDate, A.ackStopFlag, A.ackStopDate  FROM codAccKindName A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Distinct atkCode, atkName 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=744
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And PT.atdNo Is Null 
                   And TM.atkCode In ('01', '02')                   ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=744
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
)  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:53#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
SELECT DISTINCT LTRIM(STR(A.codCodeVer))+':'+A.plnPlanCode as Code, IsNull(A.plnPlanCode, '') +' '+A.plnPlanName as Name FROM actAccCode W JOIN codPlanCode A ON IsNull(W.accChildCnt,0) <=0 
                                   And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer)  
                                   AND (W.accPlanCode='' or  W.accPlanCode Like A.plnPlanCode+'%' or  A.plnPlanCode Like W.accPlanCode +'%') WHERE ( A.codCodeVer=105 AND ( A.plnPlanCode Like '304010105'  Or '304010105' Like A.plnPlanCode +'%'  )) ORDER BY 1
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
 Select Convert(varchar, A.orgCode) as orgCode, A.orgName   FROM codBgtOrigin A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Distinct atmCode, atmName, atkCode 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=744
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And PT.atdNo Is Null 
                   And TM.atkCode In ('01', '02')                   ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=744
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
)  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
 Select convert(varchar, A.codCodeVer) + ':' + Convert(varchar, A.BizCode) as BizCode, A.BizName   FROM codBizName  A  Where 1=1  And A.codCodeVer = 105  AND (ISNULL( A.bizCreateDate,'') <='2016/01/09' AND ( ISNULL(A.bizStopFlag,'') <> '1' OR A.bizStopDate > '2016/01/09'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
SELECT  DISTINCT  LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') LEFT OUTER JOIN codOutlayCode C ON A.codCodeVer=C.codCodeVer AND A.oulOutlayCode LIKE C.oulOutlayCode + '_%' AND A.oulLevel = C.oulLevel + 1 WHERE ( A.codCodeVer=105 AND (ISNULL( A.oulCreateDate,'')<='2016/01/09' AND ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>'2016/01/09'))  AND (A.oulOutlayCode Like '024902'  Or '024902' Like A.oulOutlayCode +'%'  ) AND (W.accPlanCode='' OR W.accPlanCode Like '304010105')) Order By   1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
SELECT oulOutlayCode FROM codOutlayCode WHERE codCodeVer=105 AND '024902' LIKE oulOutlayCode+'%' ORDER BY 1 DESC 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
SELECT BizCode FROM codBizName WHERE codCodeVer=105 AND '15' LIKE BizCode+'%' ORDER BY 1 DESC 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Distinct atdNo, atdNameHtml, atmCode 
 From ( 
          Select Distinct atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, atkOrderNo, atmOrderNo, atdOrderNo  
                  From ( 
                           Select Distinct K.atkCode, K.atkName, TM.atmCode, TM.atmName, TD.atdNo, TD.atdName, TD.atdNameHtml , atkOrderNo, atmOrderNo, atdOrderNo  
                                            From AttMain  TM 
                                 Join AttDtlData TD On TM.atmCode=TD.atmCode 
                                 Join attKind K On K.atkCode=TM.atkCode 
                                 Left Join actPayAtt PT On PT.atkcode =TM.atkCode And PT.atmCode=TM.atmCode And PT.atdNo=TD.atdNo  
                                                       And PT.acmYear =106 And PT.acmNo=744
                                                       And PT.acmNo1=0
                                                       And PT.acpPayYear=106 And PT.acpPayNo=1
                                                       And PT.acpPayNo1=0
                         Where 1=1   
                   And PT.atdNo Is Null 
                   And TM.atkCode In ('01', '02')                   ) DS                     Union 
                   Select  atkCode,  atkName,  atmCode,  atmName,  atdNo,  atdNameHtml, attNo As atkOrderNo,  attNo As atmOrderNo,  attNo As atdOrderNo   
                             From actPayAtt PT 
                         Where 1=1 And PT.acmYear =106
                                   And PT.acmNo=744
                                   And PT.acmNo1=0
                                   And PT.acpPayYear=106
                                   And PT.acpPayNo=1
                                   And PT.acpPayNo1=0
)  DS                    Order By                    1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
SELECT plnPlanCode FROM codPlanCode WHERE codCodeVer=105 AND '304010105' LIKE plnPlanCode+'%' ORDER BY 1 DESC 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
SELECT dptCode FROM codDepartName WHERE '201' LIKE dptCode+'%' ORDER BY 1 DESC 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
--[Parameter Count:8]
--@acmYear=105
--@acvBgtSourceCode='10'
--@acvAccKind=''
--@acmBgtUnitNo='201'
--@acvBizCode=''
--@plnPlanCode='304010105'
--@oulOutlayCode=''
--@acvOutlayYear=105
SELECT 
SUM(CASE WHEN ISNULL(bgtKind,'0') NOT IN ('1','2') THEN bgtMoney ELSE 0 END) AS 總預算 FROM  bgtBudget B 
 WHERE 
 B.bgtYear=105 AND 
 (((1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('','')
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL('201','')
  AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ''
  AND ISNULL(B.bgtTeaCode, '')  = ''
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL('10','')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL('','')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('','')
 )
 OR
 (1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('','')+'%'
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')   LIKE ISNULL('201','')+'%'
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF('',''),'%')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('','')+'%'
  AND (ISNULL(B.bgtIndepFlag,'0')='0'
      OR (ISNULL(B.bgtIndepFlag,'0')='2' AND NOT EXISTS
          (SELECT * FROM bgtBudget BZ
           WHERE 1=1 
             AND BZ.bgtYear=105 
             AND ISNULL(BZ.bgtOutlayYear, BZ.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(BZ.bgtOutlayYear, BZ.bgtYear))
             AND ISNULL(BZ.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
             AND ISNULL(BZ.bgtOutlayCode, '') LIKE ISNULL('','')+'%'
             AND ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo), '')  LIKE ISNULL('201','')+'%'
             AND ISNULL(BZ.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
             AND ISNULL(BZ.bgtAccKind, '')  LIKE ISNULL(NULLIF('',''),'%')
             AND ISNULL(BZ.bgtBizCode, '')  LIKE ISNULL('','')+'%'
             AND NOT (ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(BZ.bgtOutlayYear, BZ.bgtYear)
                      AND ISNULL(B.bgtPlanCode, '')  = ISNULL(BZ.bgtPlanCode,'')
                      AND ISNULL(B.bgtOutlayCode, '') = ISNULL(BZ.bgtOutlayCode,'')
                      AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  = ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')
                      AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')
                      AND ISNULL(B.bgtTeaCode, '')  = ISNULL(BZ.bgtTeaCode,'')
                      AND ISNULL(B.bgtBgtSourceCode, '') = ISNULL(BZ.bgtBgtSourceCode,'')
                      AND ISNULL(B.bgtAccKind, '')  = ISNULL(BZ.bgtAccKind,'')
                      AND ISNULL(B.bgtBizCode, '')  = ISNULL(BZ.bgtBizCode,'')
                      AND ISNULL(B.bgtKind, '')  = ISNULL(BZ.bgtKind,'')
                     )
             AND ISNULL(B.bgtKind, '')  LIKE ISNULL(NULLIF(BZ.bgtKind,''),'%')
             AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(BZ.bgtOutlayYear,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
             AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL(BZ.bgtPlanCode,'')+'%'
             AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL(BZ.bgtOutlayCode,'')+'%'
             AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')+'%'
             AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  LIKE ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')+'%'
             AND ISNULL(B.bgtTeaCode, '')  LIKE ISNULL(BZ.bgtTeaCode,'')+'%'
             AND ISNULL(B.bgtBgtSourceCode,'') LIKE ISNULL(NULLIF(BZ.bgtBgtSourceCode,''),'%')
             AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF(BZ.bgtAccKind,''),'%')
             AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL(BZ.bgtBizCode,'')+'%'
         ))
     )
 ))) 

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
--[Parameter Count:8]
--@acmYear=105
--@acvBgtSourceCode='10'
--@acvAccKind='1'
--@acmBgtUnitNo='201'
--@acvBizCode='15'
--@plnPlanCode='304010105'
--@oulOutlayCode='02'
--@acvOutlayYear=105
SELECT 
SUM(CASE WHEN ISNULL(bgtKind,'0') NOT IN ('1','2') THEN bgtMoney ELSE 0 END) AS 總預算 FROM  bgtBudget B 
 WHERE 
 B.bgtYear=105 AND 
 (((1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('02','')
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL('201','')
  AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ''
  AND ISNULL(B.bgtTeaCode, '')  = ''
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL('10','')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL('1','')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('15','')
 )
 OR
 (1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('02','')+'%'
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')   LIKE ISNULL('201','')+'%'
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF('1',''),'%')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('15','')+'%'
  AND (ISNULL(B.bgtIndepFlag,'0')='0'
      OR (ISNULL(B.bgtIndepFlag,'0')='2' AND NOT EXISTS
          (SELECT * FROM bgtBudget BZ
           WHERE 1=1 
             AND BZ.bgtYear=105 
             AND ISNULL(BZ.bgtOutlayYear, BZ.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(BZ.bgtOutlayYear, BZ.bgtYear))
             AND ISNULL(BZ.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
             AND ISNULL(BZ.bgtOutlayCode, '') LIKE ISNULL('02','')+'%'
             AND ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo), '')  LIKE ISNULL('201','')+'%'
             AND ISNULL(BZ.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
             AND ISNULL(BZ.bgtAccKind, '')  LIKE ISNULL(NULLIF('1',''),'%')
             AND ISNULL(BZ.bgtBizCode, '')  LIKE ISNULL('15','')+'%'
             AND NOT (ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(BZ.bgtOutlayYear, BZ.bgtYear)
                      AND ISNULL(B.bgtPlanCode, '')  = ISNULL(BZ.bgtPlanCode,'')
                      AND ISNULL(B.bgtOutlayCode, '') = ISNULL(BZ.bgtOutlayCode,'')
                      AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  = ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')
                      AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')
                      AND ISNULL(B.bgtTeaCode, '')  = ISNULL(BZ.bgtTeaCode,'')
                      AND ISNULL(B.bgtBgtSourceCode, '') = ISNULL(BZ.bgtBgtSourceCode,'')
                      AND ISNULL(B.bgtAccKind, '')  = ISNULL(BZ.bgtAccKind,'')
                      AND ISNULL(B.bgtBizCode, '')  = ISNULL(BZ.bgtBizCode,'')
                      AND ISNULL(B.bgtKind, '')  = ISNULL(BZ.bgtKind,'')
                     )
             AND ISNULL(B.bgtKind, '')  LIKE ISNULL(NULLIF(BZ.bgtKind,''),'%')
             AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(BZ.bgtOutlayYear,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
             AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL(BZ.bgtPlanCode,'')+'%'
             AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL(BZ.bgtOutlayCode,'')+'%'
             AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')+'%'
             AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  LIKE ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')+'%'
             AND ISNULL(B.bgtTeaCode, '')  LIKE ISNULL(BZ.bgtTeaCode,'')+'%'
             AND ISNULL(B.bgtBgtSourceCode,'') LIKE ISNULL(NULLIF(BZ.bgtBgtSourceCode,''),'%')
             AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF(BZ.bgtAccKind,''),'%')
             AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL(BZ.bgtBizCode,'')+'%'
         ))
     )
 ))) 

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
--[Parameter Count:8]
--@acmYear=105
--@acvBgtSourceCode='10'
--@acvAccKind='1'
--@acmBgtUnitNo='201'
--@acvBizCode='15'
--@plnPlanCode='304010105'
--@oulOutlayCode='024902'
--@acvOutlayYear=105
SELECT 
SUM(CASE WHEN ISNULL(bgtKind,'0') NOT IN ('1','2') THEN bgtMoney ELSE 0 END) AS 總預算 FROM  bgtBudget B 
 WHERE 
 B.bgtYear=105 AND 
 (((1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('024902','')
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL('201','')
  AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ''
  AND ISNULL(B.bgtTeaCode, '')  = ''
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL('10','')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL('1','')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('15','')
 )
 OR
 (1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('024902','')+'%'
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')   LIKE ISNULL('201','')+'%'
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF('1',''),'%')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('15','')+'%'
  AND (ISNULL(B.bgtIndepFlag,'0')='0'
      OR (ISNULL(B.bgtIndepFlag,'0')='2' AND NOT EXISTS
          (SELECT * FROM bgtBudget BZ
           WHERE 1=1 
             AND BZ.bgtYear=105 
             AND ISNULL(BZ.bgtOutlayYear, BZ.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(BZ.bgtOutlayYear, BZ.bgtYear))
             AND ISNULL(BZ.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
             AND ISNULL(BZ.bgtOutlayCode, '') LIKE ISNULL('024902','')+'%'
             AND ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo), '')  LIKE ISNULL('201','')+'%'
             AND ISNULL(BZ.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
             AND ISNULL(BZ.bgtAccKind, '')  LIKE ISNULL(NULLIF('1',''),'%')
             AND ISNULL(BZ.bgtBizCode, '')  LIKE ISNULL('15','')+'%'
             AND NOT (ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(BZ.bgtOutlayYear, BZ.bgtYear)
                      AND ISNULL(B.bgtPlanCode, '')  = ISNULL(BZ.bgtPlanCode,'')
                      AND ISNULL(B.bgtOutlayCode, '') = ISNULL(BZ.bgtOutlayCode,'')
                      AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  = ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')
                      AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')
                      AND ISNULL(B.bgtTeaCode, '')  = ISNULL(BZ.bgtTeaCode,'')
                      AND ISNULL(B.bgtBgtSourceCode, '') = ISNULL(BZ.bgtBgtSourceCode,'')
                      AND ISNULL(B.bgtAccKind, '')  = ISNULL(BZ.bgtAccKind,'')
                      AND ISNULL(B.bgtBizCode, '')  = ISNULL(BZ.bgtBizCode,'')
                      AND ISNULL(B.bgtKind, '')  = ISNULL(BZ.bgtKind,'')
                     )
             AND ISNULL(B.bgtKind, '')  LIKE ISNULL(NULLIF(BZ.bgtKind,''),'%')
             AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(BZ.bgtOutlayYear,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
             AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL(BZ.bgtPlanCode,'')+'%'
             AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL(BZ.bgtOutlayCode,'')+'%'
             AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')+'%'
             AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  LIKE ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')+'%'
             AND ISNULL(B.bgtTeaCode, '')  LIKE ISNULL(BZ.bgtTeaCode,'')+'%'
             AND ISNULL(B.bgtBgtSourceCode,'') LIKE ISNULL(NULLIF(BZ.bgtBgtSourceCode,''),'%')
             AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF(BZ.bgtAccKind,''),'%')
             AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL(BZ.bgtBizCode,'')+'%'
         ))
     )
 ))) 

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
--[Parameter Count:8]
--@acmYear=105
--@acvBgtSourceCode='10'
--@acvAccKind='1'
--@acmBgtUnitNo='201'
--@acvBizCode='15'
--@plnPlanCode='304010105'
--@oulOutlayCode='0249'
--@acvOutlayYear=105
SELECT 
SUM(CASE WHEN ISNULL(bgtKind,'0') NOT IN ('1','2') THEN bgtMoney ELSE 0 END) AS 總預算 FROM  bgtBudget B 
 WHERE 
 B.bgtYear=105 AND 
 (((1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('0249','')
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL('201','')
  AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ''
  AND ISNULL(B.bgtTeaCode, '')  = ''
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL('10','')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL('1','')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('15','')
 )
 OR
 (1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('0249','')+'%'
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')   LIKE ISNULL('201','')+'%'
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF('1',''),'%')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('15','')+'%'
  AND (ISNULL(B.bgtIndepFlag,'0')='0'
      OR (ISNULL(B.bgtIndepFlag,'0')='2' AND NOT EXISTS
          (SELECT * FROM bgtBudget BZ
           WHERE 1=1 
             AND BZ.bgtYear=105 
             AND ISNULL(BZ.bgtOutlayYear, BZ.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(BZ.bgtOutlayYear, BZ.bgtYear))
             AND ISNULL(BZ.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
             AND ISNULL(BZ.bgtOutlayCode, '') LIKE ISNULL('0249','')+'%'
             AND ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo), '')  LIKE ISNULL('201','')+'%'
             AND ISNULL(BZ.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
             AND ISNULL(BZ.bgtAccKind, '')  LIKE ISNULL(NULLIF('1',''),'%')
             AND ISNULL(BZ.bgtBizCode, '')  LIKE ISNULL('15','')+'%'
             AND NOT (ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(BZ.bgtOutlayYear, BZ.bgtYear)
                      AND ISNULL(B.bgtPlanCode, '')  = ISNULL(BZ.bgtPlanCode,'')
                      AND ISNULL(B.bgtOutlayCode, '') = ISNULL(BZ.bgtOutlayCode,'')
                      AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  = ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')
                      AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')
                      AND ISNULL(B.bgtTeaCode, '')  = ISNULL(BZ.bgtTeaCode,'')
                      AND ISNULL(B.bgtBgtSourceCode, '') = ISNULL(BZ.bgtBgtSourceCode,'')
                      AND ISNULL(B.bgtAccKind, '')  = ISNULL(BZ.bgtAccKind,'')
                      AND ISNULL(B.bgtBizCode, '')  = ISNULL(BZ.bgtBizCode,'')
                      AND ISNULL(B.bgtKind, '')  = ISNULL(BZ.bgtKind,'')
                     )
             AND ISNULL(B.bgtKind, '')  LIKE ISNULL(NULLIF(BZ.bgtKind,''),'%')
             AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(BZ.bgtOutlayYear,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
             AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL(BZ.bgtPlanCode,'')+'%'
             AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL(BZ.bgtOutlayCode,'')+'%'
             AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')+'%'
             AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  LIKE ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')+'%'
             AND ISNULL(B.bgtTeaCode, '')  LIKE ISNULL(BZ.bgtTeaCode,'')+'%'
             AND ISNULL(B.bgtBgtSourceCode,'') LIKE ISNULL(NULLIF(BZ.bgtBgtSourceCode,''),'%')
             AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF(BZ.bgtAccKind,''),'%')
             AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL(BZ.bgtBizCode,'')+'%'
         ))
     )
 ))) 

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
SELECT  DISTINCT  LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') LEFT OUTER JOIN codOutlayCode C ON A.codCodeVer=C.codCodeVer AND A.oulOutlayCode LIKE C.oulOutlayCode + '_%' AND A.oulLevel = C.oulLevel + 1 WHERE ( A.codCodeVer=105 AND (ISNULL( A.oulCreateDate,'')<='2016/01/09' AND ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>'2016/01/09'))  AND (A.oulOutlayCode Like '02'  Or '02' Like A.oulOutlayCode +'%' ) AND (W.accDepCode='' OR W.accDepCode = '201') AND (W.accPlanCode='' OR W.accPlanCode Like '304010105')) Order By   1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select  Distinct 
               PD.acmYear, PD.acmNo 
           , PD.acmNo1, PD.acdNo 
           , IsNull(PD.acpPayYear, 0) As acpPayYear, IsNull( PD.acpPayNo,0) As acpPayNo, IsNull(PD.acpPayNo1,0) As acpPayNo1 
           , PD.acdProdCode  
           , PD.acdProdName 
           , PD.acdProdRule 
           , PD.acdProdSup 
           , PD.acdProdUnit 
           , PD.acdProdQry 
           , PD.acdMemo 
           , PD.acdProdPrice 
           , PD.acdMoney 
           , PD.acdProdPriceFac1 
           , PD.acdProdMoneyFac1 
           , PD.acdProdPriceFac2 
           , PD.acdProdMoneyFac2 
           , PD.acdProdPriceFac3 
           , PD.acdProdMoneyFac3 
           , PD.acdProdCause
           , PC.prcName As acdProdCauseName 
           , PP.acmProdFactory 
           , PP.acmProdMoney 
           , PP.acmProdFactory1, PP.acmProdFactory2, PP.acmProdFactory3 
       From  actPayDtlProd PD 
               Left Join codProdCause PC On PC.prcCode=IsNull(PD.acdProdCause, '') 
               Left Join actPayProd PP On PP.acmYear=PD.acmYear And PP.acmNo=PD.acmNo And PP.acpPayYear =PD.acpPayYear And PP.acpPayNo=PD.acpPayNo And PP.acpPayNo1=PD.acpPayNo1 
       Where 1 = 1 And PD.acmYear=106
                   And PD.acmNo=744
 And PD.acmNo1=0
 And ((IsNull( PD.acpPayNo,0)=1 And IsNull( PD.acpPayNo1,0)=0) Or (PD.acpPayNo Is Null And PD.acpPayNo1 Is Null) ) 
 Order By  1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
--[Parameter Count:8]
--@acmYear=105
--@acvBgtSourceCode='10'
--@acvAccKind='1'
--@acmBgtUnitNo='201%'
--@acvBizCode='15'
--@plnPlanCode='304010105'
--@oulOutlayCode='02'
--@acvOutlayYear=105
SELECT 
     IsNull(SUM(CASE WHEN bgtBgtSourceCode IN ('0','3','4','7','10','80','90') AND ISNULL(bgtKind,'0') NOT IN ('1','2','4') THEN bgtMoney ELSE 0 END), 0) AS 原預算  
   , IsNull(SUM(CASE WHEN bgtBgtSourceCode  Not IN ('0','3','4','7','10','80','90') AND ISNULL(bgtKind,'0') NOT IN ('1','2','4') THEN bgtMoney ELSE 0 END), 0) as 預備金或追加減預算金額  
   , IsNull(SUM(CASE WHEN bgtKind='4' THEN bgtMoney ELSE 0 END),0)  as 流入流出金額    
   , IsNull(SUM(CASE WHEN bgtKind='4' And IsNull(bgtSubKind,'0')='1' THEN bgtMoney ELSE 0 END),0)  as 勻支金額    
 FROM  bgtBudget B 
 WHERE 
 B.bgtYear=105 AND 
 (((1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('02','')
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL('201%','')
  AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ''
  AND ISNULL(B.bgtTeaCode, '')  = ''
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL('10','')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL('1','')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('15','')
 )
 OR
 (1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('02','')+'%'
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')   LIKE ISNULL('201%','')+'%'
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF('1',''),'%')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('15','')+'%'
  AND (ISNULL(B.bgtIndepFlag,'0')='0'
      OR (ISNULL(B.bgtIndepFlag,'0')='2' AND NOT EXISTS
          (SELECT * FROM bgtBudget BZ
           WHERE 1=1 
             AND BZ.bgtYear=105 
             AND ISNULL(BZ.bgtOutlayYear, BZ.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(BZ.bgtOutlayYear, BZ.bgtYear))
             AND ISNULL(BZ.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
             AND ISNULL(BZ.bgtOutlayCode, '') LIKE ISNULL('02','')+'%'
             AND ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo), '')  LIKE ISNULL('201%','')+'%'
             AND ISNULL(BZ.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
             AND ISNULL(BZ.bgtAccKind, '')  LIKE ISNULL(NULLIF('1',''),'%')
             AND ISNULL(BZ.bgtBizCode, '')  LIKE ISNULL('15','')+'%'
             AND NOT (ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(BZ.bgtOutlayYear, BZ.bgtYear)
                      AND ISNULL(B.bgtPlanCode, '')  = ISNULL(BZ.bgtPlanCode,'')
                      AND ISNULL(B.bgtOutlayCode, '') = ISNULL(BZ.bgtOutlayCode,'')
                      AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  = ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')
                      AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')
                      AND ISNULL(B.bgtTeaCode, '')  = ISNULL(BZ.bgtTeaCode,'')
                      AND ISNULL(B.bgtBgtSourceCode, '') = ISNULL(BZ.bgtBgtSourceCode,'')
                      AND ISNULL(B.bgtAccKind, '')  = ISNULL(BZ.bgtAccKind,'')
                      AND ISNULL(B.bgtBizCode, '')  = ISNULL(BZ.bgtBizCode,'')
                      AND ISNULL(B.bgtKind, '')  = ISNULL(BZ.bgtKind,'')
                     )
             AND ISNULL(B.bgtKind, '')  LIKE ISNULL(NULLIF(BZ.bgtKind,''),'%')
             AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(BZ.bgtOutlayYear,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
             AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL(BZ.bgtPlanCode,'')+'%'
             AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL(BZ.bgtOutlayCode,'')+'%'
             AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')+'%'
             AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  LIKE ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')+'%'
             AND ISNULL(B.bgtTeaCode, '')  LIKE ISNULL(BZ.bgtTeaCode,'')+'%'
             AND ISNULL(B.bgtBgtSourceCode,'') LIKE ISNULL(NULLIF(BZ.bgtBgtSourceCode,''),'%')
             AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF(BZ.bgtAccKind,''),'%')
             AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL(BZ.bgtBizCode,'')+'%'
         ))
     )
 ))) 

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
--[Parameter Count:9]
--@EMonth=12
--@acmYear=105
--@acvBgtSourceCode='10'
--@acvAccKind='1'
--@acmBgtUnitNo='201%'
--@acvBizCode='15'
--@plnPlanCode='304010105'
--@oulOutlayCode='02'
--@acvOutlayYear=105
SELECT 
    IsNull(SUM(CASE WHEN ISNULL(bgtKind,'0') NOT IN ('1','2') THEN bgtmMoney ELSE 0 END) ,0) AS 分配數  
 FROM  bgtBudget B 
 LEFT OUTER JOIN bgtMonth BM ON B.bgtYear=BM.bgtYear AND B.bgtNo=BM.bgtNo 
AND BM.bgtmMonth<=  Month(dbo.fn_GetBudgetDate('2016','2016/12/01','E'))
 WHERE 
 B.bgtYear=105 AND 
 (((1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('02','')
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL('201%','')
  AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ''
  AND ISNULL(B.bgtTeaCode, '')  = ''
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL('10','')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL('1','')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('15','')
 )
 OR
 (1=1 
  AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
  AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
  AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL('02','')+'%'
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')   LIKE ISNULL('201%','')+'%'
  AND ISNULL(B.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
  AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF('1',''),'%')
  AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL('15','')+'%'
  AND (ISNULL(B.bgtIndepFlag,'0')='0'
      OR (ISNULL(B.bgtIndepFlag,'0')='2' AND NOT EXISTS
          (SELECT * FROM bgtBudget BZ
           WHERE 1=1 
             AND BZ.bgtYear=105 
             AND ISNULL(BZ.bgtOutlayYear, BZ.bgtYear) = ISNULL(NULLIF(105,0),ISNULL(BZ.bgtOutlayYear, BZ.bgtYear))
             AND ISNULL(BZ.bgtPlanCode, '')  LIKE ISNULL('304010105','')+'%'
             AND ISNULL(BZ.bgtOutlayCode, '') LIKE ISNULL('02','')+'%'
             AND ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo), '')  LIKE ISNULL('201%','')+'%'
             AND ISNULL(BZ.bgtBgtSourceCode, '')  LIKE ISNULL(NULLIF('10',''),'%')
             AND ISNULL(BZ.bgtAccKind, '')  LIKE ISNULL(NULLIF('1',''),'%')
             AND ISNULL(BZ.bgtBizCode, '')  LIKE ISNULL('15','')+'%'
             AND NOT (ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(BZ.bgtOutlayYear, BZ.bgtYear)
                      AND ISNULL(B.bgtPlanCode, '')  = ISNULL(BZ.bgtPlanCode,'')
                      AND ISNULL(B.bgtOutlayCode, '') = ISNULL(BZ.bgtOutlayCode,'')
                      AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  = ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')
                      AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')
                      AND ISNULL(B.bgtTeaCode, '')  = ISNULL(BZ.bgtTeaCode,'')
                      AND ISNULL(B.bgtBgtSourceCode, '') = ISNULL(BZ.bgtBgtSourceCode,'')
                      AND ISNULL(B.bgtAccKind, '')  = ISNULL(BZ.bgtAccKind,'')
                      AND ISNULL(B.bgtBizCode, '')  = ISNULL(BZ.bgtBizCode,'')
                      AND ISNULL(B.bgtKind, '')  = ISNULL(BZ.bgtKind,'')
                     )
             AND ISNULL(B.bgtKind, '')  LIKE ISNULL(NULLIF(BZ.bgtKind,''),'%')
             AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(BZ.bgtOutlayYear,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
             AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL(BZ.bgtPlanCode,'')+'%'
             AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL(BZ.bgtOutlayCode,'')+'%'
             AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')+'%'
             AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  LIKE ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')+'%'
             AND ISNULL(B.bgtTeaCode, '')  LIKE ISNULL(BZ.bgtTeaCode,'')+'%'
             AND ISNULL(B.bgtBgtSourceCode,'') LIKE ISNULL(NULLIF(BZ.bgtBgtSourceCode,''),'%')
             AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF(BZ.bgtAccKind,''),'%')
             AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL(BZ.bgtBizCode,'')+'%'
         ))
     )
 ))) 

-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Distinct 
       Convert(varchar, P.codCodeVer) +':'+ P.plnPlanCode 
           +  (Case When DS.Code <> Convert(varchar, P.codCodeVer) +':'+ P.plnPlanCode Then '*' Else '' End ) 
            As Code    
       , IsNull(P.plnPlanCode,'') + ' '+ P.plnPlanName 
       From   
           ( 
SELECT DISTINCT LTRIM(STR(A.codCodeVer))+':'+A.plnPlanCode as Code, IsNull(A.plnPlanCode, '') +' '+A.plnPlanName as Name FROM actAccCode W JOIN codPlanCode A ON IsNull(W.accChildCnt,0) <=0 
                                   And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer)  
                                   AND (W.accPlanCode='' or  W.accPlanCode Like A.plnPlanCode+'%' or  A.plnPlanCode Like W.accPlanCode +'%') WHERE ( A.codCodeVer=106 AND (ISNULL( A.plnCreateDate,'')<='2017/01/31' AND ( ISNULL(A.plnStopFlag,'')<>'1' OR A.plnStopDate>'2017/01/31'))  AND ( A.plnPlanCode Like '3010102%' ) AND (W.accDepCode='' OR W.accDepCode = '104'))                         And   (A.plnChildCnt<=0  
                                           OR 
                                   (A.plnChildCnt IS NULL AND  
                                       ISNULL((SELECT COUNT(*) FROM codPlanCode  Z 
                                       WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer)) 
                                       AND  ISNULL(Z.plnPlanCode,'') LIKE ISNULL(Ltrim(A.plnPlanCode),'')+'%' 
                                      ),1)<=1) 
                           )  

            ) DS 
         Left Join codPlanCode P  On DS.Code Like Convert(varchar, P.codCodeVer) +':'+ P.plnPlanCode +'%' 
 Order By 1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select Top 1 oulOutlayCode From codOutlayCode Where codCodeVer=106 And '027101' Like oulOutlayCode +'%' 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
SELECT  DISTINCT  LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') WHERE ( A.codCodeVer=106 AND (ISNULL( A.oulCreateDate,'')<='2017/01/31' AND ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>'2017/01/31'))  AND (A.oulOutlayCode Like '02%' ) AND (W.accDepCode='' OR W.accDepCode = '104')) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select A.accKind, A.accKindName,  A.ackCreateDate, A.ackStopFlag, A.ackStopDate  FROM codAccKindName A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:54#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActProdPay.Web/FrmActPay.aspx?MenuID=1321
 Select prcCode, prcName 
 From codProdCause 
 Where 1=1  AND (ISNULL(prcCreateDate,'')<='2017/1/31' AND ( ISNULL(prcStopFlag,'')<>'1' OR prcStopDate >'2017/1/1')) 
 Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/1/9 上午 11:50:55#  http://gbceap.cdc.gov.tw/CDCGBCE/UI.ActSum.WEB/ShowBudget1.aspx?myAccKind=1&mybgtSource=10&myBiz=105:15&myPlan=105:304010105&myOul=105:024902&myBgtDep=201&mod=2&menuid=Y1
--[Parameter Count:6]
--@acmYear=105
--@acmBgtUnitNo='201%'
--@acvBizCode='15%'
--@plnPlanCode='304010105%'
--@oulOutlayCode='02%'
--@acvOutlayYear=105
SELECT * INTO ##TO__104385455501109012017 FROM (SELECT 
ISNULL((SELECT 
     CONVERT(VARCHAR(20),SUM(CASE WHEN ISNULL(bgtBgtSourceCode,'0')     IN ('0','3','4','7','10','80','90') AND ISNULL(bgtKind,'0') NOT IN ('1','2','4') THEN bgtMoney ELSE 0 END))+';'+CONVERT(VARCHAR(20),SUM(CASE WHEN ISNULL(bgtBgtSourceCode,'0') NOT IN ('0','3','4','7','10','80','90') AND ISNULL(bgtKind,'0') NOT IN ('1','2','4') THEN bgtMoney ELSE 0 END))+';'+CONVERT(VARCHAR(20),SUM(CASE WHEN bgtKind='4' THEN bgtMoney ELSE 0 END)) FROM   bgtBudget B
 WHERE
 B.bgtYear=105 AND 
 ISNULL(B.bgtBgtSourceCode,'') IN (10) AND 
 ISNULL(B.bgtAccKind,'') IN (1) AND 
 ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo),'') LIKE '201%' AND 
 ISNULL(B.bgtBizCode,'') LIKE '15%' And 
 ISNULL(B.bgtPlanCode,'') LIKE '304010105%' AND 
 ISNULL(B.bgtOutlayCode,'') LIKE '02%' AND 
 B.bgtOutlayYear=ISNULL(NULLIF(105,0),B.bgtOutlayYear) AND 
 (((1=1 
  AND ISNULL(B.bgtPlanCode, '')  = ''
  AND ISNULL(B.bgtOutlayCode, '') = ''
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  = ''
  AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ''
  AND ISNULL(B.bgtTeaCode, '')  = ''
  AND ISNULL(B.bgtBgtSourceCode, '')  = ''
  AND ISNULL(B.bgtAccKind, '')  = ''
  AND ISNULL(B.bgtBizCode, '')  = ''
 )
 OR
 (1=1 
  AND (ISNULL(B.bgtIndepFlag,'0')='0'
      OR (ISNULL(B.bgtIndepFlag,'0')='2' 
          AND NOT EXISTS
          (SELECT * FROM bgtBudget BZ
           WHERE 1=1 
             AND BZ.bgtYear=105 
             AND ISNULL(BZ.bgtBgtSourceCode,'') IN (10) 
             AND ISNULL(BZ.bgtAccKind,'') IN (1) 
             AND ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'') LIKE '201%' 
             AND ISNULL(BZ.bgtBizCode,'') LIKE '15%' 
             AND ISNULL(BZ.bgtPlanCode,'') LIKE '304010105%' 
             AND ISNULL(BZ.bgtOutlayCode,'') LIKE '02%' 
             AND BZ.bgtOutlayYear=ISNULL(NULLIF(105,0),BZ.bgtOutlayYear) 
             AND NOT (ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(BZ.bgtOutlayYear, BZ.bgtYear)
                      AND ISNULL(B.bgtPlanCode, '')  = ISNULL(BZ.bgtPlanCode,'')
                      AND ISNULL(B.bgtOutlayCode, '') = ISNULL(BZ.bgtOutlayCode,'')
                      AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  = ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')
                      AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')
                      AND ISNULL(B.bgtTeaCode, '')  = ISNULL(BZ.bgtTeaCode,'')
                      AND ISNULL(B.bgtBgtSourceCode, '') = ISNULL(BZ.bgtBgtSourceCode,'')
                      AND ISNULL(B.bgtAccKind, '')  = ISNULL(BZ.bgtAccKind,'')
                      AND ISNULL(B.bgtBizCode, '')  = ISNULL(BZ.bgtBizCode,'')
                      AND ISNULL(B.bgtKind, '')  = ISNULL(BZ.bgtKind,'')
                     )
             AND ISNULL(B.bgtKind, '')  LIKE ISNULL(NULLIF(BZ.bgtKind,''),'%')
             AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(BZ.bgtOutlayYear,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
             AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL(BZ.bgtPlanCode,'')+'%'
             AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL(BZ.bgtOutlayCode,'')+'%'
             AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')+'%'
             AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  LIKE ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')+'%'
             AND ISNULL(B.bgtTeaCode, '')  LIKE ISNULL(BZ.bgtTeaCode,'')+'%'
             AND ISNULL(B.bgtBgtSourceCode,'') LIKE ISNULL(NULLIF(BZ.bgtBgtSourceCode,''),'%')
             AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF(BZ.bgtAccKind,''),'%')
             AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL(BZ.bgtBizCode,'')+'%'
         ))
     )
 )))
),'0;0;0')
 AS 預算金額,0.0 AS 預備金或追加減預算金額,0.0 AS 流入流出金額
,ISNULL((SELECT SUM(bgtmMoney) 
 FROM   bgtBudget B LEFT OUTER JOIN bgtMonth BM ON B.bgtYear=BM.bgtYear AND B.bgtNo=BM.bgtNo 
 AND ISNULL(bgtKind,'0') NOT IN ('1','2')
 WHERE
 B.bgtYear=105 AND 
 ISNULL(B.bgtBgtSourceCode,'') IN (10) AND 
 ISNULL(B.bgtAccKind,'') IN (1) AND 
 ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo),'') LIKE '201%' AND 
 ISNULL(B.bgtBizCode,'') LIKE '15%' And 
 ISNULL(B.bgtPlanCode,'') LIKE '304010105%' AND 
 ISNULL(B.bgtOutlayCode,'') LIKE '02%' AND 
 B.bgtOutlayYear=ISNULL(NULLIF(105,0),B.bgtOutlayYear) AND 
 (((1=1 
  AND ISNULL(B.bgtPlanCode, '')  = ''
  AND ISNULL(B.bgtOutlayCode, '') = ''
  AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  = ''
  AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ''
  AND ISNULL(B.bgtTeaCode, '')  = ''
  AND ISNULL(B.bgtBgtSourceCode, '')  = ''
  AND ISNULL(B.bgtAccKind, '')  = ''
  AND ISNULL(B.bgtBizCode, '')  = ''
 )
 OR
 (1=1 
  AND (ISNULL(B.bgtIndepFlag,'0')='0'
      OR (ISNULL(B.bgtIndepFlag,'0')='2' 
          AND NOT EXISTS
          (SELECT * FROM bgtBudget BZ
           WHERE 1=1 
             AND BZ.bgtYear=105 
             AND ISNULL(BZ.bgtBgtSourceCode,'') IN (10) 
             AND ISNULL(BZ.bgtAccKind,'') IN (1) 
             AND ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'') LIKE '201%' 
             AND ISNULL(BZ.bgtBizCode,'') LIKE '15%' 
             AND ISNULL(BZ.bgtPlanCode,'') LIKE '304010105%' 
             AND ISNULL(BZ.bgtOutlayCode,'') LIKE '02%' 
             AND BZ.bgtOutlayYear=ISNULL(NULLIF(105,0),BZ.bgtOutlayYear) 
             AND NOT (ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(BZ.bgtOutlayYear, BZ.bgtYear)
                      AND ISNULL(B.bgtPlanCode, '')  = ISNULL(BZ.bgtPlanCode,'')
                      AND ISNULL(B.bgtOutlayCode, '') = ISNULL(BZ.bgtOutlayCode,'')
                      AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  = ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')
                      AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  = ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')
                      AND ISNULL(B.bgtTeaCode, '')  = ISNULL(BZ.bgtTeaCode,'')
                      AND ISNULL(B.bgtBgtSourceCode, '') = ISNULL(BZ.bgtBgtSourceCode,'')
                      AND ISNULL(B.bgtAccKind, '')  = ISNULL(BZ.bgtAccKind,'')
                      AND ISNULL(B.bgtBizCode, '')  = ISNULL(BZ.bgtBizCode,'')
                      AND ISNULL(B.bgtKind, '')  = ISNULL(BZ.bgtKind,'')
                     )
             AND ISNULL(B.bgtKind, '')  LIKE ISNULL(NULLIF(BZ.bgtKind,''),'%')
             AND ISNULL(B.bgtOutlayYear, B.bgtYear) = ISNULL(NULLIF(BZ.bgtOutlayYear,0),ISNULL(B.bgtOutlayYear, B.bgtYear))
             AND ISNULL(B.bgtPlanCode, '')  LIKE ISNULL(BZ.bgtPlanCode,'')+'%'
             AND ISNULL(B.bgtOutlayCode, '') LIKE ISNULL(BZ.bgtOutlayCode,'')+'%'
             AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo), '')  LIKE ISNULL(ISNULL(BZ.bgtDepCode,BZ.bgtWorkUnitNo),'')+'%'
             AND ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode), '')  LIKE ISNULL(ISNULL(BZ.bgtWorkUnitNo,BZ.bgtDepCode),'')+'%'
             AND ISNULL(B.bgtTeaCode, '')  LIKE ISNULL(BZ.bgtTeaCode,'')+'%'
             AND ISNULL(B.bgtBgtSourceCode,'') LIKE ISNULL(NULLIF(BZ.bgtBgtSourceCode,''),'%')
             AND ISNULL(B.bgtAccKind, '')  LIKE ISNULL(NULLIF(BZ.bgtAccKind,''),'%')
             AND ISNULL(B.bgtBizCode, '')  LIKE ISNULL(BZ.bgtBizCode,'')+'%'
         ))
     )
 )))
),0) AS 累計分配數
,SUM((CASE WHEN ISNULL(acvPrePayFlag,'0')<>'1' AND acvMoney_Kind>=11 AND acmYear=IsNull(acpPayYear1, acpPayYear)  THEN EV.acvMoney ELSE 0 END)) AS 實支數
,SUM((CASE WHEN ISNULL(acvPrePayFlag,'0')='1' AND acvMoney_Kind>=11  THEN EV.acvMoney ELSE 0 END)) AS 暫付數
,0.0 AS 未核銷會簽數
,SUM((CASE WHEN acvMoney_ResFlag<>3 OR acvMoney_Kind NOT IN (1,2) THEN EV.acvMoney ELSE 0 END)) AS 會簽數
,0.0 AS 執行率,0.0 AS 可動支餘額
,SUM((CASE WHEN acvMoney_Kind=3 THEN EV.acvMoney ELSE 0 END)) AS 決標未執行數
,SUM((CASE WHEN acvMoney_ResFlag=3 AND acvMoney_Kind IN (1,2) THEN EV.acvMoney ELSE 0 END)) AS 標餘款
,SUM((CASE WHEN acvMoney_Kind=12 AND acmYear= IsNull(acpPayYear1, acpPayYear) THEN EV.acvAdjustMoney ELSE 0 END)) AS 繳回款
,SUM((CASE WHEN acvMoney_Kind>=3 AND ISNULL(acvNo2,0)>0 THEN EV.acvMoney ELSE 0 END)) AS 決標數
 FROM (
SELECT ISNULL(M.acmTeaCode,'') AS acmTeaCode 
 , IsNull(EV.acvBgtDepCode, ISNULL(ISNULL(M.acmBgtUnitNo,M.acmWorkUnitNo),'')) AS acmBgtUnitNo,ISNULL(ISNULL(M.acmWorkUnitNo,M.acmBgtUnitNo),'') AS acmWorkUnitNo
      ,ISNULL(acvPlanCode,'') AS acvPlanCode,ISNULL(acvOutlayYear,0) AS acvOutlayYear,ISNULL(acvOutlayCode,'') AS acvOutlayCode
      ,ISNULL(acvBgtSourceCode,'') AS acvBgtSourceCode,ISNULL(acvAccKind,'') AS acvAccKind,ISNULL(acvBizCode,'') AS acvBizCode
      ,acvPrePayFlag
      ,acvMoney,acvAdjustMoney,acvMoney_Kind,acvMoney_ResFlag
      ,EV.acmYear,EV.acmNo
      ,ISNULL(M.acmBgtKind,'0') AS acmBgtKind
      ,ISNULL(acvMemo,M.acmMemo) AS acvMemo
      ,EV.acvNo2,EV.acpPayYear
      , EV.acpPayYear1       ,ISNULL(M.acmWordNum,'') AS acmWordNum,ISNULL(ISNULL(ISNULL(NULLIF(M.acmTopWordNum,''),NULLIF(M.acmSourWordNum,'')),M.acmWordNum),'') AS acmTopWordNum,ISNULL(ISNULL(EV.acmPayName,M.acmPayName),'') AS acmPayName
      ,EV.acvNo,acvSubNo,M.acmMarkDate,EV.acmMarkDateM1,EV.acmMarkDateM2,EV.acpMarkDateP,EV.acpMarkDateP1
      ,VMoney,V1Money,V2Money,PVMoney,PV1Money 
      ,NULL AS acvBgtYear      ,NULL AS acvBgtMonth
FROM 
(SELECT  (CASE WHEN PV1.acvPlanCode IS NOT NULL THEN PV1.acvPlanCode WHEN PV.acvPlanCode IS NOT NULL THEN PV.acvPlanCode
WHEN V2.acvPlanCode IS NOT NULL THEN V2.acvPlanCode WHEN V1.acvPlanCode IS NOT NULL THEN V1.acvPlanCode ELSE V.acvPlanCode END) as acvPlanCode
,(CASE WHEN PV1.acvOutlayYear IS NOT NULL THEN PV1.acvOutlayYear WHEN PV.acvOutlayYear IS NOT NULL THEN PV.acvOutlayYear
WHEN V2.acvOutlayYear IS NOT NULL THEN V2.acvOutlayYear WHEN V1.acvOutlayYear IS NOT NULL THEN V1.acvOutlayYear ELSE ISNULL(V.acvOutlayYear,V.acmYear) END) as acvOutlayYear
,(CASE WHEN PV1.acvOutlayCode IS NOT NULL THEN PV1.acvOutlayCode WHEN PV.acvOutlayCode IS NOT NULL THEN PV.acvOutlayCode
WHEN V2.acvOutlayCode IS NOT NULL THEN V2.acvOutlayCode WHEN V1.acvOutlayCode IS NOT NULL THEN V1.acvOutlayCode ELSE V.acvOutlayCode END) as acvOutlayCode
,(CASE WHEN PV1.acvBgtSourceCode IS NOT NULL THEN PV1.acvBgtSourceCode WHEN PV.acvBgtSourceCode IS NOT NULL THEN PV.acvBgtSourceCode
WHEN V2.acvBgtSourceCode IS NOT NULL THEN V2.acvBgtSourceCode WHEN V1.acvBgtSourceCode IS NOT NULL THEN V1.acvBgtSourceCode ELSE V.acvBgtSourceCode END) as acvBgtSourceCode
,(CASE WHEN PV1.acvAccKind IS NOT NULL THEN PV1.acvAccKind WHEN PV.acvAccKind IS NOT NULL THEN PV.acvAccKind
WHEN V2.acvAccKind IS NOT NULL THEN V2.acvAccKind WHEN V1.acvAccKind IS NOT NULL THEN V1.acvAccKind ELSE V.acvAccKind END) as acvAccKind
,(CASE WHEN PV1.acvBizCode IS NOT NULL THEN PV1.acvBizCode WHEN PV.acvBizCode IS NOT NULL THEN PV.acvBizCode
WHEN V2.acvBizCode IS NOT NULL THEN V2.acvBizCode WHEN V1.acvBizCode IS NOT NULL THEN V1.acvBizCode ELSE V.acvBizCode END) as acvBizCode
,(CASE WHEN PV1.acvPrePayFlag  IS NOT NULL THEN PV1.acvPrePayFlag  WHEN PV.acvPrePayFlag  IS NOT NULL THEN PV.acvPrePayFlag
WHEN V2.acvPrePayFlag  IS NOT NULL THEN V2.acvPrePayFlag  WHEN V1.acvPrePayFlag  IS NOT NULL THEN V1.acvPrePayFlag  ELSE V.acvPrePayFlag END) as acvPrePayFlag
,(CASE WHEN ISNULL(RPV.ResKind,ISNULL(RV2.ResKind,ISNULL(RV1.ResKind,ISNULL(RV.ResKind,''))))='' THEN
(CASE WHEN PV1.acmNo IS NOT NULL THEN (CASE WHEN ISNULL(P1.acpPassFlag,'0')<>'0' THEN ISNULL(PV1.acvPassMoney,PV1.acvMoney) ELSE PV1.acvMoney END)
WHEN PV.acmNo IS NOT NULL THEN (CASE WHEN ISNULL(P.acpPassFlag,'0')<>'0' THEN ISNULL(PV.acvPassMoney,PV.acvMoney) ELSE PV.acvMoney END)
WHEN V2.acmNo IS NOT NULL THEN (CASE WHEN ISNULL(M2.acmPassFlag,'0')<>'0' THEN ISNULL(V2.acvPassMoney,V2.acvMoney) ELSE V2.acvMoney END)
WHEN V1.acmNo IS NOT NULL THEN (CASE WHEN ISNULL(M1.acmPassFlag,'0')<>'0' THEN ISNULL(V1.acvPassMoney,V1.acvMoney) ELSE V1.acvMoney END)
ELSE (CASE WHEN ISNULL(M.acmPassFlag,'0')<>'0' THEN ISNULL(V.acvPassMoney,V.acvMoney) ELSE V.acvMoney END) END)
ELSE
(CASE WHEN PV1.acmNo IS NOT NULL THEN NULL WHEN PV.acmNo IS NOT NULL THEN PV.acvMoney - PV.acvMoney_Out_PV1
WHEN V2.acmNo IS NOT NULL THEN V2.acvMoney - V2.acvMoney_Out_PV
WHEN V1.acmNo IS NOT NULL THEN V1.acvMoney - (CASE WHEN V1.acvMoney_Out_PV IS NOT NULL OR V1.acvMoney_Out_V2 IS NOT NULL THEN ISNULL(V1.acvMoney_Out_PV,0)+ISNULL(V1.acvMoney_Out_V2,0) END)
ELSE V.acvMoney - (CASE WHEN V.acvMoney_Out_PV IS NOT NULL OR V.acvMoney_Out_V2 IS NOT NULL OR V.acvMoney_Out_V1 IS NOT NULL THEN ISNULL(V.acvMoney_Out_PV,0)+ISNULL(V.acvMoney_Out_V2,0)+ISNULL(V.acvMoney_Out_V1,0) END)
END)
END) as acvMoney,(CASE WHEN PV1.acmNo IS NOT NULL THEN PV1.acvAdjustMoney WHEN PV.acmNo IS NOT NULL THEN PV.acvAdjustMoney
WHEN V2.acmNo IS NOT NULL THEN V2.acvAdjustMoney ELSE V1.acvAdjustMoney END) as acvAdjustMoney
,(CASE WHEN PV1.acmNo IS NOT NULL THEN 12 WHEN PV.acmNo IS NOT NULL THEN 11
WHEN  V2.acmNo IS NOT NULL THEN 3 WHEN V1.acmNo IS NOT NULL THEN 2 ELSE 1 END) as acvMoney_Kind
,(CASE WHEN PV1.acvBgtDepCode IS NOT NULL THEN PV1.acvBgtDepCode WHEN PV.acvBgtDepCode IS NOT NULL THEN PV.acvBgtDepCode
  WHEN P.acpBgtUnitNo  IS NOT NULL THEN P.acpBgtUnitNo 
  WHEN V2.acvBgtDepCode IS NOT NULL THEN V2.acvBgtDepCode WHEN V1.acvBgtDepCode IS NOT NULL THEN V1.acvBgtDepCode 
  WHEN M1.acmBgtUnitNo IS NOT NULL THEN M1.acmBgtUnitNo 
  ELSE ISNULL(V.acvBgtDepCode,ISNULL(M.acmBgtUnitNo,M.acmWorkUnitNo)) END) as acvBgtDepCode
,(CASE WHEN PV1.acmNo IS NOT NULL THEN 1
WHEN PV.acmNo IS NOT NULL THEN (CASE WHEN PV.acvMoney_Out_PV1 IS NOT NULL THEN 12 ELSE 1 END)
WHEN V2.acmNo IS NOT NULL THEN (CASE WHEN V2.acvMoney_Out_PV IS NOT NULL THEN 11 ELSE 1 END)
WHEN V1.acmNo IS NOT NULL THEN (CASE WHEN V1.acvMoney_Out_PV IS NOT NULL THEN 11 WHEN V1.acvMoney_Out_V2 IS NOT NULL THEN 3 ELSE 1 END)
ELSE (CASE WHEN V.acvMoney_Out_PV IS NOT NULL THEN 11 WHEN V.acvMoney_Out_V2 IS NOT NULL THEN 3 WHEN V.acvMoney_Out_V1 IS NOT NULL THEN 2 ELSE 1 END)
END) as acvMoney_ResFlag
,ISNULL(V.acmYear,PV.acmYear) AS acmYear
,ISNULL(V.acmNo,PV.acmNo) as acmNo
,(CASE WHEN PV1.acvMemo  IS NOT NULL THEN PV1.acvMemo WHEN PV.acvMemo IS NOT NULL THEN PV.acvMemo
WHEN V2.acvMemo IS NOT NULL THEN V2.acvMemo WHEN V1.acvMemo IS NOT NULL THEN V1.acvMemo  ELSE ISNULL(V.acvMemo,M.acmMemo) END) as acvMemo
,ISNULL(ISNULL(ISNULL(ISNULL(PV1.acmNoPrv,PV.acmNoPrv),V2.acmNoPrv),V1.acmNoPrv),V.acmNo) AS acmNoPrv
,ISNULL(V2.acvNo2,PV.acvNo2) AS acvNo2
,PV.acpPayYear
,ISNULL(P1.acpPayYear1,P1.acpPayYear) as acpPayYear1
,(CASE WHEN NULLIF(P1.acpMemo,'') IS NOT NULL THEN P1.acpMemo WHEN NULLIF(P.acpMemo,'')  IS NOT NULL THEN P.acpMemo
WHEN NULLIF(M2.acmMemo,'') IS NOT NULL THEN M2.acmMemo WHEN NULLIF(M1.acmMemo,'') IS NOT NULL THEN NULLIF(M1.acmMemo,'') ELSE M.acmMemo END) as acmMemo
,(CASE WHEN P.acpPayName  IS NOT NULL THEN P.acpPayName
WHEN M2.acmPayName IS NOT NULL THEN M2.acmPayName WHEN M1.acmPayName IS NOT NULL THEN M1.acmPayName ELSE M.acmPayName END) as acmPayName
,(CASE WHEN M2.acmSubsidyCode IS NOT NULL THEN M2.acmSubsidyCode WHEN M1.acmSubsidyCode IS NOT NULL THEN M1.acmSubsidyCode ELSE M.acmSubsidyCode END) as acmSubsidyCode
,ISNULL(V.acvNo,PV.acvNo) AS acvNo
,PV.acvSubNo
,M1.acmMarkDate As acmMarkDateM1,M2.acmMarkDate AS acmMarkDateM2,P.acpMarkDate AS acpMarkDateP,P1.acpMarkDate AS acpMarkDateP1
,V.acvMoney as VMoney,V1.acvMoney as V1Money,V2.acvMoney as V2Money,PV.acvMoney as PVMoney,PV1.acvMoney as PV1Money
,(CASE WHEN V2.acvBgtYear IS NOT NULL THEN V2.acvBgtYear WHEN V1.acvBgtYear IS NOT NULL THEN V1.acvBgtYear WHEN V.acvBgtYear IS NOT NULL THEN V.acvBgtYear ELSE V.acmYear END) as acvBgtYear
,(CASE WHEN V2.acvBgtMonth IS NOT NULL THEN V2.acvBgtMonth WHEN V1.acvBgtMonth IS NOT NULL THEN V1.acvBgtMonth WHEN M1.acmMonth IS NOT NULL THEN M1.acmMonth WHEN V.acvBgtMonth IS NOT NULL THEN V.acvBgtMonth ELSE M.acmMonth END) as acvBgtMonth
 , M.acmPassDate As acmPassDateM, M1.acmPassDate As acmPassDateM1, M2.acmPassDate AS acmPassDateM2, P.acpPassDate AS acpPassDateP, P1.acpPassDate AS acpPassDateP1 
 FROM 
--簽證資料--
--簽證--
(SELECT *
,(SELECT Sum(IsNull(acvMoney,0)+ IsNull(acvAdjustMoney,0)) as acvMoney_Out FROM ActVisa1 V1
  WHERE  V1.acmYear=V.acmYear AND V1.acmNo=V.acmNo AND V1.acvNo=V.acvNo 
) as acvMoney_Out_V1
,(SELECT Sum(IsNull(acvMoney,0)+ IsNull(acvAdjustMoney,0)) as acvMoney_Out FROM ActVisa2 V2
  WHERE  V2.acmYear=V.acmYear AND V2.acmNo=V.acmNo AND V2.acvNo=V.acvNo 
 AND ISNULL(V2.acmNo1,0)=0 AND ISNULL(V2.acvNo1,0)=0
) as acvMoney_Out_V2
,(SELECT Sum(IsNull(acvMoney,0)+ IsNull(acvAdjustMoney,0)) as acvMoney_Out FROM ActPayVisa PV
  WHERE  PV.acmYear=V.acmYear AND PV.acmNo=V.acmNo AND PV.acvNo=V.acvNo 
 AND ISNULL(PV.acmNo1,0)=0 AND ISNULL(PV.acvNo1,0)=0
 AND ISNULL(PV.acmNo2,0)=0 AND ISNULL(PV.acvNo2,0)=0
) as acvMoney_Out_PV
FROM actVisa V

) V
JOIN actMain M
 ON M.acmYear=V.acmYear AND M.acmNo=V.acmNo
 AND V.acmYear=105 

--餘額--
JOIN (SELECT NULL as ResKind UNION SELECT '1' as ResKind) RV
 ON ISNULL(RV.ResKind,'')<>'1'
    OR (CASE WHEN V.acvMoney_Out_PV IS NOT NULL OR V.acvMoney_Out_V2 IS NOT NULL OR V.acvMoney_Out_V1 IS NOT NULL THEN ISNULL(V.acvMoney_Out_PV,0)+ISNULL(V.acvMoney_Out_V2,0)+ISNULL(V.acvMoney_Out_V1,0) END) < V.acvMoney 
--再簽資料--
LEFT OUTER JOIN
(--再簽--
(SELECT *
,(SELECT Sum(IsNull(acvMoney,0)+ IsNull(acvAdjustMoney,0)) as acvMoney_Out FROM ActVisa2 V2
  WHERE  V2.acmYear=V1.acmYear AND V2.acmNo=V1.acmNo AND V2.acvNo=V1.acvNo 
 AND ISNULL(V2.acmNo1,0)=ISNULL(V1.acmNo1,0) AND ISNULL(V2.acvNo1,0)=ISNULL(V1.acvNo1,0)
  ) as acvMoney_Out_V2
,(SELECT Sum(IsNull(acvMoney,0)+ IsNull(acvAdjustMoney,0)) as acvMoney_Out FROM ActPayVisa PV
  WHERE  PV.acmYear=V1.acmYear AND PV.acmNo=V1.acmNo AND PV.acvNo=V1.acvNo 
 AND ISNULL(PV.acmNo1,0)=ISNULL(V1.acmNo1,0) AND ISNULL(PV.acvNo1,0)=ISNULL(V1.acvNo1,0)
 AND ISNULL(PV.acmNo2,0)=0 AND ISNULL(PV.acvNo2,0)=0
 ) as acvMoney_Out_PV
FROM actVisa1 V1

) V1
JOIN actMain1 M1
 ON M1.acmYear=V1.acmYear AND M1.acmNo=ISNULL(V1.acmNoPrv,V1.acmNo) AND M1.acmNo1=V1.acmNo1
 AND V1.acmYear=105 

--餘額--
JOIN (SELECT NULL as ResKind UNION SELECT '2' as ResKind) RV1
 ON ISNULL(RV1.ResKind,'')<>'2'
    OR (CASE WHEN V1.acvMoney_Out_PV IS NOT NULL OR V1.acvMoney_Out_V2 IS NOT NULL THEN ISNULL(V1.acvMoney_Out_PV,0)+ISNULL(V1.acvMoney_Out_V2,0) END) < V1.acvMoney

)
ON V1.acmYear=V.acmYear AND V1.acmNo=V.acmNo AND V1.acvNo=V.acvNo 
 AND ISNULL(RV.ResKind,'')=''
--決標資料--
LEFT OUTER JOIN
(--決標--
(SELECT *
,(SELECT Sum(IsNull(acvMoney,0)+ IsNull(acvAdjustMoney,0)) as acvMoney_Out FROM ActPayVisa PV
  WHERE  PV.acmYear=V2.acmYear AND PV.acmNo=V2.acmNo AND PV.acvNo=V2.acvNo 
 AND ISNULL(PV.acmNo1,0)=ISNULL(V2.acmNo1,0) AND ISNULL(PV.acvNo1,0)=ISNULL(V2.acvNo1,0)
 AND ISNULL(PV.acmNo2,0)=ISNULL(V2.acmNo2,0) AND ISNULL(PV.acvNo2,0)=ISNULL(V2.acvNo2,0)
 ) as acvMoney_Out_PV
FROM actVisa2 V2

) V2
JOIN actMain2 M2
 ON M2.acmYear=V2.acmYear AND M2.acmNo=ISNULL(V2.acmNoPrv,V2.acmNo) AND M2.acmNo1=V2.acmNo1 AND M2.acmNo2=V2.acmNo2
 AND V2.acmYear=105 

--餘額--
JOIN (SELECT NULL as ResKind UNION SELECT '3' as ResKind) RV2
 ON ISNULL(RV2.ResKind,'')<>'3'
    OR V2.acvMoney_Out_PV < V2.acvMoney

)
ON V2.acmYear=V.acmYear AND V2.acmNo=V.acmNo AND V2.acvNo=V.acvNo 
 AND ISNULL(V2.acmNo1,0)=ISNULL(V1.acmNo1,0) AND ISNULL(V2.acvNo1,0)=ISNULL(V1.acvNo1,0)
 AND ISNULL(RV1.ResKind,ISNULL(RV.ResKind,''))=''
--報支資料--
LEFT OUTER JOIN
(--報支--
(SELECT *
,(SELECT Sum(IsNull(acvMoney,0)+ IsNull(acvAdjustMoney,0)) as acvMoney_Out FROM ActPayVisa1 PV1
  WHERE  PV1.acmYear=PV.acmYear AND PV1.acmNo=PV.acmNo AND PV1.acvNo=PV.acvNo 
 AND ISNULL(PV1.acmNo1,0)=ISNULL(PV.acmNo1,0) AND ISNULL(PV1.acvNo1,0)=ISNULL(PV.acvNo1,0)
 AND ISNULL(PV1.acmNo2,0)=ISNULL(PV.acmNo2,0) AND ISNULL(PV1.acvNo2,0)=ISNULL(PV.acvNo2,0)
 AND PV1.acpPayYear=PV.acpPayYear AND PV1.acpPayNo=PV.acpPayNo AND PV1.acvSubNo=PV.acvSubNo
) as acvMoney_Out_PV1
  FROM actPayVisa PV

) PV
JOIN actPay P
 ON P.acmYear=PV.acmYear AND P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo) And P.acpPayYear=PV.acpPayYear And P.acpPayNo=PV.acpPayNo
 AND PV.acmYear=105 
--餘額--
JOIN (SELECT NULL as ResKind UNION SELECT '11' as ResKind) RPV
 ON ISNULL(RPV.ResKind,'')<>'11'
    OR PV.acvMoney_Out_PV1 < PV.acvMoney


)
ON PV.acmYear=V.acmYear AND PV.acmNo=V.acmNo AND PV.acvNo=V.acvNo 
 AND ISNULL(PV.acmNo1,0)=ISNULL(V1.acmNo1,0) AND ISNULL(PV.acvNo1,0)=ISNULL(V1.acvNo1,0)
 AND ISNULL(PV.acmNo2,0)=ISNULL(V2.acmNo2,0) AND ISNULL(PV.acvNo2,0)=ISNULL(V2.acvNo2,0)
 AND ISNULL(RV2.ResKind,ISNULL(RV1.ResKind,ISNULL(RV.ResKind,'')))=''
--轉正資料--
LEFT OUTER JOIN
(--轉正--
ActPayVisa1 PV1
JOIN actPay1 P1
 ON P1.acmYear=PV1.acmYear AND P1.acmNo=IsNull(PV1.acmNoPrv, PV1.acmNo) And P1.acpPayYear=PV1.acpPayYear 
 And P1.acpPayNo=PV1.acpPayNo And P1.acpPayNo1=PV1.acpPayNo1
 AND PV1.acmYear=105 

)
ON PV1.acmYear=V.acmYear AND PV1.acmNo=V.acmNo AND PV1.acvNo=V.acvNo 
 AND ISNULL(PV1.acmNo1,0)=ISNULL(V1.acmNo1,0) AND ISNULL(PV1.acvNo1,0)=ISNULL(V1.acvNo1,0)
 AND ISNULL(PV1.acmNo2,0)=ISNULL(V2.acmNo2,0) AND ISNULL(PV1.acvNo2,0)=ISNULL(V2.acvNo2,0)
 AND PV1.acpPayYear=PV.acpPayYear AND PV1.acpPayNo=PV.acpPayNo AND PV1.acvSubNo=PV.acvSubNo
 AND ISNULL(RPV.ResKind,ISNULL(RV2.ResKind,ISNULL(RV1.ResKind,ISNULL(RV.ResKind,''))))=''
) EV JOIN ActMain M ON M.acmYear=EV.acmYear AND M.acmNo=EV.acmNoPrv
WHERE EV.acmYear=105 
AND EV.acvBgtSourceCode IN (10) 
AND EV.acvAccKind IN (1) 
AND IsNull(EV.acvBgtDepCode, ISNULL(ISNULL(M.acmBgtUnitNo,M.acmWorkUnitNo),'')) LIKE '201%' 
AND EV.acvBizCode LIKE '15%' 
AND EV.acvPlanCode LIKE '304010105%' 
AND EV.acvOutlayCode LIKE '02%' 
AND EV.acvOutlayYear=ISNULL(NULLIF(105,0),EV.acvOutlayYear) 
UNION ALL
SELECT DISTINCT ISNULL(B.bgtTeaCode,'') AS acmTeaCode,ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo),'') AS acmBgtUnitNo,ISNULL(ISNULL(B.bgtWorkUnitNo,B.bgtDepCode),'')  AS acmWorkUnitNo
      ,ISNULL(B.bgtPlanCode,'') AS acvPlanCode,ISNULL(B.bgtOutlayYear,0) AS acvOutlayYear,ISNULL(B.bgtOutlayCode,'') AS acvOutlayCode
      ,ISNULL(B.bgtBgtSourceCode,'') AS acvBgtSourceCode,ISNULL(B.bgtAccKind,'') AS acvAccKind,ISNULL(B.bgtBizCode,'') AS acvBizCode
      ,'0' AS acvPrePayFlag
      ,0 AS acvMoney,0 AS acvAdjustMoney,0 AS acvMoney_Kind,0 AS acvMoney_ResFlag
      ,B.bgtYear AS acmYear,NULL AS acmNo
      ,'0' AS acmBgtKind
      ,'' AS acvMemo
      ,NULL AS acvNo2,NULL AS acpPayYear
       , Null As acpPayYear1       ,'' AS acmWordNum,'' AS acmTopWordNum,'' AS acmPayName
      ,NULL AS acvNo,NULL AS acvSubNo,NULL AS acmMarkDate,NULL AS acmMarkDateM1,NULL AS acmMarkDateM2,NULL AS acpMarkDateP,NULL AS acpMarkDateP1
      ,NULL as VMoney,NULL as V1Money,NULL as V2Money,NULL as PVMoney,NULL as PV1Money 
      ,NULL AS acvBgtYear      ,NULL AS acvBgtMonth
From
bgtBudget B LEFT OUTER JOIN
(
 ActMain M Join ActVisa V ON M.acmYear=V.acmYear And M.acmNo=V.acmNo
 Left OUTER JOIN
 (ActPayVisa PV Join ActPay P ON PV.acmYear=P.acmYear And IsNull(PV.acmNoPrv, PV.acmNo) =P.acmNo And PV.acpPayYear=P.acpPayYear And PV.acpPayNo=P.acpPayNo
  LEFT OUTER JOIN
  ActPayVisa1 PV1 ON PV1.acmYear=PV.acmYear And PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo
  And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo=PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
  And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
  And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
 )
 ON PV.acmYear=V.acmYear And PV.acmNo=V.acmNo And PV.acvNo=V.acvNo
)
ON  B.bgtYear=M.acmYear
AND B.bgtTeaCode=M.acmTeaCode
AND B.bgtDepCode=ISNULL(M.acmBgtUnitNo,M.acmWorkUnitNo)
AND B.bgtWorkUnitNo=ISNULL(M.acmWorkUnitNo,M.acmBgtUnitNo)
AND B.bgtOutlayYear=ISNULL(ISNULL(PV1.acvOutlayYear,PV.acvOutlayYear),V.acvOutlayYear)
AND B.bgtPlanCode=ISNULL(ISNULL(PV1.acvPlanCode,PV.acvPlanCode),V.acvPlanCode)
AND B.bgtOutlayCode=ISNULL(ISNULL(PV1.acvOutlayCode,PV.acvOutlayCode),V.acvOutlayCode)
AND B.bgtBgtSourceCode=ISNULL(ISNULL(PV1.acvBgtSourceCode,PV.acvBgtSourceCode),V.acvBgtSourceCode)
AND B.bgtAccKind=ISNULL(ISNULL(PV1.acvAccKind,PV.acvAccKind),V.acvAccKind)
AND B.bgtBizCode=ISNULL(ISNULL(PV1.acvBizCode,PV.acvBizCode),V.acvBizCode)
WHERE M.acmNo IS NULL AND (ISNULL(B.bgtPlanCode,'')<>'' OR ISNULL(B.bgtOutlayCode,'')<>'') AND ISNULL(B.bgtKind,'0') NOT IN ('1','2')
AND B.bgtYear=105 
AND B.bgtBgtSourceCode IN (10) 
AND B.bgtAccKind IN (1) 
AND ISNULL(ISNULL(B.bgtDepCode,B.bgtWorkUnitNo),'') LIKE '201%' 
AND B.bgtBizCode LIKE '15%' 
AND B.bgtPlanCode LIKE '304010105%' 
AND B.bgtOutlayCode LIKE '02%' 
 AND B.bgtOutlayYear=ISNULL(NULLIF(105,0),B.bgtOutlayYear)  
) EV
) EV ;
 Select * From ##TO__104385455501109012017 ;
 Drop Table ##TO__104385455501109012017 ;

-------------------------------------------------------------------------------
#2017/1/9 下午 01:38:05#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=14b83aacaa5ba9fba5e8c7cabdd130a9

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/10 上午 08:59:37#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=c6133752f0366d600d8055edc2c68dff

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/10 上午 08:59:54#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=c6133752f0366d600d8055edc2c68dff

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/10 上午 09:03:35#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=3a290378ffb72bab144ce0b5ac7d5425

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/10 上午 10:52:30#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=c45d5db6eeee206bc32f80e284e6d144

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/10 下午 08:15:16#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=631fc49c91e71cb1d629edf3fcc952d5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/10 下午 08:15:29#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=631fc49c91e71cb1d629edf3fcc952d5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/11 下午 12:28:23#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7925571059e8398eca50f1d60910c6de

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/11 下午 12:28:24#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=cfe91f17bd9fbe0fffacd5f2ca9835dd

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/11 下午 02:02:45#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=968dc80659cbc276a30d70e90edb264e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/11 下午 04:26:05#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=6f206e90f3d9a7718140fd26027efd53

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/11 下午 04:26:22#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=6f206e90f3d9a7718140fd26027efd53

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/11 下午 04:39:56#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=28c85eca4c652be62e2ab945673c19e2

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/12 上午 10:04:45#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b9e116de1f860354536b69bfadae0770

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/12 下午 02:28:22#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=37069ee9866deb65c893c0959aca0ffd

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/12 下午 04:28:45#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=e032b907bb6d12f4752d2afc1c0acbd6

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/12 下午 04:28:51#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=e032b907bb6d12f4752d2afc1c0acbd6

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/13 上午 11:36:00#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=2f5b0745f36aed042a33d50ebd8184de

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/13 下午 02:39:31#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=42dcd2fedfd3a988b95b960d62ec58f0

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/16 上午 11:42:49#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=f23b8c42a4abc931d8bc1640cb4d616b

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/17 上午 11:38:35#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9e90da79b1d5ccfd8645717c0a1e53f5

---Message---
======================================
帳號：serenaya】
密碼：S224342254】
人事系統單位代碼：001001016007
======================================

-------------------------------------------------------------------------------
#2017/1/17 下午 12:00:05#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9e90da79b1d5ccfd8645717c0a1e53f5

---Message---
======================================
帳號：serenaya】
密碼：S224342254】
人事系統單位代碼：001001016007
======================================

-------------------------------------------------------------------------------
#2017/1/17 下午 04:36:33#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=607bd6447479a08f3557a54255b015f6

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/17 下午 04:36:48#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=607bd6447479a08f3557a54255b015f6

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/18 上午 11:15:25#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a48c684177f795399194a0fe896e069a

---Message---
======================================
帳號：serenaya】
密碼：S224342254】
人事系統單位代碼：001001016007
======================================

-------------------------------------------------------------------------------
#2017/1/18 上午 11:15:52#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a48c684177f795399194a0fe896e069a

---Message---
======================================
帳號：serenaya】
密碼：S224342254】
人事系統單位代碼：001001016007
======================================

-------------------------------------------------------------------------------
#2017/1/18 上午 11:17:40#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=ff3e244b1ceb25d33256beb349dd7433

---Message---
======================================
帳號：serenaya】
密碼：S224342254】
人事系統單位代碼：001001016007
======================================

-------------------------------------------------------------------------------
#2017/1/18 上午 11:20:08#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=ff3e244b1ceb25d33256beb349dd7433

---Message---
======================================
帳號：serenaya】
密碼：S224342254】
人事系統單位代碼：001001016007
======================================

-------------------------------------------------------------------------------
#2017/1/18 上午 11:20:18#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=ff3e244b1ceb25d33256beb349dd7433

---Message---
======================================
帳號：serenaya】
密碼：S224342254】
人事系統單位代碼：001001016007
======================================

-------------------------------------------------------------------------------
#2017/1/18 上午 11:33:52#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=ff3e244b1ceb25d33256beb349dd7433

---Message---
======================================
帳號：serenaya】
密碼：S224342254】
人事系統單位代碼：001001016007
======================================

-------------------------------------------------------------------------------
#2017/1/19 下午 04:54:22#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=5e17cc4701a916807ad61cc98e285d96

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/19 下午 04:54:27#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=5e17cc4701a916807ad61cc98e285d96

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/19 下午 05:34:58#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=211feb470b889d8c13c64e7615e1f851

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/20 上午 10:42:43#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=81bf5a8c7b7ca36861287ba31bc1ae5a

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/23 下午 01:31:42#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=52e44bb831ad6193b395ae0a989c2c4f

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/23 下午 01:31:50#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=52e44bb831ad6193b395ae0a989c2c4f

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/23 下午 02:52:50#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a699d1f484c9816fb0175df48a5165d6

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/23 下午 02:53:04#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a699d1f484c9816fb0175df48a5165d6

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/23 下午 04:23:55#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=62826cf2826a93a0630398d490867854

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/23 下午 04:24:00#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=62826cf2826a93a0630398d490867854

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/24 上午 09:52:33#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=310a8483d478b5db3f40b196cd3f9118

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/24 下午 12:05:21#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b33d24c8dce7fa09f1d6979441e06c9e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/24 下午 12:21:03#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b33d24c8dce7fa09f1d6979441e06c9e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/24 下午 12:21:05#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b33d24c8dce7fa09f1d6979441e06c9e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/24 下午 12:21:06#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b33d24c8dce7fa09f1d6979441e06c9e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/24 下午 12:21:08#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b33d24c8dce7fa09f1d6979441e06c9e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/24 下午 12:21:09#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b33d24c8dce7fa09f1d6979441e06c9e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/24 下午 04:50:34#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=0b7d3554574e8cc6407254c487a7eaba

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/25 上午 11:44:26#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=53e718a389334e7d73d6b7242441f78e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/25 下午 12:13:24#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=1962e7c23883fdf1d7a9b6d8c22bfd24

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/25 下午 12:13:28#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=1962e7c23883fdf1d7a9b6d8c22bfd24

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/25 下午 12:13:39#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=1962e7c23883fdf1d7a9b6d8c22bfd24

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/25 下午 12:13:44#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=1962e7c23883fdf1d7a9b6d8c22bfd24

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/25 下午 01:48:27#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=892a5111818dd11c7ba11412f7b8ab50

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/25 下午 03:12:03#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=89c5a61874137c408f2dcd3ef0c55520

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/25 下午 03:12:08#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=89c5a61874137c408f2dcd3ef0c55520

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/25 下午 03:28:56#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=89c5a61874137c408f2dcd3ef0c55520

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/26 上午 09:26:03#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=41ed956f903440c00acc1d2263b899fb

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/26 上午 09:26:18#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=41ed956f903440c00acc1d2263b899fb

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/26 上午 09:26:31#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=41ed956f903440c00acc1d2263b899fb

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/26 上午 09:26:49#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=41ed956f903440c00acc1d2263b899fb

---Message---
no such user
-------------------------------------------------------------------------------
#2017/1/26 下午 12:03:07#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7a68314f23198d942b805d29548bb737

---Message---
======================================
帳號：iris】
密碼：H224182189】
======================================

-------------------------------------------------------------------------------
#2017/1/26 下午 12:05:39#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=1c5039efc163343c59ab47b361fc0ed3

---Message---
======================================
帳號：kcwang35】
密碼：A226970420】
======================================

-------------------------------------------------------------------------------
#2017/1/26 下午 12:06:04#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=1c5039efc163343c59ab47b361fc0ed3

---Message---
======================================
帳號：kcwang35】
密碼：A226970420】
======================================

-------------------------------------------------------------------------------
#2017/1/26 下午 03:50:38#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=2ed6b25f2d6f47ec2de1d2094a06b120

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/2 上午 09:28:32#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=59c7c35cfc54aef648c3ffbbd690e047

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/2 上午 09:28:38#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=59c7c35cfc54aef648c3ffbbd690e047

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/2 上午 11:28:20#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=73f65e605b4d2269110ab809f75011a7

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/2 上午 11:28:32#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=73f65e605b4d2269110ab809f75011a7

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/2 上午 11:28:39#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=73f65e605b4d2269110ab809f75011a7

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/2 上午 11:31:24#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8a44ac8e43633ed8b0d331978cff62b2

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/2 上午 11:31:31#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8a44ac8e43633ed8b0d331978cff62b2

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/2 上午 11:32:15#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=cf45421d9bb001c9e77dc0827f2a7c51

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/3 上午 09:32:29#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=dc9b25768ead5f1bd853742d9d762a36

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/3 上午 09:32:35#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=dc9b25768ead5f1bd853742d9d762a36

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/3 上午 09:33:22#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b0e167642373c22a0f3b7aedaaaf82b1

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/3 上午 09:52:21#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b0e167642373c22a0f3b7aedaaaf82b1

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/3 上午 11:52:51#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=027c21f9c328619dde05b2ca60060760

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/6 上午 11:57:48#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8cd48f0bec029f537d0dc57186c7d7d9

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/6 上午 11:57:57#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8cd48f0bec029f537d0dc57186c7d7d9

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/6 下午 01:36:21#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=bd067eefdc020077d6b6eab56aea267a

---Message---
======================================
帳號：loganita】
密碼：B222050437】
======================================

-------------------------------------------------------------------------------
#2017/2/6 下午 01:38:14#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=bd067eefdc020077d6b6eab56aea267a

---Message---
======================================
帳號：loganita】
密碼：B222050437】
======================================

-------------------------------------------------------------------------------
#2017/2/6 下午 01:38:40#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=bd067eefdc020077d6b6eab56aea267a

---Message---
======================================
帳號：loganita】
密碼：B222050437】
======================================

-------------------------------------------------------------------------------
#2017/2/6 下午 01:45:33#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7bd7ab6940ff99e5c3b92b98750b1292

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/6 下午 01:45:35#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7bd7ab6940ff99e5c3b92b98750b1292

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/6 下午 01:45:36#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7bd7ab6940ff99e5c3b92b98750b1292

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/6 下午 01:45:36#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=3eb5eb288bbe6af6d1487cfcfe071b99

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/6 下午 01:45:47#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a0596b2db684e13e3ca481923b4a37c5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/6 下午 02:55:58#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=bcfc63be371689e673b3902d170072e1

---Message---
======================================
帳號：loganita】
密碼：B222050437】
======================================

-------------------------------------------------------------------------------
#2017/2/6 下午 03:00:24#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=0e27e517a334b918440f29089bb115b2

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/6 下午 04:51:30#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9f2797de9c2ef6575e09cfa52e5bece1

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/6 下午 05:08:44#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=2dc41490d36f32d9d412021e90e1c2bc

---Message---
======================================
帳號：loganita】
密碼：B222050437】
======================================

-------------------------------------------------------------------------------
#2017/2/6 下午 05:10:42#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=815b5f66531ccbfd73288496621474f1

---Message---
======================================
帳號：loganita】
密碼：B222050437】
======================================

-------------------------------------------------------------------------------
#2017/2/7 上午 08:52:41#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b68ef4407c5a63628fa160a555f8a5c6

---Message---
======================================
帳號：loganita】
密碼：B222050437】
======================================

-------------------------------------------------------------------------------
#2017/2/7 上午 09:31:25#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b68ef4407c5a63628fa160a555f8a5c6

---Message---
======================================
帳號：loganita】
密碼：B222050437】
======================================

-------------------------------------------------------------------------------
#2017/2/7 下午 01:43:40#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=992d74126dc45f67ec78405201e9babd

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/8 下午 03:03:26#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=0f0bcce40483e2a5d2e3c873a255dc84

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/8 下午 03:04:34#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=0f0bcce40483e2a5d2e3c873a255dc84

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/10 下午 02:42:44#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=babe9e4b3a4f11d141183c9d4be92ea5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/10 下午 02:42:50#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=babe9e4b3a4f11d141183c9d4be92ea5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/10 下午 02:42:55#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=babe9e4b3a4f11d141183c9d4be92ea5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/10 下午 02:43:01#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=babe9e4b3a4f11d141183c9d4be92ea5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/10 下午 02:43:05#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=babe9e4b3a4f11d141183c9d4be92ea5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/10 下午 02:43:15#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=babe9e4b3a4f11d141183c9d4be92ea5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/13 下午 01:43:49#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=3ef05a2a4d4f89abf6752d312840b450

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/13 下午 03:02:17#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=bf1e1fd903f8d1ca71b97773efd4c162

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/13 下午 03:33:37#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=46c52eab2afa1d010f056e142d669fa1

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/13 下午 04:10:26#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8a2c8cf1ce47af1f8ff7c6cc24aa381e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/13 下午 04:10:55#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8a2c8cf1ce47af1f8ff7c6cc24aa381e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/13 下午 04:14:06#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=46c52eab2afa1d010f056e142d669fa1

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/13 下午 04:34:55#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=46c52eab2afa1d010f056e142d669fa1

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/13 下午 04:35:02#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=46c52eab2afa1d010f056e142d669fa1

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/14 下午 01:49:23#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a655cb59ea5a1095b984d7e0a1b4fcab

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/14 下午 01:49:29#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a655cb59ea5a1095b984d7e0a1b4fcab

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/14 下午 02:37:33#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=ebad98e7dbca0ccaa444e6eaf86eb140

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/14 下午 02:37:42#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=ebad98e7dbca0ccaa444e6eaf86eb140

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/15 下午 03:46:00#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=14cf753c2dab180cd0bc234a74a6b395

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/15 下午 03:46:10#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=14cf753c2dab180cd0bc234a74a6b395

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/15 下午 03:46:43#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=172144808753e7787d3ddde9e5801ee2

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/15 下午 03:46:55#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=172144808753e7787d3ddde9e5801ee2

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/15 下午 03:47:27#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=172144808753e7787d3ddde9e5801ee2

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/15 下午 03:48:21#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=db15026a459206e41efe9a334947cd5d

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/15 下午 03:49:39#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=db15026a459206e41efe9a334947cd5d

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/15 下午 03:50:06#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=db15026a459206e41efe9a334947cd5d

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/15 下午 03:53:45#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=db15026a459206e41efe9a334947cd5d

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/15 下午 03:58:08#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=db15026a459206e41efe9a334947cd5d

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/15 下午 03:59:13#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=d75af9446aedd9cc0bb8e68e1948c13c

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/16 下午 03:27:48#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=1c9005d79106a172cfd97dc05fdce31a

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/16 下午 03:28:43#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=1c9005d79106a172cfd97dc05fdce31a

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/16 下午 03:29:41#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=1c9005d79106a172cfd97dc05fdce31a

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/16 下午 03:37:10#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=e24dcb3176d36ca1131253fb5dbf43d2

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/16 下午 04:34:07#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=860205dde4e8cb997ef8686a8b070b4c

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/16 下午 05:03:57#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=e24dcb3176d36ca1131253fb5dbf43d2

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/16 下午 05:04:39#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a170c1779d51ebb28b25f3a16ffab92d

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/16 下午 05:09:11#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=85eacbc14248a74dd81ad58df3cc7131

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/16 下午 05:10:29#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b0fad3b56e5b10efaf767fce079a457e

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/17 下午 02:26:15#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=c2efa424e91aa365502ba3c2314ce3d4

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/17 下午 02:26:22#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=c2efa424e91aa365502ba3c2314ce3d4

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/17 下午 02:26:35#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=c2efa424e91aa365502ba3c2314ce3d4

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/17 下午 03:14:52#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=165f09f8afdf0ff85f862c5b001bf266

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/17 下午 03:15:35#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=0e117d2b6c90a494cad92d9ec6c50b71

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/17 下午 03:31:49#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=0e117d2b6c90a494cad92d9ec6c50b71

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/17 下午 03:34:05#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=65fa805bb1957d2f65ad44c41a500a74

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/17 下午 04:16:58#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=38ce4b52677b80db567d651deb7eea4d

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/18 上午 09:20:09#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=86bc1ad427116d0d2fbc231b57e23b02

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/18 上午 11:26:04#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8050102460e04a636620b229e2cfaadc

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/21 上午 09:41:14#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=d5ec5b21c1728a221bde1fb56c0a15e4

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/21 下午 03:40:02#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=85651de834bf24d19fc65cded3e422fe

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/21 下午 03:40:17#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=85651de834bf24d19fc65cded3e422fe

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/21 下午 03:40:25#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=85651de834bf24d19fc65cded3e422fe

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/21 下午 03:49:29#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=25fa33b6278ca1d9b00500d890cce2a1

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/21 下午 03:49:38#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=25fa33b6278ca1d9b00500d890cce2a1

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/21 下午 04:05:15#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a4a7689216f4519857c8bb8b5aec9cea

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/22 上午 11:02:18#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b181f5a9521f97e97a7b663ffe3bf304

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/22 下午 01:33:03#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b7bfa118645b688edb923ba77186aea5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/22 下午 02:37:11#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a88975cd1678c7fee6f2b47d9d514e5d

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/23 下午 01:31:06#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=75d6570d129499224cc82ef2574ca472

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/23 下午 01:31:11#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=75d6570d129499224cc82ef2574ca472

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/23 下午 01:31:20#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=75d6570d129499224cc82ef2574ca472

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/23 下午 01:56:08#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=d0589499a7f61e69f59160ba81a86dce

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/23 下午 04:36:07#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=81fc327ce8053268d895fc9eb022b2ad

---Message---
no such user
-------------------------------------------------------------------------------
#2017/2/24 上午 08:44:37#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=1c13b15f76981e444cba862e8e9964b9

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/2/24 下午 03:35:34#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=3fae6848d6521c8e82e430b45c4ed599

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/1 上午 10:13:17#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4017d7bcefc009fb8a7078b25dd58815

---Message---
======================================
帳號：siviya】
密碼：E224361338】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:13:33#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4017d7bcefc009fb8a7078b25dd58815

---Message---
======================================
帳號：siviya】
密碼：E224361338】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:16:50#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4017d7bcefc009fb8a7078b25dd58815

---Message---
======================================
帳號：siviya】
密碼：E224361338】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:17:41#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8a13f4a8ad8d4aff150e861a0728d724

---Message---
======================================
帳號：cheri】
密碼：E223719787】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:17:52#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8a13f4a8ad8d4aff150e861a0728d724

---Message---
======================================
帳號：cheri】
密碼：E223719787】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:18:49#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4017d7bcefc009fb8a7078b25dd58815

---Message---
======================================
帳號：siviya】
密碼：E224361338】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:19:30#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=be5a8d0841b759718c6afa4e750d403f

---Message---
======================================
帳號：up0618】
密碼：D120741097】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:20:53#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4017d7bcefc009fb8a7078b25dd58815

---Message---
======================================
帳號：siviya】
密碼：E224361338】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:21:20#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9a3c78c59fa6fc13e51ad29a861ede1b

---Message---
======================================
帳號：yuneng】
密碼：I100055679】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:22:09#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=d872c37355605f97f180aa7fc79beb25

---Message---
======================================
帳號：abc】
密碼：T221519423】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:25:01#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4017d7bcefc009fb8a7078b25dd58815

---Message---
======================================
帳號：siviya】
密碼：E224361338】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:25:04#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4017d7bcefc009fb8a7078b25dd58815

---Message---
======================================
帳號：siviya】
密碼：E224361338】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:25:09#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4017d7bcefc009fb8a7078b25dd58815

---Message---
======================================
帳號：siviya】
密碼：E224361338】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:25:12#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4017d7bcefc009fb8a7078b25dd58815

---Message---
======================================
帳號：siviya】
密碼：E224361338】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:28:00#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=be5a8d0841b759718c6afa4e750d403f

---Message---
======================================
帳號：up0618】
密碼：D120741097】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 10:52:50#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9a3c78c59fa6fc13e51ad29a861ede1b

---Message---
======================================
帳號：yuneng】
密碼：I100055679】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 11:03:00#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4c04a75a8cb8687b73fe934d3bf5efe4

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 11:21:32#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4c04a75a8cb8687b73fe934d3bf5efe4

---Message---
======================================
帳號：ccying0818】
密碼：R220855099】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 11:24:03#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8a13f4a8ad8d4aff150e861a0728d724

---Message---
======================================
帳號：cheri】
密碼：E223719787】
人事系統單位代碼：001001016002009
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 11:42:19#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=060625cd7f921438a87b9bd78c0217cd

---Message---
======================================
帳號：ymlu】
密碼：D220967066】
人事系統單位代碼：001001016003007
======================================

-------------------------------------------------------------------------------
#2017/3/1 上午 11:42:29#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=060625cd7f921438a87b9bd78c0217cd

---Message---
======================================
帳號：ymlu】
密碼：D220967066】
人事系統單位代碼：001001016003007
======================================

-------------------------------------------------------------------------------
#2017/3/1 下午 04:44:50#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=5716ec403a2bade216e22b5729e008d0

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/3 下午 02:30:02#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=511cea1c1d92ec652c863a454da02b82

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/6 下午 01:35:38#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=c8d309009c5b1328935617c4789b3a1e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/6 下午 02:38:11#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=cfbe2da97f47bcdf11970d2f51157074

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/6 下午 03:24:08#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=50e20fe5aa159aa56c2544b7a25a107d

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/7 下午 03:53:00#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=13d98c6d87d79afffa382e5bdb26a722

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/8 下午 01:51:18#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=e26a01deae08fdb5897f0370bc666e92

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/8 下午 04:12:01#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8946c3e541a77890c0f8bb1c37f5f2ff

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/8 下午 04:15:32#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8946c3e541a77890c0f8bb1c37f5f2ff

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/9 上午 10:42:58#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9c0d3838da9419e2f3be3502d58209e5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/9 上午 10:43:07#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=9c0d3838da9419e2f3be3502d58209e5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/9 下午 01:59:51#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b69e161c28782d170748f7f41622316f

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/9 下午 01:59:57#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b69e161c28782d170748f7f41622316f

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/9 下午 02:00:01#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b69e161c28782d170748f7f41622316f

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/10 下午 01:42:46#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=cbbe1616c408b98cffb0793df5314f82

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/10 下午 01:44:12#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4a85ac50b48f522945a45048887ec7b8

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/10 下午 01:44:18#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4a85ac50b48f522945a45048887ec7b8

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/10 下午 02:48:37#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=f6b29490029221854d32115ca51a0e33

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/10 下午 04:42:06#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=32e05670046f21a42be717f847244822

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/13 上午 10:05:19#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=d76f5c64b9d2e5c1fd15a2f9f20821c1

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/13 下午 02:40:20#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=5a97c1ef853661009d8b5e3666bb196e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/13 下午 04:43:51#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=1c4af81d5a944684c44af26ef121cdab

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/14 上午 08:50:56#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4b9ad5a2c660076c52dd9d5e3db3651d

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/14 上午 11:46:27#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=dc78f2e47830a6c4a08fb41a87888554

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/14 下午 04:20:01#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=04dadf13e5facb905edab966a423e8d3

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/14 下午 05:17:23#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=616694b82617522e57040a87e5272a07

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/14 下午 05:43:10#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=df8101946de35b08e09af84502657aea

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/15 下午 04:48:30#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a07d1ebf669769ca71412c72ce23ef1b

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/16 下午 01:38:00#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=6a3da07c8048e5073506723658302eea

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/16 下午 04:15:44#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b90bea6d73df88b3ec3d96e544f7b40e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/17 上午 10:33:19#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=32c1c1544017cabfbab263b4e325737e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/17 下午 01:20:11#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b116ea4d292138f9bc9276c2cfc40c27

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/17 下午 02:26:19#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=3c0269a9bcdd53e1da5d1dc64c247335

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/17 下午 02:26:44#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=3c0269a9bcdd53e1da5d1dc64c247335

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/20 上午 10:15:26#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=045d3871efa6897013677b5bac2c1c45

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/20 上午 10:15:32#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=045d3871efa6897013677b5bac2c1c45

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/20 上午 11:33:30#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=33746452953f54d4e7d23033b4623787

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/20 上午 11:33:42#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=33746452953f54d4e7d23033b4623787

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/20 上午 11:33:58#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=33746452953f54d4e7d23033b4623787

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/20 上午 11:34:07#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=33746452953f54d4e7d23033b4623787

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/20 上午 11:38:03#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=33746452953f54d4e7d23033b4623787

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/21 下午 04:26:18#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=6a7bc292e2566f571303bc649798972e

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/22 上午 10:13:56#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=bb66f6d1ee078928dea1f1c94cbd6130

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/22 下午 03:29:53#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=ccd6dca7e4587a9dede7fba54d47336a

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/23 上午 11:48:49#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=16681d6ac7a868f546e7bde8cb3df513

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/23 上午 11:48:58#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=16681d6ac7a868f546e7bde8cb3df513

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/23 下午 02:07:15#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=cf36475f0dc811e65a3260500cff1f84

---Message---
======================================
帳號：tulip16】
密碼：T221654776】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:07:33#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=cf36475f0dc811e65a3260500cff1f84

---Message---
======================================
帳號：tulip16】
密碼：T221654776】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:08:01#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=cf36475f0dc811e65a3260500cff1f84

---Message---
======================================
帳號：tulip16】
密碼：T221654776】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:08:12#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=ad168b4cd7be72549653b97add71d82d

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/23 下午 02:08:58#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7ba723e783524af2d1d03632cc443cf1

---Message---
======================================
帳號：tulip16】
密碼：T221654776】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:09:29#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=897b274e93147abeea2b3e8e493138c3

---Message---
======================================
帳號：clfu】
密碼：S222557873】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:09:30#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a4076808e222c4648bc9c24fed59e6d6

---Message---
======================================
帳號：vela】
密碼：Q222314349】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:09:57#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=26daa777fd7dbac53cb87261be721eaa

---Message---
======================================
帳號：ylchen】
密碼：S220596578】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:11:29#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7ba723e783524af2d1d03632cc443cf1

---Message---
======================================
帳號：tulip16】
密碼：T221654776】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:13:13#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7ba723e783524af2d1d03632cc443cf1

---Message---
======================================
帳號：tulip16】
密碼：T221654776】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:13:27#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7ba723e783524af2d1d03632cc443cf1

---Message---
======================================
帳號：tulip16】
密碼：T221654776】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:15:43#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a61a8d44c5439d30f8f54688cb2df0c2

---Message---
======================================
帳號：treety】
密碼：S221922572】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:16:31#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a61a8d44c5439d30f8f54688cb2df0c2

---Message---
======================================
帳號：treety】
密碼：S221922572】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:18:35#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=0617e0aec55329e737376f2b63528c65

---Message---
======================================
帳號：tulip16】
密碼：T221654776】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:19:36#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a61a8d44c5439d30f8f54688cb2df0c2

---Message---
======================================
帳號：treety】
密碼：S221922572】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:20:13#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a61a8d44c5439d30f8f54688cb2df0c2

---Message---
======================================
帳號：treety】
密碼：S221922572】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:20:32#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=e32d60a6860d7302c4d227305835f3fc

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/23 下午 02:22:38#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a61a8d44c5439d30f8f54688cb2df0c2

---Message---
======================================
帳號：treety】
密碼：S221922572】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:23:07#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=68f6800f126f5c28cdf9cd3b2f7e799f

---Message---
======================================
帳號：tulip16】
密碼：T221654776】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:24:06#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a61a8d44c5439d30f8f54688cb2df0c2

---Message---
======================================
帳號：treety】
密碼：S221922572】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:24:20#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=b5dbce6170092331e833b2af627f5763

---Message---
======================================
帳號：stefanie】
密碼：S223987071】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:26:27#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=26daa777fd7dbac53cb87261be721eaa

---Message---
======================================
帳號：ylchen】
密碼：S220596578】
人事系統單位代碼：001001015004005
======================================

-------------------------------------------------------------------------------
#2017/3/23 下午 02:41:11#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=c0670a41fd9735b0ed02bdc4681774f6

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/23 下午 03:02:44#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4d052a245d7185b49754dbf3ec365e77

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/23 下午 03:02:57#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4d052a245d7185b49754dbf3ec365e77

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/23 下午 03:03:07#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4d052a245d7185b49754dbf3ec365e77

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/23 下午 03:03:18#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4d052a245d7185b49754dbf3ec365e77

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/23 下午 03:23:40#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7603425a2223149d2d4573ff0117ef47

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/23 下午 04:08:09#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=2fd4591bb683501bd41f6d46148d22c7

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/24 上午 10:32:31#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=fed303d38c99b0186c80c048c934a652

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/24 上午 10:32:37#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=fed303d38c99b0186c80c048c934a652

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/27 上午 10:03:30#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=f716440a3aa6c791d4fdbd5384b659dc

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/27 下午 02:09:47#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=2d7b296f0631758aee53c36edbe210a2

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/27 下午 05:35:31#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=c1821ae3c0e9ffa28b079b5e14c88695

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/29 上午 10:15:48#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=00b0a9411bc433b8afe8e74634ebdb65

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/29 下午 04:06:33#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=57fa108aa875cae693c08965bede3303

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/29 下午 04:06:39#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=57fa108aa875cae693c08965bede3303

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/30 下午 02:42:15#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=060d6e30ce53d7afe630b6c9afe3a7d5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/30 下午 05:49:21#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7cc62200a06584d478da0e9bb013b02d

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/30 下午 05:50:06#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=7cc62200a06584d478da0e9bb013b02d

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/31 上午 11:45:44#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8e84b11eadce02e8ccc79ee0aa9e1663

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/31 上午 11:45:53#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8e84b11eadce02e8ccc79ee0aa9e1663

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/31 下午 04:22:12#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=c7aecee9d6bd061fa74696374b40ba1b

---Message---
no such user
-------------------------------------------------------------------------------
#2017/3/31 下午 04:22:24#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=c7aecee9d6bd061fa74696374b40ba1b

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/5 下午 02:32:37#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=99d70b5c47f6556a01d5be1f4b7f2814

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/5 下午 02:32:51#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=d1a827a72d310d6f4f1042d99646b1d4

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/6 下午 02:21:06#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=a626f3056dc59020de791b07d67a6bae

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 上午 09:26:52#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=876acbb80df2134925287a7c8069efc5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 上午 09:27:06#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=876acbb80df2134925287a7c8069efc5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 上午 09:27:23#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=876acbb80df2134925287a7c8069efc5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 上午 09:27:37#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=876acbb80df2134925287a7c8069efc5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 上午 09:27:48#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=876acbb80df2134925287a7c8069efc5

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 上午 10:39:37#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=4c5188c63698fee597800e1fbcc547ee

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 下午 01:41:34#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=77bb8405af838fb50667056c46578f11

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 下午 01:41:48#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=77bb8405af838fb50667056c46578f11

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 下午 01:42:30#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=77bb8405af838fb50667056c46578f11

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 下午 01:42:39#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=77bb8405af838fb50667056c46578f11

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 下午 02:59:42#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=5dae495711d1acf7c0ce23c3d5081eff

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 下午 02:59:55#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=5dae495711d1acf7c0ce23c3d5081eff

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/7 下午 03:00:04#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=5dae495711d1acf7c0ce23c3d5081eff

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/10 上午 10:06:31#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=fb911f3515d2c16974b2739c87941f2d

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/10 上午 11:26:39#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=582e4b98e55aad74ba87673f78e03b12

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/10 上午 11:26:55#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=582e4b98e55aad74ba87673f78e03b12

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/10 下午 02:52:47#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=75f2ed836fb07dc7eff365c5dc5d8ebd

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/10 下午 03:22:36#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=8344aaf667782e9a496d147becb31a54

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/11 下午 01:39:49#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=d937ce6a5ca9bd4a62023b3eded86247

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/11 下午 01:39:53#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=d937ce6a5ca9bd4a62023b3eded86247

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/12 下午 04:44:16#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=49c778d26febf2b74ce5304f787d9040

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/13 下午 01:55:24#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=167816287050d46325f09a42e7db9475

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/13 下午 01:55:28#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=167816287050d46325f09a42e7db9475

---Message---
no such user
-------------------------------------------------------------------------------
#2017/4/13 下午 01:55:37#  http://gbceap.cdc.gov.tw/CDCGBCE/AutoLogin.aspx?ssokey=f8911429ace74c491323ba661e220639

---Message---
no such user
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:42#  http://localhost/CDCGBCE/intro.aspx
SELECT 'Powered by Microsoft SQL Server ' + CONVERT(nvarchar,SERVERPROPERTY('ProductVersion')) + ' ' + CONVERT(nvarchar,SERVERPROPERTY('ProductLevel'))
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:43#  http://localhost/CDCGBCE/Menu.aspx
SELECT DISTINCT (SELECT TOP 1 A2.PK_MnuNo  FROM  sysUserPower C2 INNER JOIN  sysGroupData D2 ON C2.PK_grpNo = D2.PK_grpNo INNER JOIN  sysMenuBase A2 ON A2.PK_MnuNo = D2.PK_mnuNo WHERE  (C2.PK_usrNo = 1)  AND ISNULL(mnuLevel,0)> -90 AND (ISNULL(mnuLevel,0)=0 OR mnuLevel >=1 OR mnuLevel=1*-1 OR mnuLevel<=-90)  AND A.PK_MnuNo LIKE A2.PK_MnuNo + '_%'  ORDER BY  A2.PK_MnuNo DESC) AS ParentPK_MnuNo, A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -90 AND (ISNULL(mnuLevel,0)=0 OR mnuLevel >=1 OR mnuLevel=1*-1 OR mnuLevel<=-90)  ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:45#  http://localhost/CDCGBCE/Logout.aspx?MenuID=Z
UPDATE sysBaseUser SET usrLogoutDTime='2017/04/13 14:23:45'  WHERE PK_usrNo=1
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:47#  http://localhost/CDCGBCE/Logout.aspx?MenuID=Z
INSERT logWhoRec (LogIP,LogDate,LogUser,LogMod,LogPage,LogWork,LogMemo,LogWorkUser,LogLevel,LogLink,LogSys) VALUES ('::1','2017/04/13 14:23:45','系統管理者','Logout','Logout.aspx','?MenuID=Z','','系統管理者',35,'','CDCGBCE/')
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:54#  http://localhost/CDCGBCE/Login.aspx
--[Parameter Count:2]
--@UserAlias='66666'
--@UserPwd='05072306'
SELECT * FROM sysBaseUser A WHERE usrAlias='66666' AND usrPwd='05072306' AND ISNULL(usrStateKind,'0')<>'1' ORDER BY PK_usrNo
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:54#  http://localhost/CDCGBCE/Login.aspx
UPDATE sysBaseUser SET usrLoginDTime='2017/04/13 14:23:54' ,usrLoginIP='::1'  WHERE PK_usrNo=1
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:54#  http://localhost/CDCGBCE/Login.aspx
INSERT logWhoRec (LogIP,LogDate,LogUser,LogMod,LogPage,LogWork,LogMemo,LogWorkUser,LogLevel,LogLink,LogSys) VALUES ('::1','2017/04/13 14:23:54','66666','Login','Login.aspx','','成功','系統管理者',35,'','CDCGBCE/')
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:54#  http://localhost/CDCGBCE/Login.aspx
Select Top 1 * From  ebsAgent 
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:54#  http://localhost/CDCGBCE/Login.aspx
 Select sysCloseDate From basBaseData 
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:54#  http://localhost/CDCGBCE/Login.aspx
Select dptName, dptCode  FROM codDepartName A  Where 1=1  and  dptCode = '203' Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:54#  http://localhost/CDCGBCE/Menu.aspx
SELECT DISTINCT (SELECT TOP 1 A2.PK_MnuNo  FROM  sysUserPower C2 INNER JOIN  sysGroupData D2 ON C2.PK_grpNo = D2.PK_grpNo INNER JOIN  sysMenuBase A2 ON A2.PK_MnuNo = D2.PK_mnuNo WHERE  (C2.PK_usrNo = 1)  AND ISNULL(mnuLevel,0)> -90 AND (ISNULL(mnuLevel,0)=0 OR mnuLevel >=1 OR mnuLevel=1*-1 OR mnuLevel<=-90)  AND A.PK_MnuNo LIKE A2.PK_MnuNo + '_%'  ORDER BY  A2.PK_MnuNo DESC) AS ParentPK_MnuNo, A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -90 AND (ISNULL(mnuLevel,0)=0 OR mnuLevel >=1 OR mnuLevel=1*-1 OR mnuLevel<=-90)  ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:23:55#  http://localhost/CDCGBCE/intro.aspx
SELECT 'Powered by Microsoft SQL Server ' + CONVERT(nvarchar,SERVERPROPERTY('ProductVersion')) + ' ' + CONVERT(nvarchar,SERVERPROPERTY('ProductLevel'))
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:24:08#  http://localhost/CDCGBCE/approved.Web/Frmapproved_approved/Default.aspx?MenuID=18621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 AND (ISNULL(mnuLevel,0)=0 OR mnuLevel >=1 OR mnuLevel=1*-1 OR mnuLevel<=-90)  ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:24:08#  http://localhost/CDCGBCE/approved.Web/Frmapproved_approved/Default.aspx?MenuID=18621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='18621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/4/13 下午 02:24:08
--連線字串：Data Source=localhost;Initial Catalog=CDCGBCE;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(10)
Set @PK_MnuNo = '18621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--#2017/4/13 下午 02:24:08#  http://localhost/CDCGBCE/approved.Web/Frmapproved_approved/Default.aspx?MenuID=18621
--[Parameter Count:1]
--@parMenuID='18621'
 Select * From SysMenuBase Where PK_MnuNo ='18621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/04/13 14:24:09.730 
-- 連線資料庫：CDCGBCEEntities 
--==============================================================================================================================--
DECLARE p__linq__0 AS INT
SET p__linq__0 = 106


SELECT 
[Project1].[C1] AS [C1], 
[Project1].[plnPlanCode] AS [plnPlanCode], 
[Project1].[C2] AS [C2], 
[Project1].[C3] AS [C3], 
[Project1].[C4] AS [C4], 
[Project1].[plnAliasNo] AS [plnAliasNo]
FROM ( SELECT 
	[Extent1].[plnPlanCode] AS [plnPlanCode], 
	[Extent1].[plnAliasNo] AS [plnAliasNo], 
	1 AS [C1], 
	N'[' + [Extent1].[plnPlanCode] + N'] ' + [Extent1].[plnPlanName] AS [C2], 
	 CAST( [Extent1].[plnLevel] AS int) AS [C3], 
	 CAST( [Extent1].[plnLevelEnd] AS int) AS [C4]
	FROM [dbo].[codPlanCode] AS [Extent1]
	WHERE ( CAST( [Extent1].[codCodeVer] AS int) = @p__linq__0) AND ((CASE WHEN ([Extent1].[plnStopFlag] IS NOT NULL) THEN CASE WHEN ('0' = [Extent1].[plnStopFlag]) THEN cast(1 as bit) WHEN (N'0' <> [Extent1].[plnStopFlag]) THEN cast(0 as bit) END ELSE cast(1 as bit) END) = 1)
)  AS [Project1]
ORDER BY [Project1].[plnPlanCode] ASC
--==============================================================================================================================--


-- 執行時間：2017/04/13 14:24:09.845 
-- 連線字串：Data Source=localhost;Initial Catalog=CDCGBCE;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/04/13 14:24:09.923 
-- 連線字串：Data Source=localhost;Initial Catalog=CDCGBCE;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/04/13 14:24:09.926 
-- 連線字串：Data Source=localhost;Initial Catalog=CDCGBCE;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/04/13 14:24:10.062 
-- 連線字串：Data Source=localhost;Initial Catalog=CDCGBCE;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo

,D.tsbPlanCode as DtsbPlanCode --為了查核定明細新增的
,D.tsbPayeeName as  DtsbPayeeName --受款人

,(
--判斷是否已經填完成季報設定 修改自季報設定
--判斷依據，總筆數與日期欄位筆數相同且有核定資料就算填畢
--沒有核定資料就空白
SELECT 
   
    -- TOP 100 PERCENT

	--有核定且用途別符合且有填值
    Case When   Count(*)  =  count(A2.tsbStartDate)  and  Count(*)  =  count(A2.tsbEndDate)   AND count(A2.tsbDecideSeq)>0  then '已填畢' 
	--有核定且用途別符合且無填值
	     When   Count(*)  !=  count(A2.tsbStartDate)  or  Count(*)  !=  count(A2.tsbEndDate)   AND count(A2.tsbDecideSeq) >0  then  '<span style="color:#FF6347;">未完成</span>'
	--其他不需要填的就空白
	else '' end 
	  
	 --,
	 --*
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
SELECT
AP.tsbApplyNo
,AP.tsbApplyWordNum
,DCD.tsbDecideSeq
,DCD.tsbPayeeName
,(SELECT plnPlanName FROM codPlanCode A 
WHERE A.codCodeVer=AP.tsbYear 
AND PD.plnPlanCode LIKE A.plnPlanCode+'%'
AND A.plnLevel=1
)AS Parent_plnPlanName
,PD.plnPlanCode+' '+ISNULL(PD.plnPlanName,'') AS PlanName
,AP.tsbTrustSubsidyName
,DCD.tsbOutlayCode+' '+ISNULL(OC.oulOutlayName,'') AS oulOutlayName
,ISNULL(DCD.tsbMoney,0) AS tsbMoney
,ISNULL(RPIM.tsbOtherNumTot,0) AS tsbOtherNumTot
,ISNULL(RPIM.tsbSelfNum,0) AS tsbSelfNum
,(
CASE WHEN (SELECT COUNT(B.tsbApplyNo) FROM tsbRptInputDataM B
WHERE B.tsbYear=RPIM.tsbYear
AND B.tsbApplyNo=RPIM.tsbApplyNo
AND B.tsbApplySeq=RPIM.tsbApplySeq
AND B.tsbDecideNo=RPIM.tsbDecideNo
AND B.tsbDecideSeq=RPIM.tsbDecideSeq)>0 THEN '1' ELSE '0' END 
) AS SetupStatus
,DCD.tsbYear
,DCD.tsbApplySeq
,DCD.tsbDecideNo
,DC.tsbDecideDate
,AP.tsbWorkUserNo
,AP.tsbWorkUnitNo
,AP.tsbPlanCode


,RPIM.tsbApplyNo as PtsbApplyNo
,RPIM.tsbDecideSeq   PtsbDecideSeq
,RPIM.tsbStartDate --活動起始日
,RPIM.tsbEndDate   --活動結束日

FROM
tsbRptInputDataM RPIM
RIGHT JOIN tsbDecideDtl DCD ON RPIM.tsbYear= DCD.tsbYear 
         AND RPIM.tsbApplyNo=DCD.tsbApplyNo AND RPIM.tsbApplySeq=DCD.tsbApplySeq 
         AND RPIM.tsbDecideNo=DCD.tsbDecideNo AND RPIM.tsbDecideSeq=DCD.tsbDecideSeq 
INNER JOIN tsbDecide DC ON DCD.tsbYear=DC.tsbYear
         AND DCD.tsbApplyNo=DC.tsbApplyNo AND DCD.tsbDecideNo=DC.tsbDecideNo
INNER JOIN tsbApply AP ON DC.tsbYear=AP.tsbYear
         AND DC.tsbApplyNo=AP.tsbApplyNo
LEFT JOIN codPlanCode PD ON AP.tsbBgtYear=PD.codCodeVer 
         AND ISNULL(DCD.tsbPlanCode,AP.tsbPlanCode)=PD.plnPlanCode
LEFT JOIN codOutlayCode OC ON DCD.tsbYear=OC.codCodeVer 
         AND DCD.tsbOutlayCode=OC.oulOutlayCode
LEFT JOIN tsbPayee ON DCD.tsbPayeeNo = tsbPayee.tsbPayeeNo

WHERE  1=1
--ISNULL(DC.tsbPassFlag,'0')='1' 配合CGSS季報設定如果審核過才顯示那就沒辦法顯示因為修改核定依定要把審核取消
AND (isnull(tsbPayee.tsbPayeeKind,'0') <> '2' )
and DCD.tsbOutlayCode like '0437%' --和衛福部不同
and (DCD.tsbCaseKind='0' or DCD.tsbCaseKind='1' or DCD.tsbCaseKind='2')


    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A2
 WHERE 1 = 1
   AND A2.tsbYear =  A.tsbYear   
--AND (A.tsbDecideDate >= '2016/01/01' AND A.tsbDecideDate <= '2016/05/17')
--AND A.tsbApplyWordNum LIKE '%10500041%' 
AND A2.tsbApplyNo =    A.tsbApplyNo           --'271' --'89'
-- ORDER BY 1


) as HavePRIMDate 



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 

--因應核定查詢需要可以查核定明細的分項計畫(要用LEFT 否則還沒有核定明細會查不到)
LEFT join tsbDecideDtl as D on D.tsbYear =B.tsbYear and D.tsbDecideNo = B.tsbDecideNo and D.tsbApplyNo =B.tsbApplyNo


WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%106%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/4/13 下午 02:24:15#  http://localhost/CDCGBCE/approved.Web/Frmapproved_approved/Default.aspx?MenuID=18621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 AND (ISNULL(mnuLevel,0)=0 OR mnuLevel >=1 OR mnuLevel=1*-1 OR mnuLevel<=-90)  ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/4/13 下午 02:24:15#  http://localhost/CDCGBCE/approved.Web/Frmapproved_approved/Default.aspx?MenuID=18621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='18621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/4/13 下午 02:24:15
--連線字串：Data Source=localhost;Initial Catalog=CDCGBCE;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(10)
Set @PK_MnuNo = '18621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/04/13 14:24:15.651 
-- 連線字串：Data Source=localhost;Initial Catalog=CDCGBCE;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo

,D.tsbPlanCode as DtsbPlanCode --為了查核定明細新增的
,D.tsbPayeeName as  DtsbPayeeName --受款人

,(
--判斷是否已經填完成季報設定 修改自季報設定
--判斷依據，總筆數與日期欄位筆數相同且有核定資料就算填畢
--沒有核定資料就空白
SELECT 
   
    -- TOP 100 PERCENT

	--有核定且用途別符合且有填值
    Case When   Count(*)  =  count(A2.tsbStartDate)  and  Count(*)  =  count(A2.tsbEndDate)   AND count(A2.tsbDecideSeq)>0  then '已填畢' 
	--有核定且用途別符合且無填值
	     When   Count(*)  !=  count(A2.tsbStartDate)  or  Count(*)  !=  count(A2.tsbEndDate)   AND count(A2.tsbDecideSeq) >0  then  '<span style="color:#FF6347;">未完成</span>'
	--其他不需要填的就空白
	else '' end 
	  
	 --,
	 --*
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
SELECT
AP.tsbApplyNo
,AP.tsbApplyWordNum
,DCD.tsbDecideSeq
,DCD.tsbPayeeName
,(SELECT plnPlanName FROM codPlanCode A 
WHERE A.codCodeVer=AP.tsbYear 
AND PD.plnPlanCode LIKE A.plnPlanCode+'%'
AND A.plnLevel=1
)AS Parent_plnPlanName
,PD.plnPlanCode+' '+ISNULL(PD.plnPlanName,'') AS PlanName
,AP.tsbTrustSubsidyName
,DCD.tsbOutlayCode+' '+ISNULL(OC.oulOutlayName,'') AS oulOutlayName
,ISNULL(DCD.tsbMoney,0) AS tsbMoney
,ISNULL(RPIM.tsbOtherNumTot,0) AS tsbOtherNumTot
,ISNULL(RPIM.tsbSelfNum,0) AS tsbSelfNum
,(
CASE WHEN (SELECT COUNT(B.tsbApplyNo) FROM tsbRptInputDataM B
WHERE B.tsbYear=RPIM.tsbYear
AND B.tsbApplyNo=RPIM.tsbApplyNo
AND B.tsbApplySeq=RPIM.tsbApplySeq
AND B.tsbDecideNo=RPIM.tsbDecideNo
AND B.tsbDecideSeq=RPIM.tsbDecideSeq)>0 THEN '1' ELSE '0' END 
) AS SetupStatus
,DCD.tsbYear
,DCD.tsbApplySeq
,DCD.tsbDecideNo
,DC.tsbDecideDate
,AP.tsbWorkUserNo
,AP.tsbWorkUnitNo
,AP.tsbPlanCode


,RPIM.tsbApplyNo as PtsbApplyNo
,RPIM.tsbDecideSeq   PtsbDecideSeq
,RPIM.tsbStartDate --活動起始日
,RPIM.tsbEndDate   --活動結束日

FROM
tsbRptInputDataM RPIM
RIGHT JOIN tsbDecideDtl DCD ON RPIM.tsbYear= DCD.tsbYear 
         AND RPIM.tsbApplyNo=DCD.tsbApplyNo AND RPIM.tsbApplySeq=DCD.tsbApplySeq 
         AND RPIM.tsbDecideNo=DCD.tsbDecideNo AND RPIM.tsbDecideSeq=DCD.tsbDecideSeq 
INNER JOIN tsbDecide DC ON DCD.tsbYear=DC.tsbYear
         AND DCD.tsbApplyNo=DC.tsbApplyNo AND DCD.tsbDecideNo=DC.tsbDecideNo
INNER JOIN tsbApply AP ON DC.tsbYear=AP.tsbYear
         AND DC.tsbApplyNo=AP.tsbApplyNo
LEFT JOIN codPlanCode PD ON AP.tsbBgtYear=PD.codCodeVer 
         AND ISNULL(DCD.tsbPlanCode,AP.tsbPlanCode)=PD.plnPlanCode
LEFT JOIN codOutlayCode OC ON DCD.tsbYear=OC.codCodeVer 
         AND DCD.tsbOutlayCode=OC.oulOutlayCode
LEFT JOIN tsbPayee ON DCD.tsbPayeeNo = tsbPayee.tsbPayeeNo

WHERE  1=1
--ISNULL(DC.tsbPassFlag,'0')='1' 配合CGSS季報設定如果審核過才顯示那就沒辦法顯示因為修改核定依定要把審核取消
AND (isnull(tsbPayee.tsbPayeeKind,'0') <> '2' )
and DCD.tsbOutlayCode like '0437%' --和衛福部不同
and (DCD.tsbCaseKind='0' or DCD.tsbCaseKind='1' or DCD.tsbCaseKind='2')


    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A2
 WHERE 1 = 1
   AND A2.tsbYear =  A.tsbYear   
--AND (A.tsbDecideDate >= '2016/01/01' AND A.tsbDecideDate <= '2016/05/17')
--AND A.tsbApplyWordNum LIKE '%10500041%' 
AND A2.tsbApplyNo =    A.tsbApplyNo           --'271' --'89'
-- ORDER BY 1


) as HavePRIMDate 



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 

--因應核定查詢需要可以查核定明細的分項計畫(要用LEFT 否則還沒有核定明細會查不到)
LEFT join tsbDecideDtl as D on D.tsbYear =B.tsbYear and D.tsbDecideNo = B.tsbDecideNo and D.tsbApplyNo =B.tsbApplyNo


WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%106%' 
AND ( A.tsbApplyWordNum LIKE '%10603217%' 
OR A.tsbLastApplyWordNum LIKE '%10603217%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/4/13 下午 02:24:17#  http://localhost/CDCGBCE/approved.Web/Frmapproved_approved/Modify.aspx?MenuID=18621&formStatus=New&Keys=%7B%22tsbYear%22%3A%22106%22%2C%22tsbApplyNo%22%3A%224753%22%2C%22tsbDecideNo%22%3A%220%22%7D
--[Parameter Count:1]
--@parMenuID='18621'
 Select * From SysMenuBase Where PK_MnuNo ='18621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/04/13 14:24:17.106 
-- 連線字串：Data Source=localhost;Initial Catalog=CDCGBCE;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


